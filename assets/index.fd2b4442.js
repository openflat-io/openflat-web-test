import{bv as V,aZ as T,q as e,b3 as O,A as U,k as b,m as P,n as j,aB as W,aE as Z,b2 as B,b9 as A,cZ as z,cW as $,c0 as F,bL as q,c_ as G,c$ as K,b8 as J,cA as Q,bC as X,bm as Y,d0 as ee,bG as oe,cB as ie,bs as te,bE as ne,bc as v,d1 as ae,d2 as re}from"./index.43c4ffc0.js";import{u as se,e as H}from"./routes.73fc4946.js";import{R as ce}from"./index.3e1ebacc.js";import{c as le,I as de,f as me}from"./index.891e0e8b.js";import{T as C}from"./Table.77c4b21e.js";import{u as ue}from"./use-login-check.e01c4832.js";import"./index.10dbff5d.js";const _=le(V,3),pe="data:image/svg+xml;charset=utf8,%3csvg width='22' height='22' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M8 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z' fill='%23444E60' fill-rule='evenodd'/%3e%3c/svg%3e",ge=({visible:p,isCreator:c,onCancel:m,onCancelSubPeriodicRoom:a})=>{const o=T();return e(O,{footer:[e(U,{onClick:m,children:o(c?"think-again":"cancel")},"Cancel"),e(U,{type:"primary",onClick:a,children:o("confirm")},"Ok")],open:p,title:o("cancel-room"),onCancel:m,children:e("span",{children:o("cancel-sub-periodic-room-tips")})})},he=({room:p,userName:c,inviteBaseUrl:m,isCreator:a,onCopyInvitation:o,onCancelSubPeriodicRoom:y,jumpToRoomDetailPage:R,jumpToModifyOrdinaryRoomPage:u})=>{const r=T(),[k,g]=b.exports.useState(!1),[t,l]=b.exports.useState(!1);return P(j,{children:[e(W,{overlay:()=>e(Z,{items:[{key:"room-detail",label:r("room-detail"),onClick:R},...a?[{key:"modify-room",label:r("modify-room"),onClick:u},{key:"cancel-room",label:r("cancel-room"),onClick:()=>g(!0)}]:[],{key:"invitation",label:r("invitation"),onClick:()=>l(!0)}]}),trigger:["click"],children:e("img",{alt:r("more"),src:pe})}),e(ge,{isCreator:a,visible:k,onCancel:()=>g(!1),onCancelSubPeriodicRoom:y}),e(de,{baseUrl:m,room:p,userName:c,visible:t,onCancel:()=>l(!1),onCopy:D=>{o(D),B.success(r("copy-success")),l(!1)}})]})},fe=({visible:p,isCreator:c,onCancel:m,onCancelPeriodicRoom:a})=>{const o=T(),y=(()=>o(c?"cancel-of-periodic-rooms":"remove-room"))(),R=()=>c?e("span",{children:o("cancel-periodic-room-tips")}):e("span",{children:o("remove-series-of-periodic-room-tips")});return e(O,{footer:[e(U,{onClick:m,children:o(c?"think-again":"cancel")},"Cancel"),e(U,{type:"primary",onClick:a,children:o("confirm")},"Ok")],open:p,title:y,onCancel:m,children:R()})},be=({rooms:p,userName:c,inviteBaseUrl:m,isCreator:a,periodicInfo:o,onCopyInvitation:y,onCancelPeriodicRoom:R,onCancelSubPeriodicRoom:u,jumpToRoomDetailPage:r,jumpToModifyPeriodicRoomPage:k,jumpToModifyOrdinaryRoomPage:g})=>{const t=T(),l=A(),[D,S]=b.exports.useState(!1),x=b.exports.useMemo(()=>l.startsWith("zh")?z:$,[l]),w=_({locale:x},"yyyy/MM"),L=_({locale:x},"dd"),I=me("HH:mm"),E=_({locale:x},"yyyy/MM/dd iii"),N=p.some(s=>[F.Started,F.Paused].includes(s==null?void 0:s.roomStatus)),i=new Date,f=()=>{const s=(()=>{const h={};return p.forEach(d=>{if(d!=null&&d.beginTime){const n=h[w(d.beginTime)];n?n.push(d):h[w(d.beginTime)]=[d]}}),h})(),M=Object.keys(s).sort().map(h=>P("div",{children:[e("div",{className:"periodic-room-panel-month-value",children:h}),e("div",{className:"periodic-room-panel-table-line"}),P(C,{bordered:!1,dataSource:s[h],pagination:!1,rowKey:"roomUUID",showHeader:!1,children:[e(C.Column,{align:"left",render:(d,n)=>L(n.beginTime||i)+"\u65E5"}),e(C.Column,{align:"center",render:(d,n)=>G(K(n.beginTime||i),l)}),e(C.Column,{align:"center",render:(d,n)=>I(n.beginTime||i)+"~"+I(n.endTime||i)}),e(C.Column,{align:"center",render:(d,n)=>e(ce,{room:n})}),e(C.Column,{align:"right",render:(d,n)=>e(he,{inviteBaseUrl:m,isCreator:a,jumpToModifyOrdinaryRoomPage:()=>g(n.roomUUID,n.periodicUUID),jumpToRoomDetailPage:()=>r(n.roomUUID,n.periodicUUID),room:n,userName:c,onCancelSubPeriodicRoom:()=>u(n.roomUUID,n.periodicUUID),onCopyInvitation:y})})]})]},h));return e("div",{className:"periodic-room-panel-table-container",children:M})};return P(j,{children:[P("div",{className:"periodic-room-panel-container",children:[P("div",{className:"periodic-room-panel-tips",children:[e("div",{className:"periodic-room-panel-tips-title",children:t("repeat-frequency",{week:q(o.weeks,l)})}),e("div",{className:"periodic-room-panel-tips-type",children:t("schedule-room-type",{type:t(`class-room-type.${o.roomType}`)})}),e("div",{className:"periodic-room-panel-tips-inner",children:t("schedule-room-detail",{time:E(o.endTime),length:p.length})})]}),e("div",{className:"periodic-room-panel-btn-list",children:a?P(j,{children:[e(U,{disabled:N,onClick:k,children:t("modify-periodic-rooms")}),e(U,{danger:!0,disabled:N,onClick:()=>S(!0),children:t("cancel-of-periodic-rooms")})]}):e(U,{danger:!0,onClick:()=>S(!0),children:t("remove-periodic-room")})}),f()]}),e(fe,{isCreator:a,visible:D,onCancel:()=>S(!1),onCancelPeriodicRoom:R})]})};const De=J(function(){ue();const c=T(),m=Q(),a=b.exports.useContext(X),[o,y]=b.exports.useState([]),R=Y(),u=se(),r=ee.exports.useLastLocation(),k=b.exports.useContext(oe);b.exports.useEffect(()=>{function i(){if(!(r!=null&&r.pathname))return u(v.HomePage);if(o.some(M=>r.pathname.includes(M)))return u(v.HomePage);R.goBack()}const f=t==null?void 0:t.periodic.title;k.configure({title:e("h1",{className:"periodic-room-detail-page-header-title",children:f}),onBackPreviousPage:i})},[]);const{periodicUUID:g}=m,t=a.periodicRooms.get(g),l=t==null?void 0:t.rooms.filter(i=>!o.includes(i)).map(i=>a.rooms.get(i));if(b.exports.useEffect(()=>{a.syncPeriodicRoomInfo(g).catch(H)},[g,a]),!t||!l)return e(ie,{timeMS:3*1e3});const{ownerUUID:D,ownerName:S}=t.periodic,x=te.userUUID===D,w=async(i,f)=>{if(i)try{await ae({roomUUID:i,periodicUUID:f});const s=[...o,i],M=l.filter(h=>h&&!s.includes(h.roomUUID));B.success(c("the-room-has-been-cancelled")),M.length===0?u(v.HomePage):y(s)}catch(s){console.log(s),H(s)}};async function L(){try{t&&await re(g)}catch(i){H(i)}u(v.HomePage),await B.success(c("the-room-has-been-cancelled"))}function I(i,f){u(v.RoomDetailPage,{periodicUUID:f,roomUUID:i})}function E(i,f){u(v.ModifyOrdinaryRoomPage,{periodicUUID:f,roomUUID:i})}function N(){t&&u(v.ModifyPeriodicRoomPage,{periodicUUID:g})}return e("div",{className:"periodic-room-detail-page-container",children:e(be,{inviteBaseUrl:ne,isCreator:x,jumpToModifyOrdinaryRoomPage:E,jumpToModifyPeriodicRoomPage:N,jumpToRoomDetailPage:I,periodicInfo:t.periodic,rooms:l,userName:S,onCancelPeriodicRoom:L,onCancelSubPeriodicRoom:w,onCopyInvitation:i=>navigator.clipboard.writeText(i)})})});export{De as PeriodicRoomDetailPage,De as default};
//# sourceMappingURL=index.fd2b4442.js.map
