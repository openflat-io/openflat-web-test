import{b8 as w,aZ as N,k as e,q as t,b3 as k,m as i,A as x,bt as y,bu as A}from"./index.43c4ffc0.js";import{u as S}from"./lifecycle.32153b61.js";function P(){const u=S(),a=e.exports.useContext(y),s=e.exports.useContext(A),[o,p]=e.exports.useState(null),[l,d]=e.exports.useState(!1),[f,m]=e.exports.useState(0),[n,c]=e.exports.useState(!1),[h,U]=e.exports.useState(!1),v=e.exports.useCallback(()=>c(!0),[]),b=e.exports.useCallback(()=>c(!1),[]),C=e.exports.useCallback(async()=>{if(s&&a){d(!0);try{const r=await u(s.getUpdateInfo());d(!1),!r||!r.hasNewVersion||r.version===a.appVersion?console.log("[Auto Updater] No new version"):(console.log("[Auto Updater] New version found",r),p(r))}catch(r){console.error(r)}}},[s,a,u]);return e.exports.useEffect(()=>{if(s&&n&&o){const r=s.onUpdateProgress(g=>{g.status?m(g.percent):U(!0)});return s.startUpdate(o.prereleaseTag),r}},[s,n,o]),{checkUpdate:C,updateInfo:o,setUpdateInfo:p,loading:l,percent:f,isStarted:n,isFailed:h,startUpdate:v,cancelUpdate:b}}const M=w(function(){const a=N(),{checkUpdate:s,updateInfo:o,setUpdateInfo:p,percent:l,isStarted:d,isFailed:f,startUpdate:m,cancelUpdate:n}=P();e.exports.useEffect(()=>{s()},[s]);const c=e.exports.useCallback(()=>{n(),p(null)},[n,p]);return t(k,{closable:!1,footer:[],keyboard:!1,maskClosable:!1,open:o!==null,title:t("div",{className:"app-upgrade-modal-title",children:a("version-updates")}),width:386,wrapClassName:"app-upgrade-modal-container",onCancel:c,children:d?i("div",{children:[i("span",{className:"app-upgrade-modal-font",children:[a("downloading")," (",l.toFixed(2),"%)..."]}),t("div",{className:"app-upgrade-modal-progress"}),t("div",{className:"app-upgrade-active-progress",style:{width:`${l}%`}}),f&&i("div",{children:[t("span",{className:"app-upgrade-modal-font",children:a("update-failed-tips")}),t("div",{className:"app-upgrade-modal-btn",children:t(x,{type:"primary",onClick:()=>window.close(),children:a("confirm")})})]})]}):i("div",{children:[t("span",{className:"app-upgrade-modal-font",children:a("new-version-tips",{version:(o==null?void 0:o.version)||" "})}),t("div",{className:"app-upgrade-modal-btn",children:t(x,{type:"primary",onClick:m,children:a("update-now")})})]})})});export{M as A};
//# sourceMappingURL=index.cdec5d78.js.map
