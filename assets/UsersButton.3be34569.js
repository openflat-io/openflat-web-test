var ss=Object.defineProperty;var is=(i,e,t)=>e in i?ss(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var m=(i,e,t)=>(is(i,typeof e!="symbol"?e+"":e,t),t);import{bH as q,bM as re,bN as V,bO as ns,bP as as,bQ as rs,bR as os,bS as cs,bT as ls,k as g,a5 as ds,aI as hs,t as us,x as T,l as O,m as b,q as r,av as ct,s as fs,aM as ms,bU as gs,bV as ps,aw as Ht,b8 as N,aZ as W,b0 as Ee,Y as ws,T as vs,bv as Ye,bW as Ss,bX as bs,bY as Us,bZ as lt,b_ as Cs,b$ as xs,b4 as Ke,b3 as Q,A as te,c0 as Re,c1 as ys,c2 as Ds,ab as Se,c3 as Ot,n as se,b1 as Ft,b2 as A,c4 as j,c5 as Te,c6 as we,c7 as Is,c8 as ne,S as Qe,c9 as ee,ca as ks,cb as Ns,cc as Ms,cd as dt,ce as Es,cf as Rs,cg as Ts,ch as Ws,ci as _s,cj as Ps,ck as As,cl as Ls,cm as Hs,cn as Os,o as ke,bs as P,co as Fs,cp as Zs,aT as Vs,bl as F,F as zs,cq as et,aP as ie,cr as ht,br as Ce,bF as J,cs as ut,ct as Bs,cu as $s,cv as js,bc as tt,bm as Gs,cw as Ys,cx as qs,bb as Zt,ba as Js,bC as Xs,bE as Ks,cy as Qs,v as Vt,D as ei,cz as ti,P as si,cA as ii,cB as ni,bt as ai,cC as ri}from"./index.43c4ffc0.js";import{c as fe,S as oi}from"./SVGUserGroup.adcc3976.js";import{d as ci,c as li,I as di}from"./index.891e0e8b.js";import{g as st}from"./index.a792be8b.js";import{e as ge,u as it}from"./routes.73fc4946.js";import{C as hi,a as ui,U as fi}from"./style.9d551dbf.js";import{u as mi}from"./lifecycle.32153b61.js";import{t as gi,d as pi}from"./debounce.3c601f71.js";import{W as zt}from"./index.10dbff5d.js";import{W as qe}from"./constants.dd61e0d4.js";import{f as wi,h as vi}from"./agora.7ea1cd24.js";import{g as Si}from"./courseware-converting.d1c4ae45.js";import{a as ft,I as mt}from"./constants.1a2b4361.js";function ye(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ye=function(t){return typeof t}:ye=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ye(i)}function pe(i,e){if(q(2,arguments),!e||ye(e)!=="object")return new Date(NaN);var t=e.years?re(e.years):0,s=e.months?re(e.months):0,n=e.weeks?re(e.weeks):0,a=e.days?re(e.days):0,o=e.hours?re(e.hours):0,l=e.minutes?re(e.minutes):0,c=e.seconds?re(e.seconds):0,h=V(i),p=s||t?ns(h,s+t*12):h,u=a||n?as(p,a+n*7):p,d=l+o*60,f=c+d*60,w=f*1e3,v=new Date(u.getTime()+w);return v}function bi(i,e){q(2,arguments);var t=V(i),s=V(e),n=t.getFullYear()-s.getFullYear(),a=t.getMonth()-s.getMonth();return n*12+a}function Ui(i,e){q(2,arguments);var t=V(i),s=V(e);return t.getFullYear()-s.getFullYear()}function gt(i,e){var t=i.getFullYear()-e.getFullYear()||i.getMonth()-e.getMonth()||i.getDate()-e.getDate()||i.getHours()-e.getHours()||i.getMinutes()-e.getMinutes()||i.getSeconds()-e.getSeconds()||i.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function Ci(i,e){q(2,arguments);var t=V(i),s=V(e),n=gt(t,s),a=Math.abs(ci(t,s));t.setDate(t.getDate()-n*a);var o=Number(gt(t,s)===-n),l=n*(a-o);return l===0?0:l}function nt(i,e){return q(2,arguments),V(i).getTime()-V(e).getTime()}function xi(i,e,t){q(2,arguments);var s=nt(i,e)/rs;return st(t==null?void 0:t.roundingMethod)(s)}function yi(i,e,t){q(2,arguments);var s=nt(i,e)/os;return st(t==null?void 0:t.roundingMethod)(s)}function Di(i){q(1,arguments);var e=V(i);return cs(e).getTime()===ls(e).getTime()}function Ii(i,e){q(2,arguments);var t=V(i),s=V(e),n=fe(t,s),a=Math.abs(bi(t,s)),o;if(a<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*a);var l=fe(t,s)===-n;Di(V(i))&&a===1&&fe(i,s)===1&&(l=!1),o=n*(a-Number(l))}return o===0?0:o}function ki(i,e,t){q(2,arguments);var s=nt(i,e)/1e3;return st(t==null?void 0:t.roundingMethod)(s)}function Ni(i,e){q(2,arguments);var t=V(i),s=V(e),n=fe(t,s),a=Math.abs(Ui(t,s));t.setFullYear(1584),s.setFullYear(1584);var o=fe(t,s)===-n,l=n*(a-Number(o));return l===0?0:l}function Mi(i){q(1,arguments);var e=V(i.start),t=V(i.end);if(isNaN(e.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(t.getTime()))throw new RangeError("End Date is invalid");var s={};s.years=Math.abs(Ni(t,e));var n=fe(t,e),a=pe(e,{years:n*s.years});s.months=Math.abs(Ii(t,a));var o=pe(a,{months:n*s.months});s.days=Math.abs(Ci(t,o));var l=pe(o,{days:n*s.days});s.hours=Math.abs(xi(t,l));var c=pe(l,{hours:n*s.hours});s.minutes=Math.abs(yi(t,c));var h=pe(c,{minutes:n*s.minutes});return s.seconds=Math.abs(ki(t,h)),s}var Ei=function(i){return(i+1)%1e6};function Ri(){var i=g.exports.useReducer(Ei,0),e=i[1];return e}var Bt=g.exports.forwardRef(function(i,e){var t,s=i.prefixCls,n=s===void 0?"rc-switch":s,a=i.className,o=i.checked,l=i.defaultChecked,c=i.disabled,h=i.loadingIcon,p=i.checkedChildren,u=i.unCheckedChildren,d=i.onClick,f=i.onChange,w=i.onKeyDown,v=ds(i,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),S=hs(!1,{value:o,defaultValue:l}),U=us(S,2),C=U[0],D=U[1];function E(I,L){var _=C;return c||(_=I,D(_),f==null||f(_,L)),_}function R(I){I.which===ct.LEFT?E(!1,I):I.which===ct.RIGHT&&E(!0,I),w==null||w(I)}function k(I){var L=E(!C,I);d==null||d(L,I)}var y=T(n,a,(t={},O(t,"".concat(n,"-checked"),C),O(t,"".concat(n,"-disabled"),c),t));return b("button",{...Object.assign({},v,{type:"button",role:"switch","aria-checked":C,disabled:c,className:y,ref:e,onKeyDown:R,onClick:k}),children:[h,r("span",{className:"".concat(n,"-inner"),children:C?p:u})]})});Bt.displayName="Switch";var Ti=globalThis&&globalThis.__rest||function(i,e){var t={};for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(i);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(i,s[n])&&(t[s[n]]=i[s[n]]);return t},$t=g.exports.forwardRef(function(i,e){var t,s=i.prefixCls,n=i.size,a=i.disabled,o=i.loading,l=i.className,c=l===void 0?"":l,h=Ti(i,["prefixCls","size","disabled","loading","className"]),p=g.exports.useContext(fs),u=p.getPrefixCls,d=p.direction,f=g.exports.useContext(ms),w=g.exports.useContext(gs),v=a||w||o,S=u("switch",s),U=r("div",{className:"".concat(S,"-handle"),children:o&&r(Ht,{className:"".concat(S,"-loading-icon")})}),C=T((t={},O(t,"".concat(S,"-small"),(n||f)==="small"),O(t,"".concat(S,"-loading"),o),O(t,"".concat(S,"-rtl"),d==="rtl"),t),c);return r(ps,{insertExtraNode:!0,children:r(Bt,{...h,prefixCls:S,className:C,disabled:v,ref:e,loadingIcon:U})})});$t.__ANT_SWITCH=!0;const pt=$t,Wi="data:image/svg+xml;charset=utf8,%3csvg width='200' height='200' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M20 100c0-44.183 35.817-80 80-80h80v80c0 44.183-35.817 80-80 80s-80-35.817-80-80Z' fill='%23F4F8FF'/%3e%3cpath d='M156 136h-.625v-.625H156V136Zm0 12h.625v1.509l-1.067-1.067L156 148Zm-12-12v-.625h.259l.183.183L144 136Zm27.375-40A7.375 7.375 0 0 0 164 88.625v-1.25A8.625 8.625 0 0 1 172.625 96h-1.25Zm0 32V96h1.25v32h-1.25ZM164 135.375a7.375 7.375 0 0 0 7.375-7.375h1.25a8.626 8.626 0 0 1-8.625 8.625v-1.25Zm-8 0h8v1.25h-8v-1.25Zm.625.625v12h-1.25v-12h1.25Zm-1.067 12.442-12-12 .884-.884 12 12-.884.884ZM100 135.375h44v1.25h-44v-1.25ZM92.625 128a7.375 7.375 0 0 0 7.375 7.375v1.25A8.625 8.625 0 0 1 91.375 128h1.25Zm0-32v32h-1.25V96h1.25ZM100 88.625A7.375 7.375 0 0 0 92.625 96h-1.25A8.625 8.625 0 0 1 100 87.375v1.25Zm64 0h-64v-1.25h64v1.25Z' fill='%232867CC'/%3e%3cpath fill-rule='evenodd' clip-rule='evenodd' d='M152 107h-40v2h40v-2Zm-8 8h-32v2h32v-2Z' fill='%232867CC'/%3e%3cpath fill-rule='evenodd' clip-rule='evenodd' d='M28 60a8 8 0 0 1 8-8h64a8 8 0 0 1 8 8v32a8 8 0 0 1-8 8H56l-12 12v-12h-8a8 8 0 0 1-8-8V60Zm26 19a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm14 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm17-3a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z' fill='%233381FF'/%3e%3c/svg%3e",_i="data:image/svg+xml;charset=utf8,%3csvg width='200' height='200' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M20 100c0-44.183 35.817-80 80-80h80v80c0 44.183-35.817 80-80 80s-80-35.817-80-80Z' fill='%232B2F38'/%3e%3cpath d='M156 136h-.625v-.625H156V136Zm0 12h.625v1.509l-1.067-1.067L156 148Zm-12-12v-.625h.259l.183.183L144 136Zm27.375-40A7.375 7.375 0 0 0 164 88.625v-1.25A8.625 8.625 0 0 1 172.625 96h-1.25Zm0 32V96h1.25v32h-1.25ZM164 135.375a7.375 7.375 0 0 0 7.375-7.375h1.25a8.626 8.626 0 0 1-8.625 8.625v-1.25Zm-8 0h8v1.25h-8v-1.25Zm.625.625v12h-1.25v-12h1.25Zm-1.067 12.442-12-12 .884-.884 12 12-.884.884ZM100 135.375h44v1.25h-44v-1.25ZM92.625 128a7.375 7.375 0 0 0 7.375 7.375v1.25A8.625 8.625 0 0 1 91.375 128h1.25Zm0-32v32h-1.25V96h1.25ZM100 88.625A7.375 7.375 0 0 0 92.625 96h-1.25A8.625 8.625 0 0 1 100 87.375v1.25Zm64 0h-64v-1.25h64v1.25Z' fill='%232867CC'/%3e%3cpath fill-rule='evenodd' clip-rule='evenodd' d='M152 107h-40v2h40v-2Zm-8 8h-32v2h32v-2ZM28 60a8 8 0 0 1 8-8h64a8 8 0 0 1 8 8v32a8 8 0 0 1-8 8H56l-12 12v-12h-8a8 8 0 0 1-8-8V60Zm26 19a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm14 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm17-3a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z' fill='%232867CC'/%3e%3c/svg%3e",jt=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("circle",{className:"flat-icon-stroke-color",cx:"12",cy:"11",r:"7",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("circle",{className:"flat-icon-stroke-color",cx:"12",cy:"11",r:"3",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("circle",{className:"flat-icon-fill-color",cx:"14.625",cy:"6.625",fill:"#5D6066",r:".625"}),r("path",{className:"flat-icon-stroke-color",d:"M7 18.25a8.004 8.004 0 0 0 10 0",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),Gt=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-stroke-color",d:"m5 5 14 14",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-fill-color",clipRule:"evenodd",d:"m15.72 18.373.91.909a8.63 8.63 0 0 1-9.788-.364l-.232-.18.78-.976a7.38 7.38 0 0 0 8.33.61Zm2.434-2.87A7.625 7.625 0 0 0 7.497 4.846l.897.896a6.375 6.375 0 0 1 8.864 8.864l.896.897Zm-3.857 1.446.952.951A7.625 7.625 0 0 1 5.1 7.751l.951.952a6.375 6.375 0 0 0 8.246 8.246Zm.956-4.348a3.625 3.625 0 0 0-4.854-4.854l.964.964a2.378 2.378 0 0 1 2.926 2.926l.964.964Zm-.628-5.351a.625.625 0 1 0 0-1.25.625.625 0 0 0 0 1.25Z",fill:"#5D6066",fillRule:"evenodd"})]}),Pi=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-fill-color",clipRule:"evenodd",d:"M18.674 16.022A2.62 2.62 0 0 0 19.625 14V7A2.625 2.625 0 0 0 17 4.375H7.027l1.25 1.25H17c.76 0 1.375.616 1.375 1.375v7c0 .469-.235.883-.593 1.13l.892.892Zm-5.95-.647 1.25 1.25h-1.717l-2.815 2.817a.625.625 0 0 1-1.06-.347L8.375 19v-2.375H7a2.625 2.625 0 0 1-2.62-2.459L4.375 14V7.027l1.25 1.25V14c0 .76.616 1.375 1.375 1.375h2c.345 0 .625.28.625.625v1.491l1.933-1.933a.625.625 0 0 1 .344-.175l.098-.008h.723Z",fill:"#5D6066",fillRule:"evenodd"}),r("path",{className:"flat-icon-stroke-color",d:"m5 5 14 14",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),hr=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-fill-color",d:"M15.625 7V6h-1.25v1h1.25ZM14 4.375H6v1.25h8v-1.25ZM4.375 6v12h1.25V6h-1.25ZM6 19.625h8v-1.25H6v1.25ZM15.625 18v-1h-1.25v1h1.25ZM14 19.625c.898 0 1.625-.727 1.625-1.625h-1.25a.375.375 0 0 1-.375.375v1.25ZM4.375 18c0 .898.728 1.625 1.625 1.625v-1.25A.375.375 0 0 1 5.625 18h-1.25ZM6 4.375c-.897 0-1.625.728-1.625 1.625h1.25c0-.207.168-.375.375-.375v-1.25ZM15.625 6c0-.897-.727-1.625-1.625-1.625v1.25c.207 0 .375.168.375.375h1.25Z",fill:"#5D6066"}),r("path",{className:"flat-icon-stroke-color",d:"M10 12h9m-3 3 3-3-3-3",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),at=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-stroke-color",d:"M15.869 12.624a3 3 0 0 0-2.121 3.674",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-stroke-color",clipRule:"evenodd",d:"m17.4 17.617 2.554-7.549a.862.862 0 0 0-.385-1.023.815.815 0 0 0-1.05.202l-2.65 3.377-2.07-7.727a1 1 0 0 0-1.932.517l1.294 4.83-.966.259-1.812-6.762a1 1 0 1 0-1.932.518l1.812 6.761-.966.26-1.553-5.796A1 1 0 0 0 5.812 6l1.553 5.796-.966.259-1.035-3.864a1 1 0 1 0-1.932.518l2.588 9.659a4 4 0 0 0 4.9 2.828l3.727-.998a4 4 0 0 0 2.754-2.582Z",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),ur=({active:i,className:e="",...t})=>r("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:r("path",{className:"flat-icon-stroke-color",d:"m16 10 2 2-2 2M6 6h12M6 18h12M6 14h8m-8-4h8",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})}),fr=({active:i,className:e="",...t})=>r("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:r("path",{className:"flat-icon-stroke-color",d:"m8 10-2 2 2 2m10-8H6m12 12H6m12-4h-8m8-4h-8",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})}),Yt=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-stroke-color",d:"m5 5 14 14",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-fill-color",clipRule:"evenodd",d:"M19.277 16.625H20v-1.25h-1.973l1.25 1.25Zm-3.239 2.065.89.89a4.602 4.602 0 0 1-2.716 1.04l-.212.005h-4a4.626 4.626 0 0 1-4.55-3.787l-.033-.213H4v-1.25h2c.345 0 .625.28.625.625a3.375 3.375 0 0 0 3.19 3.37l.185.005h4a3.36 3.36 0 0 0 2.038-.685Zm.587-4.717V8a4.625 4.625 0 0 0-8.5-2.526l.911.91a3.374 3.374 0 0 1 6.281.991H14v1.25h1.375v.75H14v1.25h1.375v.75h-1.348l1.25 1.25h.098v.098l1.25 1.25Zm-2.587 2.717.89.89A4.625 4.625 0 0 1 7.375 14v-3.973l1.25 1.25v.098h.098l1.25 1.25H8.625V14a3.375 3.375 0 0 0 5.413 2.69Z",fill:"#5D6066",fillRule:"evenodd"})]}),Ai=({active:i,className:e="",...t})=>r("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:r("path",{className:"flat-icon-stroke-color",d:"M5 12h14m-7-7v14",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})}),Li=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("rect",{className:"flat-icon-stroke-color",height:"12",rx:"2",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25",width:"14",x:"3",y:"6"}),r("path",{className:"flat-icon-stroke-color",clipRule:"evenodd",d:"m17 11 4-2v6l-4-2v-2Z",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-stroke-color",d:"M6 9h4",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),Hi=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-stroke-color",d:"M3 11V8a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-5",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("circle",{className:"flat-icon-stroke-color",cx:"6",cy:"15",r:"3",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-fill-color",d:"M5 14h2v2H5z",fill:"#5D6066"}),r("path",{className:"flat-icon-stroke-color",clipRule:"evenodd",d:"m17 11 4-2v6l-4-2v-2Z",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-stroke-color",d:"M6 9h4",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),mr=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-stroke-color",d:"M12 17v3m-3 0h6",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-fill-color",d:"M18.375 11v4h1.25v-4h-1.25ZM17 16.375H7v1.25h10v-1.25ZM5.625 15V8h-1.25v7h1.25ZM7 6.625h5v-1.25H7v1.25ZM5.625 8c0-.76.616-1.375 1.375-1.375v-1.25A2.625 2.625 0 0 0 4.375 8h1.25ZM7 16.375c-.76 0-1.375-.616-1.375-1.375h-1.25A2.625 2.625 0 0 0 7 17.625v-1.25ZM18.375 15c0 .76-.616 1.375-1.375 1.375v1.25A2.625 2.625 0 0 0 19.625 15h-1.25Z",fill:"#5D6066"}),r("path",{className:"flat-icon-stroke-color",d:"m17 4 2 2-2 2",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),r("path",{className:"flat-icon-fill-color",d:"M19 5.375h-3v1.25h3v-1.25ZM13.375 8v3h1.25V8h-1.25ZM16 5.375A2.625 2.625 0 0 0 13.375 8h1.25c0-.76.616-1.375 1.375-1.375v-1.25Z",fill:"#5D6066"})]}),Oi=({active:i,className:e="",...t})=>r("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:r("path",{className:"flat-icon-stroke-color",d:"m15 10-5 5v5l4-4 4 3 2-15-16 9 4 1",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})}),Fi=({active:i,className:e="",...t})=>b("svg",{className:`${e} flat-icon ${i?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...t,children:[r("path",{className:"flat-icon-fill-color",d:"m7.265 14.925.294.552-.294-.552Zm-.03.724.324-.172-.588-1.103-.324.173.588 1.102Zm3.203-3.128.121-.242-1.118-.559-.12.242 1.117.559Zm-.813-2.935V7h-1.25v2.586h1.25ZM14.375 7v2.586h1.25V7h-1.25Zm-.934 5.28.496.99 1.118-.558-.496-.992-1.118.56Zm.934-2.694c0 .74-.294 1.449-.817 1.972l.884.884a4.04 4.04 0 0 0 1.183-2.856h-1.25ZM9.625 7A2.375 2.375 0 0 1 12 4.625v-1.25A3.625 3.625 0 0 0 8.375 7h1.25Zm.817 4.558a2.79 2.79 0 0 1-.817-1.972h-1.25c0 1.071.426 2.098 1.183 2.856l.884-.884Zm-2.883 3.919a6.793 6.793 0 0 0 2.88-2.956l-1.119-.559a5.543 5.543 0 0 1-2.349 2.412l.588 1.103ZM12 4.625A2.375 2.375 0 0 1 14.375 7h1.25A3.625 3.625 0 0 0 12 3.375v1.25ZM4.625 20a4.93 4.93 0 0 1 2.61-4.35l-.588-1.103A6.18 6.18 0 0 0 3.375 20h1.25Z",fill:"#5D6066"}),r("path",{className:"flat-icon-stroke-color",d:"M21 17h-8m4 4v-8",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),Zi=N(function({isCreator:e,isBan:t,onBanChange:s,onMessageSend:n}){const a=W(),o=Ee(),l=g.exports.useRef(null),[c,h]=g.exports.useState(""),[p,u]=g.exports.useState(!1),d=g.exports.useMemo(()=>c.trim(),[c]);async function f(){var w;if(!(p||d.length<=0)){u(!0);try{await o(n(c)),h(""),(w=l.current)==null||w.focus()}catch(v){console.warn(v)}u(!1)}}return b("div",{className:"chat-typebox",children:[e&&r("button",{className:"chat-typebox-icon",title:a("ban"),onClick:s,children:r(Pi,{active:t})}),!e&&t?r("span",{className:"chat-typebox-ban-input",title:a("all-staff-are-under-ban"),children:a("all-staff-are-under-ban")}):r("input",{ref:l,className:"chat-typebox-input",placeholder:a("say-something"),type:"text",value:c,onChange:w=>h(w.currentTarget.value.slice(0,200)),onKeyPress:w=>{w.key==="Enter"&&f()}}),r("button",{className:"chat-typebox-send",disabled:!e&&t||p||d.length<=0,title:a("send"),onClick:f,children:r(Oi,{})})]})});var Vi=30,zi=100,Bi=function(){function i(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vs(this,i),O(this,"_cellHeightCache",{}),O(this,"_cellWidthCache",{}),O(this,"_columnWidthCache",{}),O(this,"_rowHeightCache",{}),O(this,"_defaultHeight",void 0),O(this,"_defaultWidth",void 0),O(this,"_minHeight",void 0),O(this,"_minWidth",void 0),O(this,"_keyMapper",void 0),O(this,"_hasFixedHeight",void 0),O(this,"_hasFixedWidth",void 0),O(this,"_columnCount",0),O(this,"_rowCount",0),O(this,"columnWidth",function(p){var u=p.index,d=e._keyMapper(0,u);return e._columnWidthCache[d]!==void 0?e._columnWidthCache[d]:e._defaultWidth}),O(this,"rowHeight",function(p){var u=p.index,d=e._keyMapper(u,0);return e._rowHeightCache[d]!==void 0?e._rowHeightCache[d]:e._defaultHeight});var s=t.defaultHeight,n=t.defaultWidth,a=t.fixedHeight,o=t.fixedWidth,l=t.keyMapper,c=t.minHeight,h=t.minWidth;this._hasFixedHeight=a===!0,this._hasFixedWidth=o===!0,this._minHeight=c||0,this._minWidth=h||0,this._keyMapper=l||$i,this._defaultHeight=Math.max(this._minHeight,typeof s=="number"?s:Vi),this._defaultWidth=Math.max(this._minWidth,typeof n=="number"?n:zi)}return ws(i,[{key:"clear",value:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=this._keyMapper(t,s);delete this._cellHeightCache[n],delete this._cellWidthCache[n],this._updateCachedColumnAndRowSizes(t,s)}},{key:"clearAll",value:function(){this._cellHeightCache={},this._cellWidthCache={},this._columnWidthCache={},this._rowHeightCache={},this._rowCount=0,this._columnCount=0}},{key:"hasFixedHeight",value:function(){return this._hasFixedHeight}},{key:"hasFixedWidth",value:function(){return this._hasFixedWidth}},{key:"getHeight",value:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this._hasFixedHeight)return this._defaultHeight;var n=this._keyMapper(t,s);return this._cellHeightCache[n]!==void 0?Math.max(this._minHeight,this._cellHeightCache[n]):this._defaultHeight}},{key:"getWidth",value:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this._hasFixedWidth)return this._defaultWidth;var n=this._keyMapper(t,s);return this._cellWidthCache[n]!==void 0?Math.max(this._minWidth,this._cellWidthCache[n]):this._defaultWidth}},{key:"has",value:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=this._keyMapper(t,s);return this._cellHeightCache[n]!==void 0}},{key:"set",value:function(t,s,n,a){var o=this._keyMapper(t,s);s>=this._columnCount&&(this._columnCount=s+1),t>=this._rowCount&&(this._rowCount=t+1),this._cellHeightCache[o]=a,this._cellWidthCache[o]=n,this._updateCachedColumnAndRowSizes(t,s)}},{key:"_updateCachedColumnAndRowSizes",value:function(t,s){if(!this._hasFixedWidth){for(var n=0,a=0;a<this._rowCount;a++)n=Math.max(n,this.getWidth(a,s));var o=this._keyMapper(0,s);this._columnWidthCache[o]=n}if(!this._hasFixedHeight){for(var l=0,c=0;c<this._columnCount;c++)l=Math.max(l,this.getHeight(t,c));var h=this._keyMapper(t,0);this._rowHeightCache[h]=l}}},{key:"defaultHeight",get:function(){return this._defaultHeight}},{key:"defaultWidth",get:function(){return this._defaultWidth}}]),i}();function $i(i,e){return"".concat(i,"-").concat(e)}const ji=N(function({userUUID:e,messageUser:t,message:s,onMount:n,openCloudStorage:a}){const o=W();switch(g.exports.useEffect(()=>{n()},[]),s.type){case"notice":return r("div",{className:"chat-message-line",children:r("div",{className:"chat-message-notice",children:s.text})});case"ban":return r("div",{className:"chat-message-line",children:r("div",{className:"chat-message-ban",children:r("span",{children:s.status?o("banned"):o("unban")})})});case"user-guide":return r("div",{className:"chat-message-line",children:r("div",{className:"chat-message-user-guide-bubble",children:b("pre",{children:[o("user-guide-text"),r("span",{className:"chat-message-user-guide-btn",onClick:a,children:o("user-guide-button")})]})})})}const l=new Date(s.timestamp),c=Ye(l,"yyyy-MM-dd HH:mm"),[h,p]=c.split(" "),u=Ye(new Date,"yyyy-MM-dd"),d=h===u?p:c;return e===s.senderID?b("div",{className:"chat-message-line is-reverse",children:[r("div",{className:"chat-message-avatar",children:r("span",{className:"chat-message-user-avatar",children:r("img",{alt:"[avatar]",src:t==null?void 0:t.avatar})})}),b("div",{className:"chat-message-user-bubble",children:[b("div",{className:"chat-message-user",children:[r("span",{className:"chat-message-user-name",children:(t==null?void 0:t.name)||s.senderID}),r("time",{className:"chat-message-user-time",dateTime:l.toISOString(),title:l.toLocaleString(),children:d})]}),r("div",{className:"chat-message-bubble is-self",children:r("pre",{children:s.text})})]})]}):b("div",{className:"chat-message-line",children:[r("div",{className:"chat-message-avatar",children:r("span",{className:"chat-message-user-avatar",children:r("img",{alt:"[avatar]",src:t==null?void 0:t.avatar})})}),b("div",{className:"chat-message-user-bubble",children:[b("div",{className:"chat-message-user",children:[r("span",{className:"chat-message-user-name",children:(t==null?void 0:t.name)||s.senderID}),r("time",{className:"chat-message-user-time",dateTime:l.toISOString(),title:l.toLocaleString(),children:d})]}),r("div",{className:"chat-message-bubble",children:r("pre",{children:s.text})})]})]})}),Gi=N(function({visible:e,userUUID:t,messages:s,getUserByUUID:n,loadMoreRows:a,openCloudStorage:o}){const l=Ri(),[c,h]=g.exports.useState(s.length-1),[p]=g.exports.useState(()=>new Bi({defaultHeight:72,fixedWidth:!0,keyMapper:w=>s[w].uuid}));g.exports.useEffect(()=>{e&&(p.clearAll(),l(),h(s.length-1))},[e]),g.exports.useEffect(()=>{if(c!==void 0){const w=window.setTimeout(()=>{h(void 0)},0);return()=>{window.clearTimeout(w)}}},[c]),Ss(()=>({messageCount:s.length,latestMessage:s.length>0?s[s.length-1]:null}),({messageCount:w,latestMessage:v},S)=>{w>S.messageCount&&(!S.latestMessage||v.timestamp>S.latestMessage.timestamp?h(w-1):h(w-S.messageCount))});const u=g.exports.useRef(!0),d=({index:w})=>{const v=w>0;return u.current?(u.current=!1,!0):v},f=({index:w,parent:v,style:S})=>r(xs,{cache:p,columnIndex:0,parent:v,rowIndex:w,children:({measure:U,registerChild:C})=>r("div",{ref:D=>D&&C&&C(D),style:S,children:r(lt,{children:()=>r(ji,{message:s[w],messageUser:n(s[w].senderID),openCloudStorage:o,userUUID:t,onMount:U})})})},s[w].uuid);return r(bs,{isRowLoaded:d,loadMoreRows:a,rowCount:s.length,threshold:1,children:({onRowsRendered:w,registerChild:v})=>r(Us,{children:({height:S,width:U})=>r(lt,{children:()=>r(Cs,{ref:v,className:"fancy-scrollbar",height:S,rowCount:s.length,rowHeight:p.rowHeight,rowRenderer:f,scrollToAlignment:"start",scrollToIndex:c,width:U,onRowsRendered:w})})})})}),Yi=N(function({messages:e,...t}){const s=g.exports.useContext(Ke);return b("div",{className:"chat-messages-wrap",children:[r("div",{className:"chat-messages",children:e.length>0?r("div",{className:"chat-messages-box",children:r(Gi,{messages:e,...t})}):r("div",{className:"chat-messages-default",children:r("img",{src:s?_i:Wi})})}),r(Zi,{...t})]})});function qi(i){return Number.isSafeInteger(i)}const Ji=({unreadCount:i,children:e})=>{const t=g.exports.useMemo(()=>qi(i)&&r("span",{className:T("chat-tab-red-dot",{"is-large":i>99}),children:i<100?i:"99+"}),[i]);return b("span",{className:"chat-tab-title",children:[e,t]})},Xi=N(function(e){const t=W();return b("div",{className:"chat-panel",children:[b("div",{className:"chat-panel-header",children:[r(Ji,{children:r("span",{children:t("messages")})}),e.totalUserCount&&r("span",{className:"chat-tab-subtitle",onClick:e.onClickTotalUsersCount,children:t("total-users-count",{count:e.totalUserCount})})]}),r(Yi,{...e,visible:!0})]})}),Ki=({visible:i,loading:e,onStop:t,onCancel:s})=>{const n=W();return r(Q,{okButtonProps:{loading:e},open:i,title:n("confirmation-of-the-end-of-classes"),onCancel:s,onOk:t,children:r("p",{children:n("end-of-class-tips")})})},Qi=({visible:i,hangLoading:e,stopLoading:t,onHang:s,onStop:n,onCancel:a})=>{const o=W();return r(Q,{footer:[r(te,{onClick:a,children:o("cancel")},"Cancel"),r(te,{loading:e,onClick:s,children:o("hang-up-the-room")},"ReturnMain"),r(te,{loading:t,type:"primary",onClick:n,children:o("end-the-class")},"StopClass")],open:i,title:o("close-option"),onCancel:a,onOk:a,children:r("p",{children:o("exit-room-tips")})})},en=({visible:i,onExit:e,onCancel:t})=>{const s=W();return r(Q,{open:i,title:s("student-sure-to-exit-the-room"),onCancel:t,onOk:e,children:r("p",{children:s("student-exit-room-tip")})})},tn="data:image/svg+xml;charset=utf8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 18'%3e%3cpath d='M0 10h2v4H0zm6-4v8H4V6h2zm4-4v12H8V2h2z' fill='%23d0d1d1' fill-rule='evenodd'/%3e%3c/svg%3e",sn="data:image/svg+xml;charset=utf8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 18'%3e%3cg fill='none' fill-rule='evenodd'%3e%3cpath fill='%23FF9393' d='M0 10h2v4H0z'/%3e%3cpath fill='%23FFD4D4' d='M6 6v8H4V6h2zm4-4v12H8V2h2z'/%3e%3c/g%3e%3c/svg%3e",nn="data:image/svg+xml;charset=utf8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 18'%3e%3cg fill='none' fill-rule='evenodd'%3e%3cpath fill='%23FFF3D1' d='M8 2h2v12H8z'/%3e%3cpath fill='%23FFE08D' d='M2 10v4H0v-4h2zm4-4v8H4V6h2z'/%3e%3c/g%3e%3c/svg%3e",wt="data:image/svg+xml;charset=utf8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 18'%3e%3cpath fill='%239FDF76' fill-rule='evenodd' d='M2 10v4H0v-4h2zm4-4v8H4V6h2zm4-4v12H8V2h2z'/%3e%3c/svg%3e";function an(i,e){return i===5||e===5||i===4||e===4?sn:i===3||e===3?nn:i===2||e===2||i===1||e===1||i===8||e===8?wt:tn}const gr=N(function({networkQuality:e}){const t=W(),{uplink:s,downlink:n}=e,a=g.exports.useMemo(()=>an(s,n),[s,n]),o=g.exports.useMemo(()=>t("network-quality",{uplink:t(`network-quality${s}`),downlink:t(`network-quality${n}`)}),[t,s,n]);return b("div",{className:"network-status",children:[b("span",{className:"network-status-delay",title:t("client-to-edge-server-network-latency"),children:[t("delay"),b("span",{className:"network-status-delay-ms",children:[e.delay,"ms"]})]}),b("span",{className:"network-status-signal",title:o,children:[t("network"),r("img",{alt:o,src:a})]})]})}),We=({title:i,icon:e,disabled:t,className:s,...n})=>r("button",{...n,className:T("topbar-right-btn",s),disabled:t,title:i,children:e}),pr=({roomStatus:i,roomType:e})=>{const t=W();return b("div",{className:"room-info",children:[b("span",{children:[t("current-status"),r("span",{className:T("room-info-progress",{"is-active":i!==Re.Idle}),children:t(`room-status.${ys(i)}`)})]}),b("span",{children:[t("current-mode"),r("span",{className:"room-info-mode",children:t(`class-room-type.${e||Ds.BigClass}`)})]})]})},rn=({isCreator:i,isRemoteLogin:e,roomStatus:t,onExit:s})=>{const n=g.exports.useRef(),[a,o]=g.exports.useState(!1),l=W();return g.exports.useEffect(()=>{e&&o(!0)},[e]),g.exports.useEffect(()=>{t===Re.Stopped&&(i?s():o(!0))},[t,i,s]),g.exports.useEffect(()=>{let c;if(a){let h=5;n.current=Q.info({title:l(e?"you-have-entered-the-room-at-another-device":"the-room-has-ended-and-is-about-to-exit"),okText:l("got-it-countdown",{countdown:h}),onOk:s,onCancel:s}),c=window.setInterval(()=>{var p;(p=n.current)==null||p.update({okText:l("got-it-countdown",{countdown:--h})}),h<=0&&(window.clearInterval(c),s())},1e3)}return()=>{var h;window.clearInterval(c),(h=n.current)==null||h.destroy()}},[a,s,l,e]),null},qt=Se.memo(function({getVolumeLevel:e,noise:t=.075,...s}){t=Math.max(0,Math.min(1,t));const n=14,a=8,o=8,l=4,[c,h]=g.exports.useState(0),[p,u]=g.exports.useState(0);return g.exports.useEffect(()=>{if(!e){h(0);return}const d=()=>{h(Math.max(0,Math.min(1,e())))};d();const f=setInterval(d,500);return()=>clearInterval(f)},[e]),g.exports.useEffect(()=>{if(!c)return;const d=setInterval(()=>{u(c+Math.random()*t*(Math.random()>.5?1:-1))},50);return()=>clearInterval(d)},[c,t]),b("svg",{fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...s,children:[r("defs",{children:r("clipPath",{id:"icon-mic-v-clip",children:r("rect",{height:n,rx:a/2,width:a,x:o,y:l})})}),r("path",{d:"M0 0h24v24H0z",fill:"#999CA3",opacity:".01"}),r("rect",{clipPath:"url(#icon-mic-v-clip)",fill:"#fff",height:n,width:a,x:o,y:l}),r("path",{d:"M4 16.625h2v-1.25H4v1.25Zm6 4h4v-1.25h-4v1.25Zm8-4h2v-1.25h-2v1.25Zm-4 4A4.625 4.625 0 0 0 18.625 16h-1.25A3.375 3.375 0 0 1 14 19.375v1.25ZM5.375 16A4.625 4.625 0 0 0 10 20.625v-1.25A3.375 3.375 0 0 1 6.625 16h-1.25Z",fill:"#fff"}),r("g",{clipPath:"url(#icon-mic-v-clip)",children:r("rect",{fill:"#44AD00",height:n*2,style:{transform:`translateY(${(1-p)*n}px)`,transition:"transform .1s"},width:a,x:o,y:l})})]})}),on=({portal:i,small:e,avatarUser:t,isCreator:s,isDropTarget:n,userUUID:a,updateDeviceState:o,getVolumeLevel:l,onDoubleClick:c,onDragStart:h,onDragEnd:p,children:u})=>{const d=!s&&t.userUUID!==a,f=!s&&t.userUUID!==a,w=S=>{const U=S.currentTarget.getBoundingClientRect(),C=(S.clientX-U.left)/U.width,D=(S.clientY-U.top)/U.height;S.dataTransfer.setData("video-avatar",JSON.stringify([t.userUUID,C,D])),S.dataTransfer.effectAllowed="move",h&&h()},v=b("div",{className:T("video-avatar",{"is-small":e&&!i,"is-drop-target":n}),"data-user-uuid":t.userUUID,draggable:s&&!i,onDoubleClick:i?void 0:c,onDragEnd:p,onDragStart:w,children:[r("div",{className:"video-avatar-video",children:u}),(!u||!t.camera)&&b("div",{className:"video-avatar-image-container",children:[r("div",{className:"video-avatar-image-blur-bg",style:{backgroundImage:`url(${t.avatar})`}}),r("img",{alt:t.name,className:"video-avatar-image",draggable:!1,src:t.avatar})]}),b("div",{className:"video-avatar-bottom",children:[r("h1",{className:"video-avatar-user-name",title:t.name,children:t.name}),b("div",{className:T("video-avatar-media-ctrl",{"is-portal":i}),children:[r("button",{className:T("video-avatar-media-ctrl-btn",{"is-muted":!t.camera}),disabled:d,onClick:()=>{(s||a===t.userUUID)&&o(t.userUUID,!t.camera,t.mic)},children:t.camera?r(jt,{}):r(Gt,{})}),r("button",{className:T("video-avatar-media-ctrl-btn",{"is-muted":!t.mic}),disabled:f,onClick:()=>{(s||a===t.userUUID)&&o(t.userUUID,t.camera,!t.mic)},children:t.mic?r(qt,{getVolumeLevel:l}):r(Yt,{})})]})]})]});return i?b("div",{className:T("video-avatar","video-avatar-holder",{"is-small":e,"is-drop-target":n}),"data-user-uuid":t.userUUID,children:[r("span",{className:"video-avatar-holder-name",children:t.name}),Ot.exports.createPortal(v,i)]}):v},cn=({className:i,isDark:e})=>{const t=e?"#33353D":"#D5D9E0";return b("svg",{className:i,fill:"none",height:"80",viewBox:"0 0 80 80",width:"80",xmlns:"http://www.w3.org/2000/svg",children:[r("path",{d:"M0 80V71.7607C0 61.8652 6.62305 53.1938 16.1699 50.5898L19.873 49.5801C24.6387 48.2808 28.4375 44.6855 30 40L29.3926 39.3936C26.5801 36.5806 25 32.7651 25 28.7866V26.25C22.3535 23.9341 22.3535 19.8159 25 17.5V15C25 6.71582 31.7148 0 40 0C48.2852 0 55 6.71582 55 15V17.5C57.6465 19.8159 57.6465 23.9341 55 26.25V28.7866C55 32.7651 53.4199 36.5806 50.6074 39.3936L50 40C51.5625 44.6855 55.3613 48.2808 60.127 49.5801L63.8301 50.5898C73.377 53.1938 80 61.8652 80 71.7607V80H0Z",fill:"url(#paint0_linear_4451_134)"}),r("defs",{children:b("linearGradient",{gradientUnits:"userSpaceOnUse",id:"paint0_linear_4451_134",x1:"40",x2:"40",y1:"0",y2:"80",children:[r("stop",{stopColor:t}),r("stop",{offset:"1",stopColor:t,stopOpacity:"0"})]})})]})},ln=({avatarUser:i,small:e,isCreator:t,isAvatarUserCreator:s,portal:n,onDoubleClick:a,onDragStart:o,onDragEnd:l,isDropTarget:c})=>{const h=W(),p=g.exports.useContext(Ke),u=f=>{if(!i)return;const w=f.currentTarget.getBoundingClientRect(),v=(f.clientX-w.left)/w.width,S=(f.clientY-w.top)/w.height;f.dataTransfer.setData("video-avatar",JSON.stringify([i.userUUID,v,S])),f.dataTransfer.effectAllowed="move",o&&o()},d=i?b("div",{className:T("video-avatar",{"is-small":e&&!n,"is-drop-target":c}),"data-user-uuid":i.userUUID,draggable:t&&!n,onDoubleClick:n?void 0:a,onDragEnd:l,onDragStart:u,children:[r("div",{className:"video-avatar-image-blur-bg",style:{backgroundImage:`url(${i.avatar})`}}),r("img",{alt:i.name,className:"video-avatar-image",draggable:!1,src:i.avatar}),r("div",{className:"video-avatar-bottom",children:r("h1",{className:"video-avatar-user-name",title:i.name,children:i.name})}),r("div",{className:"video-avatar-is-left",children:h("has-left")})]}):null;return n?b("div",{className:T("video-avatar-absent",{"is-small":e,"is-drop-target":c}),"data-user-uuid":i==null?void 0:i.userUUID,children:[b("div",{className:"video-avatar-absent-block",children:[r(cn,{className:"video-avatar-absent-img",isDark:p}),r("span",{className:"video-avatar-absent-content",children:s?h("teacher-left-temporarily"):i?b(se,{children:[r("span",{className:"video-avatar-absent-name",children:i.name}),r("span",{className:"video-avatar-absent-desc",children:h("user-left-temporarily")})]}):h("student-left-temporarily")})]}),d&&n&&Ot.exports.createPortal(d,n)]}):d};var vt=1/0,dn=17976931348623157e292;function hn(i){if(!i)return i===0?i:0;if(i=gi(i),i===vt||i===-vt){var e=i<0?-1:1;return e*dn}return i===i?i:0}function un(i){var e=hn(i),t=e%1;return e===e?t?e-t:e:0}function fn(i){return typeof i=="number"&&i==un(i)}const mn=({isRaiseHand:i,disableHandRaising:e,onRaiseHandChange:t})=>{const s=W();return e?null:r("button",{className:"raise-hand-btn",title:s("raise-your-hand"),onClick:t,children:r(at,{active:i})})},gn=({count:i,active:e=!1,onClick:t})=>{const s=W(),n=g.exports.useMemo(()=>fn(i)&&i>0?r("span",{className:T("raise-hand-red-dot",{"is-large":i>9}),children:i<10?i:"9+"}):null,[i]);return b("button",{className:"raise-hand-btn",title:s("raise-your-hand"),onClick:t,children:[r(at,{active:e}),n]})};function pn(i,e,t,s){return i.addEventListener(e,t,s),()=>i.removeEventListener(e,t,s)}var De=pn;const Ae=i=>{i.stopPropagation(),i.cancelable&&i.preventDefault()},wn=({mode:i,rect:e,zIndex:t,readonly:s,children:n,onClick:a,onResize:o,onDoubleClick:l,onDragging:c,onDragEnd:h})=>{const p=g.exports.useRef({t:0,x:-100,y:-100}),u=g.exports.useRef([]);g.exports.useEffect(()=>()=>{u.current.forEach(f=>f()),u.current=[]},[]);const d=f=>{var k;if(!f.isPrimary||s||f.button!==0)return;const w=f.target;for(let y=w;y&&y!==f.currentTarget;y=y.parentElement)if(y.tagName==="BUTTON")return;const v=Date.now();if(v-p.current.t<=500){Math.abs(p.current.x-f.clientX)<=5&&Math.abs(p.current.y-f.clientY)<=5&&(l==null||l());return}p.current={t:v,x:f.clientX,y:f.clientY};const S=f.currentTarget.parentElement;Ae(f),w.setPointerCapture(f.pointerId),S.classList.add("window-grabbing");const U=(k=w.dataset)==null?void 0:k.windowHandle,{pageX:C,pageY:D}=f,E=y=>{if(!y.isPrimary||s)return;Ae(y);const{pageX:I,pageY:L}=y,_=I-C,H=L-D;let{x:G,y:Y,width:x,height:M}=e;switch(U){case"n":{Y=e.y+H,M=e.height-H;break}case"s":{M=e.height+H;break}case"w":{G=e.x+_,x=e.width-_;break}case"e":{x=e.width+_;break}case"nw":{G=e.x+_,Y=e.y+H,x=e.width-_,M=e.height-H;break}case"ne":{Y=e.y+H,x=e.width+_,M=e.height-H;break}case"sw":{G=e.x+_,x=e.width-_,M=e.height+H;break}case"se":{x=e.width+_,M=e.height+H;break}default:{G=e.x+_,Y=e.y+H;break}}c==null||c(y),o==null||o({x:G,y:Y,width:x,height:M},U)},R=y=>{!y.isPrimary||(w.releasePointerCapture(y.pointerId),Ae(y),h==null||h(y),u.current.forEach(I=>I()),u.current=[])};u.current.push(()=>S.classList.remove("window-grabbing"),De(window,"pointermove",E,{passive:!1}),De(window,"pointerup",R,{passive:!1}),De(window,"pointercancel",R,{passive:!1}))};return b("div",{className:T("window",{"window-readonly":s,"window-maximized":i==="maximized"}),draggable:!s&&i==="maximized",style:i==="normal"?{position:"absolute",width:e.width|0,height:e.height|0,transform:`translate(${e.x|0}px,${e.y|0}px)`,zIndex:t}:void 0,children:[r("div",{className:"window-main",onClick:a,onPointerDown:d,children:n}),b("div",{className:"window-resize-handles",onPointerDown:d,children:[r("div",{className:"window-n window-resize-handle","data-window-handle":"n"}),r("div",{className:"window-s window-resize-handle","data-window-handle":"s"}),r("div",{className:"window-w window-resize-handle","data-window-handle":"w"}),r("div",{className:"window-e window-resize-handle","data-window-handle":"e"}),r("div",{className:"window-nw window-resize-handle","data-window-handle":"nw"}),r("div",{className:"window-ne window-resize-handle","data-window-handle":"ne"}),r("div",{className:"window-sw window-resize-handle","data-window-handle":"sw"}),r("div",{className:"window-se window-resize-handle","data-window-handle":"se"})]})]})},Le=(i,e,t)=>i<e?e:i>t?t:i,vn=(i,e,t,s,n,a)=>{const{x:o,y:l,width:c,height:h}=i,p=h/t,u=c*t;let d;if(!e||e==="e"||e==="w")d={x:o,y:l,width:c,height:u};else if(e==="s"||e==="n")d={x:o,y:l,width:p,height:h};else if(u<h){const f=e==="ne"||e==="nw"?l+h-u:l;d={x:o,y:f,width:c,height:u}}else d={x:e==="nw"||e==="sw"?o+c-p:o,y:l,width:p,height:h};if(!(s<=d.width&&d.width<=n&&d.height<=a)){const f=Le(d.width,s,Math.min(n,a/t)),w=f*t;(e==="w"||e==="sw"||e==="nw")&&(d.x=o+c-f),(e==="n"||e==="ne"||e==="nw")&&(d.y=l+h-w),d.width=f,d.height=w}return d.x=Le(d.x,0,n-d.width),d.y=Le(d.y,0,a-d.height),d},wr=N(({loading:i,isRecording:e,onClick:t})=>{const s=W();return r(We,{disabled:i,icon:e?r(Hi,{active:!0}):r(Li,{}),title:s("recording"),onClick:t})}),Sn=li(Mi,1),He=i=>String(i).padStart(2,"0"),bn=(i,e)=>{const[t,s]=g.exports.useState(Date.now()),n=Ft();return g.exports.useEffect(()=>{let a=NaN;if(!n.current){if(e===Re.Started){const o=()=>{s(Math.floor(Date.now()/1e3)*1e3),a=window.requestAnimationFrame(o)};o()}return()=>{window.cancelAnimationFrame(a)}}},[e,n]),g.exports.useMemo(()=>{const{days:a=0,hours:o=0,minutes:l=0,seconds:c=0}=Sn({start:i,end:t}),h=`${He(l)}:${He(c)}`,p=o+a*24;return p>0?`${He(p)}:${h}`:h},[i,t])},vr=({roomStatus:i=Re.Paused,beginTime:e})=>{const t=bn(e,i),s=W();return b("span",{className:"timer-bar",children:[r("span",{className:`timer-${i}`,children:s("room-started")}),r("span",{className:"timer-text",children:t})]})},Un=Se.memo(function(e){const t=Ee(),s=g.exports.useRef(null);return g.exports.useEffect(()=>{t(xn(e.image)).then(n=>{const a=s.current;a&&Cn(a,n,e.width,e.height)}).catch(console.error)},[e.height,e.image,e.width,t]),r("canvas",{ref:s})});function Cn(i,e,t,s){i.width=t,i.height=s;const n=i.getContext("2d");if(n){const a=e.width/e.height;if(a>1){const o=s/a;n.drawImage(e,0,(s-o)/2,t,o)}else{const o=t*a;n.drawImage(e,(t-o)/2,0,o,s)}}}function xn(i){return new Promise((e,t)=>{const s=new Image;s.onload=()=>e(s),s.onerror=t,s.src=i})}const yn=280,Dn=200,In=({visible:i,images:e,onClick:t,onClose:s})=>{const n=W();return r(Q,{closable:!0,footer:null,open:i,title:n("presets.title"),width:640,wrapClassName:"presets-modal-container",onCancel:s,children:e.map(({src:a,i18nKey:o})=>b("div",{className:"presets-modal-item",children:[b("button",{className:"presets-modal-btn",title:n(o),onClick:()=>t(a),children:[r(Un,{height:Dn,image:a,width:yn}),r("div",{className:"presets-modal-mask",children:r(Ai,{})})]}),r("div",{className:"presets-modal-text",children:n(o)})]},o))})},kn="data:image/svg+xml;charset=utf8,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 40 40'%3e%3ccircle cx='20' cy='20' r='19.5' stroke='white'/%3e%3cpath fill='white' d='M8 8h24v24H8z' opacity='.01'/%3e%3cpath fill='white' d='M15 16.375h-1v1.25h1v-1.25ZM12.375 18v8h1.25v-8h-1.25ZM14 27.625h12v-1.25H14v1.25ZM27.625 26v-8h-1.25v8h1.25ZM26 16.375h-1v1.25h1v-1.25ZM27.625 18c0-.898-.727-1.625-1.625-1.625v1.25c.207 0 .375.168.375.375h1.25ZM26 27.625c.898 0 1.625-.727 1.625-1.625h-1.25a.375.375 0 0 1-.375.375v1.25ZM12.375 26c0 .898.727 1.625 1.625 1.625v-1.25a.375.375 0 0 1-.375-.375h-1.25ZM14 16.375c-.898 0-1.625.727-1.625 1.625h1.25c0-.207.168-.375.375-.375v-1.25Z'/%3e%3cpath stroke='white' stroke-linejoin='round' stroke-width='1.25' d='M20 13v9m-3-3 3 3 3-3'/%3e%3c/svg%3e";function Nn(i,e="annotation.png",t="Save image failed"){try{const s=document.createElement("a");s.download=e,s.href=i.toDataURL(),s.click()}catch(s){console.error(s),A.error(t)}}const Mn=({visible:i,onClose:e,images:t})=>{const s=W();return r(Q,{closable:!0,destroyOnClose:!0,footer:null,open:i,title:s("annotation.save-action"),width:640,wrapClassName:"save-annotation-modal-container",onCancel:e,children:t.map((n,a)=>r(En,{failText:s("annotation.save-failed"),filename:`annotation-${a+1}.png`,footerText:String(a+1),image:n},a))})},En=Se.memo(function({image:e,filename:t="annotation.png",footerText:s,failText:n="Save image failed"}){const a=Ee(),o=W(),l=g.exports.useRef(null),[c,h]=g.exports.useState(!0),[p,u]=g.exports.useState(null);g.exports.useEffect(()=>{a(e).then(f=>{u(f),h(!1)})},[e,a]),g.exports.useEffect(()=>{const f=l.current;!f||(p?f.appendChild(p):f.firstChild&&f.removeChild(f.firstChild))},[p]);const d=g.exports.useCallback(()=>{p&&Nn(p,t,n)},[p,n,t]);return b("div",{className:T("save-annotation",{"is-loading":!p}),title:o("save"),onClick:d,children:[c&&r("div",{className:"save-annotation-loader",children:r(zt,{indicator:r(Ht,{spin:!0}),size:"large"})}),r("div",{ref:l,className:"save-annotation-image"}),r("div",{className:"save-annotation-mask"}),r("div",{className:"save-annotation-actions",children:r("img",{alt:"download",src:kn,title:o("save")})}),r("div",{className:"save-annotation-footer",children:s})]})}),Rn=N(function({ownerUUID:e,userUUID:t,users:s,roomInfo:n,getDeviceState:a,getVolumeLevel:o,onOffStageAll:l,onMuteAll:c,onStaging:h,onWhiteboard:p,onDeviceState:u}){const d=W(),f=e===t;return b("div",{className:"users-panel",children:[b("div",{className:"users-panel-headline",children:[n&&b(se,{children:[r("span",{className:"users-panel-headline-avatar",children:r("img",{src:n.ownerAvatarURL})}),b("span",{className:"users-panel-headline-name",children:[d("teacher"),": "]}),r("span",{className:"users-panel-headline-name",children:n.ownerName})]}),r("span",{className:"users-panel-splitter"}),f&&b(se,{children:[r(te,{className:"users-panel-btn",onClick:l,children:d("all-off-stage")}),r(te,{className:"users-panel-btn",onClick:c,children:d("all-mute-mic")})]})]}),b("div",{className:"users-panel-list-wrapper",children:[b("table",{className:"users-panel-list",children:[r("thead",{children:b("tr",{children:[b("th",{children:[d("members")," (",s.length,")"]}),r("th",{children:d("staging")}),r("th",{children:d("whiteboard-access")}),r("th",{children:d("camera")}),r("th",{children:d("microphone")}),b("th",{children:[d("raised-hand")," (",s.filter(w=>w.isRaiseHand).length,")"]})]})}),r("tbody",{className:"users-panel-items",children:s.map(w=>r(Tn,{getDeviceState:a,getVolumeLevel:o,isCreator:f,t:d,user:w,userUUID:t,onDeviceState:u,onStaging:h,onWhiteboard:p},w.userUUID))})]}),s.length===0&&r("div",{className:"users-panel-list-empty",children:d("no-students")})]})]})}),Tn=N(function({t:e,isCreator:t,userUUID:s,user:n,getDeviceState:a,getVolumeLevel:o,onStaging:l,onWhiteboard:c,onDeviceState:h}){const[p,u]=g.exports.useState(!1),[d,f]=g.exports.useState(!1),w=g.exports.useCallback(()=>(o==null?void 0:o(n.userUUID))||0,[o,n.userUUID]);g.exports.useEffect(()=>{if(a){const S=setInterval(()=>{const{camera:U,mic:C}=a(n.userUUID);u(U),f(C)},500);return()=>clearInterval(S)}},[a,n.userUUID]);const v=s===n.userUUID;return b("tr",{className:"users-panel-list-item",children:[r("td",{children:b("span",{className:"users-panel-list-avatar-name",children:[r("span",{className:"users-panel-list-avatar",children:r("img",{src:n.avatar})}),n.hasLeft?b("div",{className:"users-panel-list-name-wrapper",children:[b("span",{className:"users-panel-list-name",children:[r("span",{className:"users-panel-list-name-content",children:n.name}),v&&r("span",{className:"users-panel-is-self",children:e("me")})]}),r("span",{className:"users-panel-list-has-left",children:e("has-left")})]}):b("span",{className:"users-panel-list-name",children:[r("span",{className:"users-panel-list-name-content",children:n.name}),v&&r("span",{className:"users-panel-is-self",children:e("me")})]})]})}),r("td",{children:r(pt,{checked:n.hasLeft||n.isSpeak,disabled:!(t||v&&n.isSpeak),onChange:S=>l==null?void 0:l(n.userUUID,S)})}),r("td",{children:r(pt,{checked:n.wbOperate,disabled:!(t||v&&n.wbOperate),onChange:S=>c==null?void 0:c(n.userUUID,S)})}),r("td",{children:n.isSpeak&&a?r("button",{className:"users-panel-media-btn is-camera",disabled:!(v||t),onClick:()=>h==null?void 0:h(n.userUUID,!p,d),children:p?r(jt,{active:!0}):r(Gt,{})}):r("span",{className:"users-panel-media-off",children:"--"})}),r("td",{children:n.isSpeak&&a?r("button",{className:T("users-panel-media-btn is-mic",{"is-muted":!d}),disabled:!(v||t),onClick:()=>h==null?void 0:h(n.userUUID,p,!d),children:d?r(qt,{getVolumeLevel:w}):r(Yt,{})}):r("span",{className:"users-panel-media-off",children:"--"})}),r("td",{className:"users-panel-btn-group",children:n.isRaiseHand?t?b(se,{children:[r(te,{className:"users-panel-small-btn is-ok",disabled:!t,size:"small",type:"link",onClick:()=>t&&(l==null?void 0:l(n.userUUID,!0)),children:e("agree")}),r("span",{className:T("users-panel-small-btn-splitter",{"is-disabled":!t}),children:"/"}),r(te,{className:"users-panel-small-btn is-cancel",disabled:!t,size:"small",type:"link",onClick:()=>t&&(l==null?void 0:l(n.userUUID,!1)),children:e("cancel")})]}):r(at,{className:"users-panel-small-btn is-hand"}):r("span",{className:"users-panel-media-off",children:"--"})})]})});class Wn{constructor(e){m(this,"roomUUID");m(this,"userUUID");m(this,"ownerUUID");m(this,"cachedUsers",j.map());m(this,"creator",null);m(this,"currentUser",null);m(this,"speakingJoiners",j.array([]));m(this,"handRaisingJoiners",j.array([]));m(this,"otherJoiners",j.array([]));m(this,"isInRoom");m(this,"initUsers",async e=>{this.otherJoiners.clear(),this.speakingJoiners.clear(),this.handRaisingJoiners.clear(),(await this.createUsers(e)).forEach(s=>{this.sortUser(s),this.cacheUser(s)})});m(this,"addUser",async e=>{this.cachedUsers.has(e)&&this.removeUser(e);const[t]=await this.createUsers([e]);return this.cacheUser(t),this.sortUser(t),t});m(this,"removeUser",e=>{if(this.creator&&this.creator.userUUID===e)this.creator.hasLeft=!0,this.creator=null;else for(const{group:t}of this.joinerGroups)for(let s=0;s<this[t].length;s++)if(this[t][s].userUUID===e){this[t][s].hasLeft=!0,this[t].splice(s,1);break}});m(this,"updateUsers",e=>{const t=we("editUser",e),s=[];let n=!1;this.creator&&(n=t(this.creator)===!1);for(const{group:a,shouldMoveOut:o}of this.joinerGroups){if(n)break;for(let l=0;l<this[a].length&&!n;l++){const c=this[a][l];n=t(c)===!1,o(c)&&(this[a].splice(l,1),l--,s.push(c))}}s.forEach(this.sortUser)});m(this,"syncExtraUsersInfo",async e=>{const t=await this.createUsers(e.filter(s=>!this.cachedUsers.has(s)));for(const s of t)this.cacheUser(s)});m(this,"pickRandomJoiner",()=>{const e=Math.floor(Math.random()*this.joiners.length);for(let t=0;t<this.joiners.length;t++){const s=this.joiners[(e+t)%this.joiners.length];if(s&&s.userUUID!==this.userUUID)return s}});m(this,"sortUser",e=>{if(e.userUUID===this.userUUID&&(this.currentUser=e),e.userUUID===this.ownerUUID)this.creator=e;else if(e.isSpeak){const t=this.speakingJoiners.findIndex(({userUUID:s})=>s===e.userUUID);t>=0&&this.speakingJoiners.splice(t,1),this.speakingJoiners.push(e)}else if(e.isRaiseHand){const t=this.handRaisingJoiners.findIndex(({userUUID:s})=>s===e.userUUID);t>=0&&this.handRaisingJoiners.splice(t,1),this.handRaisingJoiners.push(e)}else this.otherJoiners.push(e)});m(this,"joinerGroups",[{group:"speakingJoiners",shouldMoveOut:e=>!e.isSpeak},{group:"handRaisingJoiners",shouldMoveOut:e=>!e.isRaiseHand},{group:"otherJoiners",shouldMoveOut:e=>e.isRaiseHand||e.isSpeak}]);this.roomUUID=e.roomUUID,this.userUUID=e.userUUID,this.ownerUUID=e.ownerUUID,this.isInRoom=e.isInRoom,Te(this)}get joiners(){return[...this.speakingJoiners,...this.handRaisingJoiners,...this.otherJoiners]}get totalUserCount(){return(this.creator?1:0)+(this.speakingJoiners.length+this.handRaisingJoiners.length+this.otherJoiners.length)}get isCreator(){return this.ownerUUID===this.userUUID}cacheUser(e){this.cachedUsers.set(e.userUUID,e)}async createUsers(e){if(e=[...new Set(e)],e.length<=0)return[];const t=await Is({roomUUID:this.roomUUID,usersUUID:e});return e.map(s=>j.object({userUUID:s,rtcUID:String(t[s].rtcUID),avatar:t[s].avatarURL,name:t[s].name,camera:s===this.userUUID?ne.autoCameraOn:!1,mic:s===this.userUUID?ne.autoMicOn:!1,isSpeak:s===this.userUUID&&this.isCreator,wbOperate:s===this.userUUID&&this.isCreator,isRaiseHand:!1,hasLeft:!this.isInRoom(s)}))}}class _n{constructor(e){m(this,"sideEffect",new Qe);m(this,"messages",j.array([]));m(this,"rtm");m(this,"newMessage",e=>{const t=Date.now();let s=0;for(;s<this.messages.length&&this.messages[s].timestamp<=t;)s++;this.messages.splice(s,0,e),this.onNewMessage(e)});this.rtm=e.rtm,Te(this,{rtm:j.ref,sideEffect:!1}),e.isShowUserGuide&&this.messages.every(t=>t.type!=="user-guide")&&ee(()=>{this.messages.push({type:"user-guide",uuid:"user-guide",timestamp:Date.now(),roomUUID:e.roomUUID,senderID:e.ownerUUID})}),this.sideEffect.addDisposer(this.rtm.events.on("room-message",t=>{this.newMessage({type:"room-message",...t})})),this.sideEffect.addDisposer(this.rtm.events.on("notice",t=>{this.newMessage({type:"notice",...t})})),this.sideEffect.addDisposer(this.rtm.events.on("ban",t=>{this.newMessage({type:"ban",...t})}))}destroy(){this.sideEffect.flushAll()}onNewMessage(e){}}let Oe,St=!0,bt=!0;class Fe{constructor(e,t,s,n){const{readable:a,writable:o}=t,{options:l,config:c,streamOptions:h,useWebWorkers:p,transferStreams:u,scripts:d}=s;Object.assign(e,{busy:!0,readable:a,writable:o,options:Object.assign({},l),scripts:d,transferStreams:u,terminate(){e.worker&&!e.busy&&(e.worker.terminate(),e.interface=null)},onTaskFinished(){e.busy=!1,n(e)}});const{signal:f,onstart:w,onprogress:v,size:S,onend:U}=h;let C=0;const D={};return w&&(D.start=()=>Ze(w,S)),D.transform=async(E,R)=>{C+=E.length,v&&await Ze(v,C,S),R.enqueue(E)},D.flush=()=>{a.size=C,U&&Ze(U,C)},e.readable=a.pipeThrough(new TransformStream(D,{highWaterMark:1,size:()=>c.chunkSize}),{signal:f}),Oe===void 0&&(Oe=typeof Worker<"u"),p&&Oe?An(e,c):Pn(e,c)}}async function Ze(i,...e){try{await i(...e)}catch{}}function Pn(i,e){const t=new ks(i.readable,i.writable,i.options,e),{onTaskFinished:s}=i;return{async run(){try{return await t.run()}finally{s()}}}}function An(i,{baseURL:e,chunkSize:t}){const s={type:"module"};if(Object.assign(i,{streams:{},result:new Promise((c,h)=>{i.resolveResult=c,i.rejectResult=h})}),!i.interface){if(!St)i.worker=a(s);else try{i.worker=a({})}catch{St=!1,i.worker=a(s)}i.worker.addEventListener(Ns,l,!1),i.interface={run(){const{readable:c,writable:h,options:p}=i,u=i.scripts.slice(1),d={type:Ts,scripts:u,options:p,config:{chunkSize:t}};return i.transferStreams&&bt?o({...d,readable:c,writable:h})||(bt=!1,n(c,h)):(o(d),n(c,h)),i.result}}}return i.interface;function n(c,h){Object.assign(i.streams,{reader:c.getReader(),writer:h.getWriter()})}function a(c){let h,p;h=i.scripts[0],typeof h=="function"&&(h=h());try{p=new URL(h,e)}catch{p=h}return new Worker(p,c)}function o(c){const{worker:h,writer:p,onTaskFinished:u}=i;try{let{data:d,readable:f,writable:w}=c;const v=[];if(d){const{buffer:S,length:U}=d;U!=S.byteLength&&(d=new Uint8Array(d)),c.data=d.buffer,v.push(c.data)}if(f&&v.push(f),w&&v.push(w),v.length)try{return h.postMessage(c,v),!0}catch{c.readable=c.writable=null,h.postMessage(c)}else h.postMessage(c)}catch(d){throw p&&p.releaseLock(),u(),d}}async function l(c){const h=c.data,{resolveResult:p,rejectResult:u,onTaskFinished:d}=i,{reader:f,writer:w}=i.streams,{type:v,data:S,messageId:U,result:C}=h,D=h.error;try{if(D){const{message:R,stack:k,code:y,name:I}=D,L=new Error(R);Object.assign(L,{stack:k,code:y,name:I}),E(L)}else{if(v==Ms){const{value:R,done:k}=await f.read();o({type:dt,data:R,done:k,messageId:U})}v==dt&&(await w.ready,await w.write(new Uint8Array(S)),o({type:Es,messageId:U})),v==Rs&&E(null,C)}}catch(R){E(R)}function E(R,k){R?u(R):p(k),w&&w.releaseLock(),d()}}}let oe=[];const Ve=[];let Ut=0;async function Ln(i,e){const{options:t,config:s}=e,{transferStreams:n,useWebWorkers:a,useCompressionStream:o,codecType:l,compressed:c,signed:h,encrypted:p}=t,{workerScripts:u}=s;e.transferStreams=n||n===void 0;const d=!c&&!h&&!p&&!e.transferStreams;e.useWebWorkers=!d&&(a||a===void 0&&s.useWebWorkers),e.scripts=e.useWebWorkers&&u?u[l]:[],t.useCompressionStream=o||o===void 0&&s.useCompressionStream;let f;if(oe.length<s.maxWorkers){const v={indexWorker:Ut};Ut++,oe.push(v),f=new Fe(v,i,e,w)}else{const v=oe.find(S=>!S.busy);v?(Ct(v),f=new Fe(v,i,e,w)):f=await new Promise(S=>Ve.push({resolve:S,stream:i,workerOptions:e}))}return f.run();function w(v){if(Ve.length){const[{resolve:S,stream:U,workerOptions:C}]=Ve.splice(0,1);S(new Fe(v,U,C,w))}else if(v.worker){const{terminateWorkerTimeout:S}=s;Ct(v),Number.isFinite(S)&&S>=0&&(v.terminateTimeout=setTimeout(()=>{oe=oe.filter(U=>U!=v),v.terminate()},S))}else oe=oe.filter(S=>S!=v)}}function Ct(i){const{terminateTimeout:e}=i;e&&(clearTimeout(e),i.terminateTimeout=null)}const Hn=64*1024;class Jt{constructor(){this.size=0}init(){this.initialized=!0}}class On extends Jt{get readable(){const e=this,{chunkSize:t=Hn}=e,s=new ReadableStream({start(){this.chunkOffset=0},async pull(n){const{offset:a=0,size:o}=s,{chunkOffset:l}=this;n.enqueue(await e.readUint8Array(a+l,Math.min(t,o-l))),l+t>o?n.close():this.chunkOffset+=t}});return s}}class Xt extends On{constructor(e){super(),this.blob=e,this.size=e.size}async readUint8Array(e,t){const s=this;return new Uint8Array(await s.blob.slice(e,e+t).arrayBuffer())}}class Fn extends Jt{constructor(e){super();const t=this,s=new TransformStream,n=[];e&&n.push(["content-type",e]),Object.defineProperty(t,"writable",{get(){return s.writable}}),t.blob=new Response(s.readable,{headers:n}).blob()}getData(){return this.blob}}async function Kt(i,e){i.init&&!i.initialized&&await i.init(e)}const Ne=4294967295,xt=65535,Zn=8,Vn=0,zn=99,Bn=67324752,yt=33639248,$n=101010256,Dt=101075792,jn=117853008,xe=22,ze=20,Be=56,Gn=1,Yn=39169,qn=10,Jn=1,Xn=21589,Kn=28789,Qn=25461,It=1,ea=6,kt=8,Nt=2048,Mt=16,ta="/";function Je(i,e){return e&&e.trim().toLowerCase()=="cp437"?Ws(i):new TextDecoder(e).decode(i)}const sa=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"];class Et{constructor(e){sa.forEach(t=>this[t]=e[t])}}const $e="File format is not recognized",ia="End of central directory not found",na="End of Zip64 central directory not found",aa="End of Zip64 central directory locator not found",ra="Central directory header not found",oa="Local file header not found",ca="Zip64 extra field not found",la="File contains encrypted entry",da="Encryption method not supported",Rt="Compression method not supported",Tt="utf-8",Wt="cp437",_t=["uncompressedSize","compressedSize","offset"];class ha{constructor(e,t={}){e instanceof ReadableStream&&(e={readable:e}),Object.assign(this,{reader:e,options:t,config:_s()})}async*getEntriesGenerator(e={}){const t=this;let{reader:s}=t;const{config:n}=t;if(await Kt(s),s.size===void 0||!s.readUint8Array){const k=await new Response(s.readable).blob();s=new Xt(k)}if(s.size<xe)throw new Error($e);s.chunkSize=Ps(n);const a=await wa(s,$n,s.size,xe,xt*16);if(!a)throw new Error(ia);const o=B(a);let l=Z(o,12),c=Z(o,16);const h=a.offset,p=$(o,20),u=h+xe+p;let d=$(o,8),f=0,w=0;if(c==Ne||l==Ne||d==xt){const k=await X(s,a.offset-ze,ze),y=B(k);if(Z(y,0)!=jn)throw new Error(na);c=Ie(y,8);let I=await X(s,c,Be),L=B(I);const _=a.offset-ze-Be;if(Z(L,0)!=Dt&&c!=_){const H=c;c=_,f=c-H,I=await X(s,c,Be),L=B(I)}if(Z(L,0)!=Dt)throw new Error(aa);d=Ie(L,32),l=Ie(L,40),c-=l}if(c<0||c>=s.size)throw new Error($e);let v=0,S=await X(s,c,l),U=B(S);if(l){const k=a.offset-l;if(Z(U,v)!=yt&&c!=k){const y=c;c=k,f=c-y,S=await X(s,c,l),U=B(S)}}if(c<0||c>=s.size)throw new Error($e);const C=K(t,e,"filenameEncoding"),D=K(t,e,"commentEncoding");for(let k=0;k<d;k++){const y=new ua(s,n,t.options);if(Z(U,v)!=yt)throw new Error(ra);Qt(y,U,v+6);const I=Boolean(y.bitFlag.languageEncodingFlag),L=v+46,_=L+y.filenameLength,H=_+y.extraFieldLength,G=$(U,v+4),Y=(G&0)==0,x=S.subarray(L,_),M=$(U,v+32),z=H+M,ae=S.subarray(H,z),de=I,he=I,ue=Y&&(me(U,v+38)&Mt)==Mt,be=Z(U,v+42)+f;Object.assign(y,{versionMadeBy:G,msDosCompatible:Y,compressedSize:0,uncompressedSize:0,commentLength:M,directory:ue,offset:be,internalFileAttribute:$(U,v+36),externalFileAttribute:Z(U,v+38),rawFilename:x,filenameUTF8:de,commentUTF8:he,rawExtraField:S.subarray(_,H)});const[Ue,_e]=await Promise.all([Je(x,de?Tt:C||Wt),Je(ae,he?Tt:D||Wt)]);Object.assign(y,{rawComment:ae,filename:Ue,comment:_e,directory:ue||Ue.endsWith(ta)}),w=Math.max(be,w),await es(y,y,U,v+6);const Pe=new Et(y);Pe.getData=(ot,ts)=>y.getData(ot,Pe,ts),v=z;const{onprogress:rt}=e;if(rt)try{await rt(k+1,d,new Et(y))}catch{}yield Pe}const E=K(t,e,"extractPrependedData"),R=K(t,e,"extractAppendedData");return E&&(t.prependedData=w>0?await X(s,0,w):new Uint8Array),t.comment=p?await X(s,h+xe,p):new Uint8Array,R&&(t.appendedData=u<s.size?await X(s,u,s.size-u):new Uint8Array),!0}async getEntries(e={}){const t=[];for await(const s of this.getEntriesGenerator(e))t.push(s);return t}async close(){}}class ua{constructor(e,t,s){Object.assign(this,{reader:e,config:t,options:s})}async getData(e,t,s={}){const n=this,{reader:a,offset:o,extraFieldAES:l,compressionMethod:c,config:h,bitFlag:p,signature:u,rawLastModDate:d,uncompressedSize:f,compressedSize:w}=n,v=n.localDirectory={};let S=await X(a,o,30);const U=B(S);let C=K(n,s,"password");if(C=C&&C.length&&C,l&&l.originalCompressionMethod!=zn)throw new Error(Rt);if(c!=Vn&&c!=Zn)throw new Error(Rt);if(Z(U,0)!=Bn)throw new Error(oa);Qt(v,U,4),S=await X(a,o,30+v.filenameLength+v.extraFieldLength),v.rawExtraField=S.subarray(30+v.filenameLength),await es(n,v,U,4),Object.assign(t,{lastAccessDate:v.lastAccessDate,creationDate:v.creationDate});const D=n.encrypted&&v.encrypted,E=D&&!l;if(D){if(!E&&l.strength===void 0)throw new Error(da);if(!C)throw new Error(la)}const R=o+30+v.filenameLength+v.extraFieldLength,k=a.readable;k.offset=R;const y=k.size=w;e instanceof WritableStream&&(e={writable:e});const{writable:I}=e;I.size===void 0&&(I.size=0);const L=K(n,s,"signal"),_=K(n,s,"preventClose");await Kt(e,f);const{onstart:H,onprogress:G,onend:Y}=s,x={options:{codecType:As,password:C,zipCrypto:E,encryptionStrength:l&&l.strength,signed:K(n,s,"checkSignature"),passwordVerification:E&&(p.dataDescriptor?d>>>8&255:u>>>24&255),signature:u,compressed:c!=0,encrypted:D,useWebWorkers:K(n,s,"useWebWorkers"),useCompressionStream:K(n,s,"useCompressionStream"),transferStreams:K(n,s,"transferStreams"),preventClose:_},config:h,streamOptions:{signal:L,size:y,onstart:H,onprogress:G,onend:Y}};if(I.size+=(await Ln({readable:k,writable:I},x)).size,!_)try{await I.close()}catch{}return e.getData?e.getData():I}}function Qt(i,e,t){const s=i.rawBitFlag=$(e,t+2),n=(s&It)==It,a=Z(e,t+6);Object.assign(i,{encrypted:n,version:$(e,t),bitFlag:{level:(s&ea)>>1,dataDescriptor:(s&kt)==kt,languageEncodingFlag:(s&Nt)==Nt},rawLastModDate:a,lastModDate:va(a),filenameLength:$(e,t+22),extraFieldLength:$(e,t+24)})}async function es(i,e,t,s){const{rawExtraField:n}=e,a=e.extraField=new Map,o=B(new Uint8Array(n));let l=0;try{for(;l<n.length;){const v=$(o,l),S=$(o,l+2);a.set(v,{type:v,data:n.slice(l+4,l+4+S)}),l+=4+S}}catch{}const c=$(t,s+4);Object.assign(e,{signature:Z(t,s+10),uncompressedSize:Z(t,s+18),compressedSize:Z(t,s+14)});const h=a.get(Gn);h&&(fa(h,e),e.extraFieldZip64=h);const p=a.get(Kn);p&&(await Pt(p,"filename","rawFilename",e,i),e.extraFieldUnicodePath=p);const u=a.get(Qn);u&&(await Pt(u,"comment","rawComment",e,i),e.extraFieldUnicodeComment=u);const d=a.get(Yn);d?(ma(d,e,c),e.extraFieldAES=d):e.compressionMethod=c;const f=a.get(qn);f&&(ga(f,e),e.extraFieldNTFS=f);const w=a.get(Xn);w&&(pa(w,e),e.extraFieldExtendedTimestamp=w)}function fa(i,e){e.zip64=!0;const t=B(i.data);i.values=[];for(let n=0;n<Math.floor(i.data.length/8);n++)i.values.push(Ie(t,0+n*8));const s=_t.filter(n=>e[n]==Ne);for(let n=0;n<s.length;n++)i[s[n]]=i.values[n];_t.forEach(n=>{if(e[n]==Ne)if(i[n]!==void 0)e[n]=i[n];else throw new Error(ca)})}async function Pt(i,e,t,s,n){const a=B(i.data),o=new Ls;o.append(n[t]);const l=B(new Uint8Array(4));l.setUint32(0,o.get(),!0),Object.assign(i,{version:me(a,0),signature:Z(a,1),[e]:await Je(i.data.subarray(5)),valid:!n.bitFlag.languageEncodingFlag&&i.signature==Z(l,0)}),i.valid&&(s[e]=i[e],s[e+"UTF8"]=!0)}function ma(i,e,t){const s=B(i.data),n=me(s,4);Object.assign(i,{vendorVersion:me(s,0),vendorId:me(s,2),strength:n,originalCompressionMethod:t,compressionMethod:$(s,5)}),e.compressionMethod=i.compressionMethod}function ga(i,e){const t=B(i.data);let s=4,n;try{for(;s<i.data.length&&!n;){const a=$(t,s),o=$(t,s+2);a==Jn&&(n=i.data.slice(s+4,s+4+o)),s+=4+o}}catch{}try{if(n&&n.length==24){const a=B(n),o=a.getBigUint64(0,!0),l=a.getBigUint64(8,!0),c=a.getBigUint64(16,!0);Object.assign(i,{rawLastModDate:o,rawLastAccessDate:l,rawCreationDate:c});const h=je(o),p=je(l),u=je(c),d={lastModDate:h,lastAccessDate:p,creationDate:u};Object.assign(i,d),Object.assign(e,d)}}catch{}}function pa(i,e){const t=B(i.data),s=me(t,0),n=[],a=[];(s&1)==1&&(n.push("lastModDate"),a.push("rawLastModDate")),(s&2)==2&&(n.push("lastAccessDate"),a.push("rawLastAccessDate")),(s&4)==4&&(n.push("creationDate"),a.push("rawCreationDate"));let o=1;n.forEach((l,c)=>{if(i.data.length>=o+4){const h=Z(t,o);e[l]=i[l]=new Date(h*1e3);const p=a[c];i[p]=h}o+=4})}async function wa(i,e,t,s,n){const a=new Uint8Array(4),o=B(a);Sa(o,0,e);const l=s+n;return await c(s)||await c(Math.min(l,t));async function c(h){const p=t-h,u=await X(i,p,h);for(let d=u.length-s;d>=0;d--)if(u[d]==a[0]&&u[d+1]==a[1]&&u[d+2]==a[2]&&u[d+3]==a[3])return{offset:p+d,buffer:u.slice(d,d+s).buffer}}}function K(i,e,t){return e[t]===void 0?i.options[t]:e[t]}function va(i){const e=(i&4294901760)>>16,t=i&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(t&63488)>>11,(t&2016)>>5,(t&31)*2,0)}catch{}}function je(i){return new Date(Number(i/BigInt(1e4)-BigInt(116444736e5)))}function me(i,e){return i.getUint8(e)}function $(i,e){return i.getUint16(e,!0)}function Z(i,e){return i.getUint32(e,!0)}function Ie(i,e){return Number(i.getBigUint64(e,!0))}function Sa(i,e,t){i.setUint32(e,t,!0)}function B(i){return new DataView(i.buffer)}function X(i,e,t){return i.readUint8Array(e,t)}class Me{constructor(){m(this,"downloaders",new Map)}async preload(e){const t=Me.parsePPTURLInfo(e),{baseURL:s,pptType:n,taskUUID:a}=t;if(this.downloaders.has(a))return;const o=await Si(t);this.downloaders.set(a,o);const l=`${s}/${n}Convert`;return Me.unzip(o,l)}static parsePPTURLInfo(e){const t=/^(\S+)\/(static|dynamic)Convert\/([0-9a-f]{32})\//.exec(e);if(!t)throw new Error("parse ppt url failed.");const[,s,n,a]=t;return{baseURL:s.replace(/^pptx:\/\//,"https://"),pptType:n,taskUUID:a}}static async unzip(e,t){const n=await new ha(new Xt(e)).getEntries();for(const a of n){if(!a.getData||a.filename.endsWith(".mp4"))continue;const o=await a.getData(new Fn),l=`${t}/${a.filename}`;await this.cacheEntry(l,o)}}static async cacheEntry(e,t){const s=await Hs(),n=new Response(t,{headers:{"Content-Type":Os(e)}});s.put(e,n)}}const ba=new Me;class Ua{constructor(e){m(this,"sideEffect",new Qe);m(this,"whiteboard");m(this,"fastboardAPP",null);m(this,"room",null);m(this,"phase",ke.Connecting);m(this,"viewMode",null);m(this,"windowManager",null);m(this,"isWritable");m(this,"allowDrawing");m(this,"isShowPreviewPanel",!1);m(this,"isFileOpen",!1);m(this,"isKicked",!1);m(this,"isRightSideClose",!1);m(this,"currentSceneIndex",0);m(this,"scenesCount",0);m(this,"isCreator");m(this,"getRoomType");m(this,"onDrop");m(this,"cloudStorageStore");m(this,"updateFastboardAPP",e=>{this.fastboardAPP=e});m(this,"updateRoom",e=>{this.room=e});m(this,"updateWindowManager",e=>{this.windowManager=e});m(this,"updateWritable",e=>{this.isWritable=e,this.whiteboard.setIsWritable(e)});m(this,"updateAllowDrawing",e=>{this.allowDrawing=e,this.whiteboard.setAllowDrawing(e)});m(this,"setFileOpen",e=>{this.isFileOpen=e});m(this,"toggleFileOpen",()=>{this.isFileOpen=!this.isFileOpen});m(this,"showPreviewPanel",()=>{this.isShowPreviewPanel=!0});m(this,"setPreviewPanel",e=>{this.isShowPreviewPanel=e});m(this,"setRightSideClose",e=>{this.isRightSideClose=e});m(this,"preloadPPTResource",pi(async e=>{await ba.preload(e)},2e3));m(this,"insertCourseware",async e=>{var s;if(((s=e.meta.whiteboardConvert||e.meta.whiteboardProjector)==null?void 0:s.convertStep)===Vs.Converting){A.warn(F.t("in-the-process-of-transcoding-tips"));return}e.resourceType!==zs.Directory&&A.info(F.t("inserting-courseware-tips"));const t=await et.getInstance().requestService("file");if(!t){A.error(F.t("unable-to-insert-courseware"));return}await t.insert(e),this.cloudStorageStore.onCoursewareInserted&&this.cloudStorageStore.onCoursewareInserted()});this.whiteboard=e.whiteboard,this.isCreator=e.isCreator,this.isWritable=e.isWritable,this.allowDrawing=e.isWritable,this.getRoomType=e.getRoomType,this.onDrop=e.onDrop,Te(this,{room:j.ref,preloadPPTResource:!1,fastboardAPP:!1,sideEffect:!1,whiteboard:!1}),this.whiteboard.setIsWritable(this.isWritable),this.whiteboard.setAllowDrawing(this.isWritable),this.cloudStorageStore=new hi({compact:!0,insertCourseware:this.insertCourseware}),this.sideEffect.push([e.whiteboard.events.on("kicked",()=>{this.isCreator||ee(()=>{this.isKicked=!0})}),e.whiteboard.$Val.phase$.subscribe(()=>{const t=this.getRoom();t&&ee(()=>{this.phase=t.phase})})])}async joinWhiteboardRoom(){var n,a,o;if(!P.userUUID)throw new Error("Missing userUUID");if(!P.whiteboardRoomUUID||!P.whiteboardRoomToken)throw new Error("Missing Whiteboard UUID and Token");await this.whiteboard.joinRoom({roomID:P.whiteboardRoomUUID,roomToken:P.whiteboardRoomToken,region:(n=P.region)!=null?n:Fs.CN_HZ,uid:P.userUUID,nickName:(o=(a=P.userInfo)==null?void 0:a.name)!=null?o:P.userUUID,classroomType:this.getRoomType(),options:{strokeTail:ne.strokeTail,ratio:qe}});const e=await this.whiteboard._app$.value;this.updateFastboardAPP(e);const{room:t,manager:s}=e;return this.updateRoom(t),this.updateWindowManager(s),this.scrollToTopOnce(),e}scrollToTopOnce(){const{room:e,windowManager:t}=this;!e||!t||!e.isWritable||(!e.state.globalState||!e.state.globalState.scrollToTop)&&(e.setGlobalState({scrollToTop:!0}),t.moveCamera({centerY:-950,animationMode:Zs.Immediately}))}async destroy(){this.sideEffect.flushAll(),this.preloadPPTResource.cancel(),await this.whiteboard.destroy(),console.log(`Whiteboard unloaded: ${P.whiteboardRoomUUID}`)}getSaveAnnotationImages(){return this.whiteboard.exportAnnotations()}getRoom(){var e,t;return(t=(e=this.whiteboard._app$.value)==null?void 0:e.room)!=null?t:null}}var ce=(i=>(i.Lecture="Lecture",i.Interaction="Interaction",i))(ce||{}),le=(i=>(i[i.Null=0]="Null",i[i.Starting=1]="Starting",i[i.Pausing=2]="Pausing",i[i.Stopping=3]="Stopping",i))(le||{});class Ca{constructor(e){m(this,"sideEffect",new Qe);m(this,"roomUUID");m(this,"ownerUUID");m(this,"userUUID");m(this,"classMode");m(this,"isBan",!1);m(this,"isRecording",!1);m(this,"isRecordingLoading",!1);m(this,"isRemoteLogin",!1);m(this,"isRequestingCamera",!1);m(this,"isRequestingMic",!1);m(this,"isCloudStoragePanelVisible",!1);m(this,"isHandRaisingPanelVisible",!1);m(this,"isUsersPanelVisible",!1);m(this,"isDraggingAvatar",!1);m(this,"droppingUserUUID",null);m(this,"roomStatusLoading",le.Null);m(this,"isJoinedRTC",!1);m(this,"isScreenSharing",!1);m(this,"isRemoteScreenSharing",!1);m(this,"shareScreenInfo",[]);m(this,"selectedScreenInfo",null);m(this,"shareScreenPickerVisible",!1);m(this,"networkQuality",{delay:0,uplink:0,downlink:0});m(this,"userWindowsGrid",null);m(this,"userWindows",j.map());m(this,"userWindowsPortal",j.map());m(this,"deviceStateStorage");m(this,"classroomStorage");m(this,"onStageUsersStorage");m(this,"whiteboardStorage");m(this,"userWindowsStorage");m(this,"users");m(this,"onStageUserUUIDs",j.array());m(this,"rtc");m(this,"rtm");m(this,"chatStore");m(this,"whiteboardStore");m(this,"recording");m(this,"startClass",()=>this.switchRoomStatus(J.Started));m(this,"pauseClass",()=>this.switchRoomStatus(J.Paused));m(this,"stopClass",()=>this.switchRoomStatus(J.Stopped));m(this,"hangClass",async()=>{await new Promise(e=>setTimeout(e,200))});m(this,"toggleCloudStoragePanel",e=>{this.isCloudStoragePanelVisible=e});m(this,"toggleUsersPanel",(e=!this.isUsersPanelVisible)=>{this.isUsersPanelVisible=e});m(this,"onDragStart",()=>{this.isDraggingAvatar=!0});m(this,"onDragEnd",()=>{this.isDraggingAvatar=!1});m(this,"getPortal",e=>this.userWindowsPortal.get(e));m(this,"setPortal",(e,t)=>{t?this.userWindowsPortal.set(e,t):this.userWindowsPortal.delete(e)});m(this,"windowedUserUUIDs",()=>{if(!this.userWindowsStorage)return[];const e=this.userWindowsStorage.state,t=[];for(const s in e)s!=="grid"&&e[s]&&t.push(s);return t});m(this,"maxZOfUserWindows",e=>{if(!this.userWindowsStorage)return 0;const t=this.userWindowsStorage.state;let s=0;for(const n in t)n!=="grid"&&n!==e&&t[n]&&(s=Math.max(s,t[n].z));return s});m(this,"userHasLeft",e=>{var t,s;return(s=(t=this.users.cachedUsers.get(e))==null?void 0:t.hasLeft)!=null?s:!0});m(this,"toggleUserWindowsMode",e=>{this.isCreator&&this.userWindowsStorage&&((e||(this.userWindowsMode==="normal"?"maximized":"normal"))==="normal"?this.userWindowsStorage.setState({grid:null}):this.userWindowsStorage.setState({grid:this.windowedUserUUIDs()}))});m(this,"createAvatarWindow",(e,t)=>{if(this.isCreator&&this.userWindowsStorage)if(this.emptyArrayAsNull(this.userWindowsStorage.state.grid))this.createMaximizedAvatarWindow(e);else{const s=this.maxZOfUserWindows();this.userWindowsStorage.setState({[e]:{...t,z:s+1}})}});m(this,"createMaximizedAvatarWindow",e=>{if(this.isCreator&&this.userWindowsStorage){let t=this.userWindowsStorage.state.grid;(!t||t.length===0)&&(t=this.windowedUserUUIDs()),t.includes(e)||(t=[...t,e]),this.userWindowsStorage.setState({grid:t})}});m(this,"updateAvatarWindow",(e,t)=>{if(this.isCreator&&this.userWindowsStorage&&!this.userWindowsGrid){const s=this.maxZOfUserWindows(e),n={...t,z:s+1},a=this.userWindowsStorage.state[e];this.isWindowEqual(a,n)||this.userWindowsStorage.setState({[e]:n})}});m(this,"deleteAvatarWindow",e=>{var t;if((t=this.userWindowsStorage)!=null&&t.isWritable){this.userWindowsStorage.setState({[e]:void 0});let s=this.userWindowsStorage.state.grid;s&&s.includes(e)&&(s=s.filter(n=>n!==e),s.length===0&&(s=null),this.userWindowsStorage.setState({grid:s}))}});m(this,"setDroppingUserUUID",e=>{this.droppingUserUUID=e});m(this,"isDropTarget",e=>this.droppingUserUUID===e);m(this,"onDrop",e=>{this.toggleCloudStoragePanel(!0);const t=this.whiteboardStore.cloudStorageStore;t.setPanelExpand(!0),t.uploadTaskManager.addTasks([e],t.parentDirectoryPath)});m(this,"onMessageSend",async e=>{this.isBan&&!this.isCreator||!(await wi({text:e})).valid||await this.rtm.sendRoomMessage(e)});m(this,"toggleRecording",async({onStop:e}={})=>{this.isRecordingLoading=!0;try{this.isRecording?(await this.stopRecording(),e==null||e()):await this.startRecording()}catch(t){ge(t)}ee(()=>{this.isRecordingLoading=!1})});m(this,"updateRecordingLayout",e=>{this.isRecording&&this.recording.updateLayout(e)});m(this,"updateClassMode",e=>{var t;this.classMode=e!=null?e:((t=this.roomInfo)==null?void 0:t.roomType)===ie.SmallClass?ce.Interaction:ce.Lecture});m(this,"updateRoomStatus",e=>{this.roomInfo&&this.roomInfo.roomStatus!==e&&(this.roomInfo.roomStatus=e,this.isCreator&&this.rtm.sendRoomCommand("update-room-status",{roomUUID:this.roomUUID,status:e}))});m(this,"updateShareScreen",(e,t)=>{this.isScreenSharing=e,this.isRemoteScreenSharing=t});m(this,"refreshShareScreenInfo",async()=>{this.selectShareScreenInfo(null),this.shareScreenInfo=[];const e=await this.rtc.shareScreen.getScreenInfo();ee(()=>{this.shareScreenInfo=e})});m(this,"toggleShareScreenPicker",(e=!this.shareScreenPickerVisible)=>{this.shareScreenPickerVisible=e});m(this,"selectShareScreenInfo",e=>{this.selectedScreenInfo=e,this.rtc.shareScreen.setScreenInfo(e)});m(this,"toggleShareScreen",(e=!this.isScreenSharing)=>{this.rtc.shareScreen.enable(e),this.toggleShareScreenPicker(!1)});m(this,"acceptRaiseHand",e=>{var t;this.isCreator&&((t=this.classroomStorage)==null?void 0:t.isWritable)&&this.classroomStorage.state.raiseHandUsers.includes(e)&&this.onStaging(e,!0)});m(this,"onCancelAllHandRaising",()=>{var e;this.isCreator&&((e=this.classroomStorage)==null?void 0:e.isWritable)&&this.classroomStorage.setState({raiseHandUsers:[]})});m(this,"onToggleHandRaising",()=>{var e;this.isCreator||((e=this.users.currentUser)==null?void 0:e.isSpeak)||this.users.currentUser&&this.rtm.sendPeerCommand("raise-hand",{roomUUID:this.roomUUID,raiseHand:!this.users.currentUser.isRaiseHand},this.ownerUUID)});m(this,"onToggleHandRaisingPanel",(e=!this.isHandRaisingPanelVisible)=>{this.isHandRaisingPanelVisible=e});m(this,"onToggleBan",()=>{var e;this.isCreator&&((e=this.classroomStorage)==null?void 0:e.isWritable)&&this.classroomStorage.setState({ban:!this.classroomStorage.state.ban})});m(this,"onStaging",(e,t)=>{var s,n;if(!(this.classMode===ce.Interaction||e===this.ownerUUID||!((s=this.onStageUsersStorage)!=null&&s.isWritable))){if(!t&&(!this.isCreator||e!==this.userUUID)&&(this.updateDeviceState(e,!1,!1),this.deleteAvatarWindow(e)),this.isCreator)if(!t||this.assertStageNotFull())this.onStageUsersStorage.setState({[e]:t});else return;else!t&&e===this.userUUID&&this.onStageUsersStorage.setState({[e]:!1});if((n=this.classroomStorage)!=null&&n.state.raiseHandUsers.includes(e)){const a=this.classroomStorage.state.raiseHandUsers;this.classroomStorage.setState({raiseHandUsers:a.filter(o=>o!==e)})}}});m(this,"offStageAll",async()=>{var e,t,s;this.classMode===ce.Interaction||!((e=this.onStageUsersStorage)!=null&&e.isWritable)||this.isCreator&&(this.onStageUsersStorage.resetState(),(t=this.whiteboardStorage)==null||t.resetState(),(s=this.userWindowsStorage)==null||s.resetState(),A.info(F.t("all-off-stage-toast")))});m(this,"muteAll",async()=>{if(this.isCreator&&this.deviceStateStorage&&this.deviceStateStorage.isWritable){const e=this.deviceStateStorage.state,t={};for(const s in e)s!==this.userUUID&&e[s].mic&&(t[s]={...e[s],mic:!1});this.deviceStateStorage.setState(t),A.info(F.t("all-mute-mic-toast"))}});m(this,"authorizeWhiteboard",async(e,t)=>{var s;this.classMode===ce.Interaction||e===this.ownerUUID||!((s=this.whiteboardStorage)!=null&&s.isWritable)||(this.isCreator?this.whiteboardStorage.setState({[e]:t}):!t&&e===this.userUUID&&this.whiteboardStorage.setState({[e]:!1}))});m(this,"updateDeviceState",(e,t,s)=>{var n;if(((n=this.deviceStateStorage)==null?void 0:n.isWritable)&&(this.userUUID===e||this.isCreator)){const a=this.deviceStateStorage.state[e]||{camera:!1,mic:!1};if(t===a.camera&&s===a.mic)return;let o=!1;if(this.isCreator&&e!==this.userUUID){if(t&&!a.camera){this.rtm.sendPeerCommand("request-device",{roomUUID:this.roomUUID,camera:t},e),A.info(F.t("sent-invitation"));return}if(s&&!a.mic){this.rtm.sendPeerCommand("request-device",{roomUUID:this.roomUUID,mic:s},e),A.info(F.t("sent-invitation"));return}o=!0}this.deviceStateStorage.setState({[e]:t||s?{camera:t,mic:s}:void 0}),o&&(!t&&a.camera&&(A.info(F.t("has-turn-off-camera")),this.rtm.sendPeerCommand("notify-device-off",{roomUUID:this.roomUUID,camera:t},e)),!s&&a.mic&&(A.info(F.t("has-turn-off-mic")),this.rtm.sendPeerCommand("notify-device-off",{roomUUID:this.roomUUID,mic:s},e)))}});m(this,"updateRoomStatusLoading",e=>{this.roomStatusLoading=e});if(!P.userUUID)throw new Error("Missing user uuid");window.classroomStore=this,this.roomUUID=e.roomUUID,this.ownerUUID=e.ownerUUID,this.userUUID=P.userUUID,this.classMode=ce.Lecture,this.rtc=e.rtc,this.rtm=e.rtm,this.recording=e.recording,this.chatStore=new _n({roomUUID:this.roomUUID,ownerUUID:this.ownerUUID,rtm:this.rtm,isShowUserGuide:P.isShowGuide}),this.users=new Wn({roomUUID:this.roomUUID,ownerUUID:this.ownerUUID,userUUID:this.userUUID,isInRoom:t=>this.rtm.members.has(t)}),this.whiteboardStore=new Ua({isCreator:this.isCreator,isWritable:this.isCreator,getRoomType:()=>{var t;return((t=this.roomInfo)==null?void 0:t.roomType)||ie.BigClass},whiteboard:e.whiteboard,onDrop:this.onDrop}),Te(this,{rtc:j.ref,rtm:j.ref,sideEffect:!1,deviceStateStorage:!1,classroomStorage:!1,onStageUsersStorage:!1,shareScreenInfo:j.ref}),this.sideEffect.addDisposer(this.recording.$Val.isRecording$.subscribe(t=>{ee(()=>{this.isRecording=t})})),this.sideEffect.addDisposer(ht(()=>this.isRecording,t=>{t&&A.success(F.t("start-recording"))})),this.sideEffect.addDisposer(this.rtm.events.on("remote-login",we("remote-login",()=>{this.isRemoteLogin=!0}))),this.isCreator||(this.sideEffect.addDisposer(this.rtm.events.on("update-room-status",t=>{t.roomUUID===this.roomUUID&&t.senderID===this.ownerUUID&&this.updateRoomStatus(t.status)})),this.sideEffect.addDisposer(this.rtm.events.on("request-device",t=>{t.roomUUID===this.roomUUID&&t.senderID===this.ownerUUID&&this.toggleRequestingDevice(t.deviceState.camera,t.deviceState.mic)})),this.sideEffect.addDisposer(this.rtm.events.on("notify-device-off",t=>{t.roomUUID===this.roomUUID&&t.senderID===this.ownerUUID&&(t.deviceState.camera===!1&&A.info(F.t("teacher-has-turn-off-camera")),t.deviceState.mic===!1&&A.info(F.t("teacher-has-turn-off-mic")))}))),this.isCreator&&(this.sideEffect.addDisposer(this.rtm.events.on("raise-hand",t=>{var s;if(((s=this.classroomStorage)==null?void 0:s.isWritable)&&this.roomUUID===t.roomUUID){const n=this.classroomStorage.state.raiseHandUsers.some(a=>a===t.userUUID);t.raiseHand?n||this.classroomStorage.setState({raiseHandUsers:[...this.classroomStorage.state.raiseHandUsers,t.userUUID]}):n&&this.classroomStorage.setState({raiseHandUsers:this.classroomStorage.state.raiseHandUsers.filter(a=>a!==t.userUUID)})}})),this.sideEffect.addDisposer(this.rtm.events.on("request-device-response",t=>{var s;if(t.roomUUID===this.roomUUID){const n=(s=this.users.cachedUsers.get(t.userUUID))==null?void 0:s.name;t.deviceState.camera===!1&&A.info(F.t("refuse-to-turn-on-camera",{name:n})),t.deviceState.mic===!1&&A.info(F.t("refuse-to-turn-on-mic",{name:n}))}})),this.sideEffect.addDisposer(ht(()=>this.isScreenSharing||this.isRemoteScreenSharing,t=>{var s;(s=this.classroomStorage)!=null&&s.isWritable&&this.classroomStorage.setState({shareScreen:t})})))}get roomType(){var e,t;return(t=(e=this.roomInfo)==null?void 0:e.roomType)!=null?t:ie.BigClass}get roomInfo(){return Ce.rooms.get(this.roomUUID)}get isCreator(){return this.ownerUUID===this.userUUID}get roomStatus(){var e,t;return this.whiteboardStore.isKicked?J.Stopped:(t=(e=this.roomInfo)==null?void 0:e.roomStatus)!=null?t:J.Idle}get firstOnStageUser(){return this.onStageUserUUIDs.length>0?this.users.cachedUsers.get(this.onStageUserUUIDs[0]):void 0}get offlineJoiners(){const e=[];for(const t of this.users.cachedUsers.values())this.onStageUserUUIDs.includes(t.userUUID)&&t.hasLeft&&e.push(t);return e}get userWindowsMode(){return this.userWindowsGrid?"maximized":"normal"}emptyArrayAsNull(e){return e&&e.length>0?e:null}async init(){await Ce.syncOrdinaryRoomInfo(this.roomUUID),await this.initRTC(),await this.rtm.joinRoom({roomUUID:this.roomUUID,ownerUUID:this.ownerUUID,uid:this.userUUID,token:P.rtmToken});const e=await this.whiteboardStore.joinWhiteboardRoom();await this.users.initUsers([...this.rtm.members]);const t=e.syncedStore.connectStorage("deviceState",{}),s=e.syncedStore.connectStorage("classroom",{ban:!1,raiseHandUsers:[],shareScreen:!1}),n=e.syncedStore.connectStorage("onStageUsers",{}),a=e.syncedStore.connectStorage("whiteboard",{}),o=e.syncedStore.connectStorage("userWindows",{grid:null});this.deviceStateStorage=t,this.classroomStorage=s,this.onStageUsersStorage=n,this.whiteboardStorage=a,this.userWindowsStorage=o,this.isCreator?this.updateDeviceState(this.userUUID,Boolean(ne.autoCameraOn),Boolean(ne.autoMicOn)):(this.whiteboardStore.updateWritable(Boolean(n.state[this.userUUID]||a.state[this.userUUID])),this.whiteboardStore.updateAllowDrawing(a.state[this.userUUID])),this.updateIsBan(s.state.ban),this.chatStore.onNewMessage=u=>{this.isRecording&&e.syncedStore.dispatchEvent("new-message",u)};const l=new Set,c=(u=[])=>{l.clear(),u.forEach(d=>{l.add(d)})};c(s.state.raiseHandUsers),this.users.updateUsers(u=>{if(u.userUUID===this.ownerUUID||n.state[u.userUUID]){u.isSpeak=!0,u.isRaiseHand=!1;const d=t.state[u.userUUID];d&&(u.camera=d.camera,u.mic=d.mic)}else u.isSpeak=!1,u.mic=!1,u.camera=!1,u.isRaiseHand=l.has(u.userUUID);u.wbOperate=!!a.state[u.userUUID]}),this.sideEffect.addDisposer(this.rtm.events.on("member-joined",async({userUUID:u})=>{await this.users.addUser(u),this.users.updateUsers(d=>{if(d.userUUID===u){if(u===this.ownerUUID||n.state[u]){d.isSpeak=!0,d.wbOperate=!!a.state[u],d.isRaiseHand=!1;const f=t.state[d.userUUID];return f?(d.camera=f.camera,d.mic=f.mic):(d.camera=!1,d.mic=!1),!1}if(a.state[u])return d.wbOperate=!0,!1}return!0})})),this.sideEffect.addDisposer(this.rtm.events.on("member-left",({userUUID:u})=>{this.users.removeUser(u)})),this.sideEffect.addDisposer(s.on("stateChanged",u=>{u.raiseHandUsers&&(c(u.raiseHandUsers.newValue),this.users.updateUsers(d=>{d.isRaiseHand=l.has(d.userUUID)})),u.ban&&(this.updateIsBan(u.ban.newValue),this.isCreator&&this.rtm.sendRoomCommand("ban",{roomUUID:this.roomUUID,status:u.ban.newValue}))}));const h=async()=>{const u=this.onStageUserUUIDs.includes(this.userUUID),d=Object.keys(n.state).filter(f=>n.state[f]);if(await this.users.syncExtraUsersInfo(d),ee(()=>{this.onStageUserUUIDs.replace(d)}),this.users.updateUsers(f=>{if(f.userUUID!==this.ownerUUID)if(n.state[f.userUUID]){f.isSpeak=!0,f.isRaiseHand=!1;const w=t.state[f.userUUID];w?(f.camera=w.camera,f.mic=w.mic):(f.camera=!1,f.mic=!1)}else f.isSpeak=!1,f.mic=!1,f.camera=!1}),!this.isCreator){const f=Boolean(n.state[this.userUUID]);this.whiteboardStore.updateWritable(Boolean(f||a.state[this.userUUID])),this.whiteboardStore.updateAllowDrawing(a.state[this.userUUID]),f&&!e.syncedStore.isRoomWritable&&await new Promise(w=>{const v=e.syncedStore.addRoomWritableChangeListener(S=>{S&&(v(),w())})}),!u&&f&&this.updateDeviceState(this.userUUID,ne.autoCameraOn,ne.autoMicOn),u!==f&&A.info(F.t(f?"stage-on":"stage-off"))}};h();const p=new Map;for(const u in o.state)if(u!=="grid"){const d=o.state[u];d&&p.set(u,d)}ee(()=>{this.userWindowsGrid=this.emptyArrayAsNull(o.state.grid),this.userWindows.replace(p)}),this.sideEffect.addDisposer(n.on("stateChanged",h)),this.sideEffect.addDisposer(a.on("stateChanged",()=>{this.users.updateUsers(u=>{u.wbOperate=u.userUUID===this.ownerUUID||!!a.state[u.userUUID]}),this.whiteboardStore.updateWritable(Boolean(this.isCreator||n.state[this.userUUID]||a.state[this.userUUID])),this.whiteboardStore.updateAllowDrawing(this.isCreator||a.state[this.userUUID])})),this.sideEffect.addDisposer(o.on("stateChanged",u=>{ee(()=>{for(const d in u)if(d==="grid")this.userWindowsGrid=this.emptyArrayAsNull(u[d].newValue);else{const f=u[d].newValue;f?this.userWindows.set(d,f):this.userWindows.delete(d)}})})),this.sideEffect.addDisposer(ut(()=>{const u=[],d=this.users.cachedUsers.get(this.ownerUUID);d&&u.push({uid:d.rtcUID,avatar:d.avatar,isOwner:!0}),this.onStageUserUUIDs.forEach(f=>{const w=this.users.cachedUsers.get(f);w&&u.push({uid:w.rtcUID,avatar:w.avatar,isOwner:f===this.ownerUUID})}),u.sort((f,w)=>f.isOwner?-1:w.isOwner?1:(+f.uid|0)-(+w.uid|0)),this.updateRecordingLayout(u)})),this.sideEffect.addDisposer(t.on("stateChanged",()=>{this.users.updateUsers(u=>{const d=t.state[u.userUUID];d?(u.camera=d.camera,u.mic=d.mic):(u.mic=!1,u.camera=!1)})})),this.roomType===ie.OneToOne&&(this.isCreator&&this.roomStatus===J.Idle&&this.startClass(),this.isCreator&&e.syncedStore.isRoomWritable&&(await e.syncedStore.nextFrame(),this.sideEffect.addDisposer(ut(u=>{if(this.onStageUserUUIDs.length>0){u.dispose();return}this.users.joiners.length===1&&this.onStaging(this.users.joiners[0].userUUID,!0)})))),this.roomType===ie.SmallClass&&!this.isCreator&&!n.state[this.userUUID]&&this.assertStageNotFull(!1)&&!P.wasOnStage(this.roomUUID)&&(P.pushOnStageRoomUUID(this.roomUUID),e.syncedStore.isRoomWritable||(this.whiteboardStore.updateWritable(!0),await new Promise(u=>{const d=e.syncedStore.addRoomWritableChangeListener(f=>{f&&(d(),u())})})),this.onStageUsersStorage.setState({[this.userUUID]:!0})),this.isCreator&&(await this.recording.joinRoom({roomID:this.roomUUID,classroomType:this.roomType}),ne.autoRecording&&!this.isRecording&&await this.toggleRecording())}async destroy(){this.sideEffect.flushAll(),await this.stopRecording(),this.deviceStateStorage=void 0,this.onStageUsersStorage=void 0,this.classroomStorage=void 0,this.whiteboardStorage=void 0,this.userWindowsStorage=void 0}isWindowEqual(e,t){return e.z===t.z&&Math.abs(e.x-t.x)<.001&&Math.abs(e.y-t.y)<.001&&Math.abs(e.width-t.width)<.001&&Math.abs(e.height-t.height)<.001}updateIsBan(e){this.isBan=e}assertStageNotFull(e=!0){const t=this.roomType===ie.SmallClass?16:1;if(this.onStageUserUUIDs.length<t)return!0;const s="warn-staging-limit."+(this.roomType===ie.SmallClass?"small-class":"other");return e&&A.warn({content:F.t(s),style:{whiteSpace:"pre"}}),!1}toggleRequestingDevice(e,t){e!==void 0&&(this.isRequestingCamera=e),t!==void 0&&(this.isRequestingMic=t)}replyRequestingDevice(e,t){this.isCreator||this.rtm.sendPeerCommand("request-device-response",{roomUUID:this.roomUUID,[e]:t},this.ownerUUID)}async switchRoomStatus(e){if(!(!this.isCreator||this.roomStatusLoading!==le.Null)){if(!this.roomInfo)throw new Error("Room not ready!");try{switch(e){case J.Started:{this.updateRoomStatusLoading(le.Starting),await js(this.roomUUID),await Ce.syncOrdinaryRoomInfo(this.roomUUID);const t=this.roomUUID,s=P.periodicUUID;s&&await Ce.syncPeriodicSubRoomInfo({periodicUUID:s,roomUUID:t});break}case J.Paused:{this.updateRoomStatusLoading(le.Pausing),await $s(this.roomUUID);break}case J.Stopped:{this.updateRoomStatusLoading(le.Stopping),await Bs(this.roomUUID);break}default:break}this.updateRoomStatus(e)}catch(t){ge(t),console.error(t)}this.updateRoomStatusLoading(le.Null)}}async startRecording(){await this.recording.startRecording()}async stopRecording(){await this.recording.stopRecording()}async initRTC(){var e,t,s,n;this.sideEffect.addDisposer(this.rtc.events.on("network",we("checkNetworkQuality",a=>{this.networkQuality=a}))),this.sideEffect.addDisposer(this.rtc.shareScreen.events.on("local-changed",we("localShareScreen",a=>{this.isScreenSharing=a}))),this.sideEffect.addDisposer(this.rtc.shareScreen.events.on("remote-changed",we("remoteShareScreen",a=>{this.isRemoteScreenSharing=a}))),P.rtcUID&&(await this.rtc.joinRoom({roomUUID:this.roomUUID,uid:String(P.rtcUID),token:P.rtcToken,mode:((e=this.roomInfo)==null?void 0:e.roomType)===ie.BigClass?ft.Broadcast:ft.Communication,role:this.isCreator||P.userUUID&&((t=this.onStageUsersStorage)==null?void 0:t.state[P.userUUID])?mt.Host:mt.Audience,refreshToken:vi,shareScreenUID:String(((s=P.rtcShareScreen)==null?void 0:s.uid)||-1),shareScreenToken:((n=P.rtcShareScreen)==null?void 0:n.token)||""}),ee(()=>{this.isJoinedRTC=!0}))}}const xa=async()=>{},Sr=N(function({classRoomStore:e}){return r(Xi,{getUserByUUID:t=>e.users.cachedUsers.get(t),isBan:e.isBan,isCreator:e.isCreator,loadMoreRows:xa,messages:e.chatStore.messages,openCloudStorage:()=>e.toggleCloudStoragePanel(!0),totalUserCount:e.users.totalUserCount,unreadCount:e.users.handRaisingJoiners.length||null,userUUID:e.userUUID,onBanChange:e.onToggleBan,onClickTotalUsersCount:()=>e.toggleUsersPanel(!0),onMessageSend:e.onMessageSend})}),br=N(function({isCreator:e,isRemoteLogin:t,roomStatus:s}){const n=it(),a=g.exports.useCallback(()=>{n(tt.HomePage)},[n]);return r(rn,{isCreator:e,isRemoteLogin:t,roomStatus:s,onExit:a})}),ya=N(function({cloudStorage:e,onCoursewareInserted:t}){const s=Gs(),n=Ys(),a=g.exports.useMemo(()=>new URLSearchParams(n.search).get("path"),[n.search]),o=g.exports.useCallback(l=>{const c=new URLSearchParams({path:l}).toString();s.push({search:c})},[s]);return g.exports.useEffect(()=>e.initialize({onCoursewareInserted:t}),[e,t]),g.exports.useEffect(()=>{a!==null&&e.onParentDirectoryPathClick(a)},[a,e]),r(ui,{path:a,pushHistory:o,store:e})});const Ur=N(function({classroom:e}){const t=W(),s=g.exports.useCallback(()=>e.toggleCloudStoragePanel(!1),[e]),n=g.exports.useCallback(()=>e.toggleCloudStoragePanel(!0),[e]);return e.whiteboardStore.allowDrawing?b(se,{children:[r(We,{icon:r(qs,{}),title:t("cloud-storage"),onClick:n}),r(Q,{centered:!0,destroyOnClose:!0,className:"cloud-storage-button-modal",footer:[],open:e.isCloudStoragePanelVisible,title:t("my-cloud"),onCancel:s,children:r(ya,{cloudStorage:e.whiteboardStore.cloudStorageStore,onCoursewareInserted:s})})]}):null});var Da=(i=>(i[i.StopClassButton=0]="StopClassButton",i[i.ExitButton=1]="ExitButton",i))(Da||{});function Cr({roomStatus:i,hangClass:e,stopClass:t}){const[s,n]=g.exports.useState(1),[a,o]=g.exports.useState(!1),[l,c]=g.exports.useState(!1),[h,p]=g.exports.useState(!1),u=mi(),d=it(),f=g.exports.useContext(Zt),w=g.exports.useCallback(async()=>{c(!0);try{await u(e())}catch(C){c(!1),console.error(C),ge(C)}d(tt.HomePage)},[d,e,u]),v=g.exports.useCallback(async()=>{p(!0);try{await u(t())}catch(C){p(!1),console.error(C),ge(C)}},[t,u]),S=g.exports.useCallback(()=>{o(!1)},[]),U=g.exports.useCallback(C=>{i===J.Started||i===J.Paused?(o(!0),n(C)):w()},[w,i]);return g.exports.useEffect(()=>{if(f)return f.sendWindowWillCloseEvent(()=>U(1)),()=>{f.removeWindowWillCloseEvent()}}),{confirmType:s,visible:a,isReturnLoading:l,isStopLoading:h,onReturnMain:w,onStopClass:v,onCancel:S,confirm:U}}const xr=N(function({isCreator:e,confirmType:t,isReturnLoading:s,isStopLoading:n,onReturnMain:a,onStopClass:o,...l}){return e?t===1?r(Qi,{...l,hangLoading:s,stopLoading:n,onHang:a,onStop:o}):r(Ki,{...l,loading:n,onStop:o}):r(en,{...l,onExit:a})}),Ia=N(function({visible:e,room:t,onCopied:s,onCancel:n}){var u;const a=W(),o=g.exports.useContext(Js),l=g.exports.useContext(Xs),{periodicUUID:c}=t,h=c?l.periodicRooms.get(c):void 0;g.exports.useEffect(()=>{c&&l.syncPeriodicRoomInfo(c).catch(ge)},[c,l]);const p=g.exports.useCallback(async d=>{await navigator.clipboard.writeText(d),A.success(a("copy-success")),s()},[s,a]);return r(di,{baseUrl:Ks,periodicWeeks:h==null?void 0:h.periodic.weeks,room:t,userName:(u=o.userName)!=null?u:"",visible:e,onCancel:n,onCopy:p})}),yr=N(function({roomInfo:e}){const t=W(),[s,n]=g.exports.useState(!1),a=()=>n(!1);return b("div",{children:[r(We,{icon:r(Fi,{}),title:t("invitation"),onClick:()=>n(!0)}),e&&r(Ia,{room:e,visible:s,onCancel:a,onCopied:a})]})});class Dr extends Se.PureComponent{render(){const{isVideoOn:e,isShow:t,videoSlot:s,chatSlot:n}=this.props;return r("div",{className:T("realtime-panel-wrap",{isActive:t}),children:b("div",{className:"realtime-panel",children:[r("div",{className:T("realtime-panel-video-slot",{isActive:e}),children:s}),r("div",{className:"realtime-panel-chat-slot",children:n})]})})}}const ka=[".ppt",".pptx",".doc",".docx",".pdf",".png",".jpg",".jpeg",".gif",".mp3",".mp4"];function Ge(i){return ka.some(e=>i.name.endsWith(e))}const Na=["image/png","image/jpg","image/jpeg","image/webp","image/apng","image/svg+xml","image/gif","image/bmp","image/avif","image/tiff"];function Xe(i){return Na.includes(i.type)}async function At(i,e,t,s,n){if(!Xe(i)){console.log("[dnd:image] unsupported file type:",i.type,i.name);return}const a=A.loading(F.t("inserting-courseware-tips")),o=Ma(i),l=new fi(i,n.parentDirectoryPath);await l.upload();const{files:c}=await Qs({page:1,order:"DESC",directoryPath:n.parentDirectoryPath}),h=c.find(f=>f.fileUUID===l.fileUUID);if(a(),!(h!=null&&h.fileURL)){console.log("[dnd:image] upload failed:",i.name);return}const p=Vt(),{width:u,height:d}=await o;s.insertImage({uuid:p,centerX:e,centerY:t,width:u,height:d,locked:!1}),s.completeImageUpload(p,h.fileURL),s.setMemberState({currentApplianceName:ei.selector})}function Ma(i){const e=new Image,t=URL.createObjectURL(i),{innerWidth:s,innerHeight:n}=window,a=s*.8,o=n*.8;return e.src=t,new Promise(l=>{e.onload=()=>{URL.revokeObjectURL(t);const{width:c,height:h}=e;let p=1;(c>a||h>o)&&(p=Math.min(a/c,o/h)),l({width:Math.floor(c*p),height:Math.floor(h*p)})},e.onerror=()=>{l({width:s,height:n})}})}const Ea=[{src:"https://flat-storage.oss-cn-hangzhou.aliyuncs.com/flat-resources/presets/math_1.png",i18nKey:"presets.math_1"},{src:"https://flat-storage.oss-cn-hangzhou.aliyuncs.com/flat-resources/presets/english_1.jpeg",i18nKey:"presets.english_1"},{src:"https://flat-storage.oss-cn-hangzhou.aliyuncs.com/flat-resources/presets/chinese_1.png",i18nKey:"presets.chinese_1"}];function Ra(i){return{fileUUID:Vt(),fileName:"",fileSize:0,fileURL:"",resourceType:"NormalResources",createAt:new Date,meta:{},...i}}const ve=9/16,Ta=.4,Wa=.25,Lt=(i,e,t)=>i<e?e:i>t?t:i,_a=N(function({classroom:e}){const t=g.exports.useRef(null),[s,n]=g.exports.useState(null),[a,o]=g.exports.useState(!1);g.exports.useEffect(()=>{if(t.current){const f=t.current,w=new ResizeObserver(()=>{n(f.getBoundingClientRect())});return w.observe(f),()=>w.disconnect()}},[]);const l=g.exports.useMemo(()=>{if(!s)return{width:0,height:0};const{width:f,height:w}=s,v=f*qe;if(v<w)return{width:f,height:v,extraY:(w-v)/2};{const S=w/qe;return{width:S,height:w,extraX:(f-S)/2}}},[s]),c=(e.userWindowsGrid||[...e.userWindows.keys()]).map(f=>({userUUID:f,window:e.userWindows.get(f)})),h=e.userWindowsGrid?e.userWindowsGrid.length:0,p=g.exports.useMemo(()=>{if(!s)return{x:0,y:0};let f;1<=h&&h<=2?f=1:3<=h&&h<=6?f=2:7<=h&&h<=12?f=3:f=4;let w;h===1?w=1:2<=h&&h<=4?w=2:5<=h&&h<=9?w=3:w=4;const v=Math.min(s.width/w,s.height/f/ve),S=v*w,U=v*f*ve;return{x:(s.width-S)/2,y:(s.height-U)/2}},[s,h]),u=g.exports.useCallback(f=>{o(!1),e.onDragEnd();const w=f.dataTransfer.getData("video-avatar");if(!w||!s)return;const[v,S,U]=JSON.parse(w),C=l.width*Ta,D=C*ve;let E=f.clientX-s.left-C*S-(l.extraX||0),R=f.clientY-s.top-D*U-(l.extraY||0);E=Lt(E,0,l.width-C),R=Lt(R,0,l.height-D),e.createAvatarWindow(v,{x:E/l.width,y:R/l.height,width:C/l.width,height:D/l.height})},[l,s,e]),d=e.userWindowsGrid;return b("div",{ref:t,className:T("user-windows",{"is-grid":d&&h>0,"is-hovering":a}),"data-size":h,style:{paddingLeft:p.x,paddingRight:p.x,paddingTop:p.y,paddingBottom:p.y},children:[c.map(({userUUID:f,window:w})=>r(Aa,{baseRect:l,classroom:e,mode:e.userWindowsMode,readonly:!e.isCreator,userUUID:f,window:w},f)),e.isDraggingAvatar&&r("div",{className:"user-windows-mask",onDragLeave:()=>o(!1),onDragOver:()=>o(!0),onDrop:u})]})}),Pa={x:0,y:0,width:.4,height:.4*ve,z:0},Aa=N(function({mode:e,readonly:t,userUUID:s,window:n,baseRect:a,classroom:o}){const l=Ft(),[c,h]=g.exports.useState(null);g.exports.useEffect(()=>{if(c){const U=setTimeout(()=>{o.updateAvatarWindow(s,c),l.current||h(null)},50);return()=>clearTimeout(U)}},[o,l,c,s]);const p=c||n||Pa,u=g.exports.useMemo(()=>({x:p.x*a.width+(a.extraX||0),y:p.y*a.height+(a.extraY||0),width:p.width*a.width,height:p.height*a.height}),[a,p]),d=g.exports.useCallback(()=>{n&&o.updateAvatarWindow(s,n)},[o,n,s]),f=g.exports.useCallback(()=>{o.toggleUserWindowsMode()},[o]),w=g.exports.useCallback(U=>{var D;o.setDroppingUserUUID(null);const C=document.elementFromPoint(U.clientX,U.clientY);C&&((D=C.dataset)==null?void 0:D.userUuid)&&o.deleteAvatarWindow(s)},[o,s]),v=g.exports.useCallback(U=>{var D;const C=document.elementFromPoint(U.clientX,U.clientY);C&&((D=C.dataset)==null?void 0:D.userUuid)?o.setDroppingUserUUID(s):o.setDroppingUserUUID(null)},[o,s]),S=g.exports.useCallback((U,C)=>{U.x-=a.extraX||0,U.y-=a.extraY||0;const{x:D,y:E,width:R,height:k}=vn(U,C,ve,Wa*a.width,a.width,a.height);h({x:D/a.width,y:E/a.height,width:R/a.width,height:k/a.height,z:2147483647})},[a]);return r(wn,{mode:e,readonly:t,rect:u,zIndex:p.z,onClick:d,onDoubleClick:f,onDragEnd:w,onDragging:v,onResize:S,children:r(La,{classroom:o,mode:e,userUUID:s})},s)}),La=({mode:i,userUUID:e,classroom:t})=>r("div",{ref:g.exports.useCallback(s=>t.setPortal(e,s),[t,e]),className:T("user-window-portal",{"is-grid":i==="maximized"})}),Ha=()=>{},Ir=N(function({whiteboardStore:e,classRoomStore:t,disableHandRaising:s}){var G,Y;const n=W(),{room:a,windowManager:o,phase:l,whiteboard:c}=e,h=g.exports.useContext(Ke),[p,u]=g.exports.useState(!1),[d,f]=g.exports.useState([]),[w,v]=g.exports.useState(!1),[S,U]=g.exports.useState(0),[C,D]=g.exports.useState(1/0),[E,R]=g.exports.useState(!1),k=l===ke.Reconnecting,y=t.users.handRaisingJoiners.length;g.exports.useEffect(()=>c.events.on("exportAnnotations",()=>u(!0)),[c]),g.exports.useEffect(()=>c.events.on("insertPresets",()=>v(!0)),[c]),g.exports.useEffect(()=>{const x=c.events.on("scrollPage",U),M=c.events.on("maxScrollPage",D),z=c.events.on("userScroll",()=>R(!0));return()=>{x(),M(),z()}},[c]),g.exports.useEffect(()=>{if(E){let x=!0;const M=setTimeout(()=>{x&&R(!1)},1e3);return()=>{clearTimeout(M),x=!1}}else return},[E]),g.exports.useEffect(()=>{c.setTheme(h?"dark":"light")},[h,c]),g.exports.useEffect(()=>k?A.info(n("reconnecting"),0):Ha,[k,n]),g.exports.useEffect(()=>{p&&f(e.getSaveAnnotationImages())},[p,e]);const I=g.exports.useCallback(x=>{x&&c.render(x)},[c]),L=g.exports.useCallback(async x=>{const M=await et.getInstance().requestService("file");M&&M.insert(Ra({fileName:`${Date.now()}.png`,fileURL:x})),v(!1)},[]),_=g.exports.useCallback(x=>{x.preventDefault();const M=x.dataTransfer.files[0];a&&M&&Ge(M)&&(x.dataTransfer.dropEffect="copy")},[a]),H=g.exports.useCallback(async x=>{x.preventDefault();const M=x.dataTransfer.files[0];if(a&&M)if(Xe(M)){const z=x.target.getBoundingClientRect(),ae=x.clientX-z.left,de=x.clientY-z.top,{x:he,y:ue}=a.convertToPointInWorld({x:ae,y:de});await At(M,he,ue,a,e.cloudStorageStore)}else Ge(M)&&e.onDrop(M)},[a,e]);return g.exports.useEffect(()=>{const x=M=>{var ae;const z=(ae=M.clipboardData)==null?void 0:ae.files[0];if(a&&o&&z){const{centerX:de,centerY:he}=o.camera;if(Xe(z)){const ue=Ye(Date.now(),"yyyy-MM-dd_HH-mm-ss"),be=ti(z.name),Ue=`screenshot_${ue}.${be}`,_e=new File([z],Ue,{type:z.type,lastModified:z.lastModified});At(_e,de,he,a,e.cloudStorageStore)}else Ge(z)&&e.onDrop(z)}};return document.addEventListener("paste",x),()=>document.removeEventListener("paste",x)},[a,e,o]),g.exports.useEffect(()=>{if(t.isHandRaisingPanelVisible){const x=document.querySelector(".fastboard-view");if(x)return De(x,"pointerdown",()=>t.onToggleHandRaisingPanel(!1),{capture:!0})}},[t,t.isHandRaisingPanelVisible]),b(se,{children:[a&&b("div",{className:T("whiteboard-container",{"is-readonly":!e.allowDrawing}),onDragOver:_,onDrop:H,children:[r("div",{ref:I,className:T("whiteboard",{"can-operate":!t.userWindowsGrid&&(t.isCreator||((G=t.users.currentUser)==null?void 0:G.wbOperate))})}),r(_a,{classroom:t}),!e.isCreator&&t.users.currentUser&&!t.users.currentUser.isSpeak&&r("div",{className:"raise-hand-container",children:r(mn,{disableHandRaising:s,isRaiseHand:(Y=t.users.currentUser)==null?void 0:Y.isRaiseHand,onRaiseHandChange:t.onToggleHandRaising})}),e.isCreator&&r("div",{className:"raise-hand-container",children:r(gn,{active:y>0,count:y,onClick:()=>t.onToggleHandRaisingPanel()})}),r("div",{className:T("whiteboard-scroll-page",{"is-active":E}),children:Oa(n,S,C)}),b("div",{className:T("hand-raising-panel",{"is-active":t.isHandRaisingPanelVisible,"is-empty":y===0}),children:[t.users.handRaisingJoiners.map(x=>b("div",{className:"hand-raising-user",title:x.name,children:[r("img",{alt:"avatar",className:"hand-raising-user-avatar",src:x.avatar}),r("span",{className:"hand-raising-user-name",children:x.name}),r("button",{className:"hand-raising-btn",onClick:()=>t.onStaging(x.userUUID,!0),children:n("agree")})]},x.userUUID)),y===0&&r("div",{className:"hand-raising-empty",children:n("no-one-raising-hand")})]})]}),r(Mn,{images:d,visible:p,onClose:()=>u(!1)}),r(In,{images:Ea,visible:w,onClick:L,onClose:()=>v(!1)})]})});function Oa(i,e,t){return e===0?i("scroll.first-page"):e>=t?i("scroll.last-page"):i("scroll.page",{page:(((e+1)*10|0)/10).toFixed(1)})}const Fa=N(function({avatarUser:e,rtcAvatar:t,children:s}){const n=e==null?void 0:e.camera,a=e==null?void 0:e.mic,[o,l]=g.exports.useState(null),c=g.exports.useCallback(()=>(t==null?void 0:t.getVolumeLevel())||0,[t]);return g.exports.useEffect(()=>{t&&t.setElement(o)},[o,t]),g.exports.useEffect(()=>()=>{t&&(t.setElement(null),t.enableCamera(!1),t.enableMic(!1))},[t]),g.exports.useEffect(()=>{t&&t.enableCamera(Boolean(n))},[n,t]),g.exports.useEffect(()=>{t&&t.enableMic(Boolean(a))},[a,t]),s(c,r("div",{ref:l,className:"video-avatar-canvas"}))}),kr=N(function({userUUID:e,avatarUser:t,rtcAvatar:s,isAvatarUserCreator:n,small:a,isCreator:o,isDropTarget:l,onDoubleClick:c,getPortal:h,onDragStart:p,onDragEnd:u,updateDeviceState:d}){return t&&!t.hasLeft?r(Fa,{avatarUser:t,rtcAvatar:s,children:(f,w)=>r(on,{avatarUser:t,getVolumeLevel:f,isCreator:o,isDropTarget:l,portal:h(t.userUUID),small:a,updateDeviceState:d,userUUID:e,onDoubleClick:c,onDragEnd:u,onDragStart:p,children:w})}):r(ln,{avatarUser:t,isAvatarUserCreator:n,isCreator:o,isDropTarget:l,portal:t&&h(t.userUUID),small:a,onDoubleClick:c,onDragEnd:u,onDragStart:p})});const Za="data:image/svg+xml;charset=utf8,%3csvg width='6' height='10' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M1 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm4 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM1 4a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm4 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM1 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm4 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z' fill='white' fill-rule='evenodd'/%3e%3c/svg%3e",Va=N(function({classroomStore:e}){const t=W(),s=g.exports.useContext(Zt),[n]=g.exports.useState(()=>document.createElement("div"));g.exports.useEffect(()=>{if(s)return s.createShareScreenTipPortalWindow(n,t("share-screen.tip-window-title"))},[n,t,s]);const a=g.exports.useCallback(()=>e.toggleShareScreen(!1),[e]);return si.createPortal(b("div",{className:"share-screen-tip",children:[b("div",{children:[r("img",{alt:"drag icon",src:Za}),r("span",{children:t("share-screen.tip-window-body")})]}),r(te,{danger:!0,ghost:!0,onClick:a,children:t("share-screen.tip-window-button")})]}),n)}),Nr=N(function({classroomStore:e}){const t=g.exports.useRef(null),s=W();g.exports.useEffect(()=>{t.current&&e.rtc.shareScreen.setElement(t.current)},[e]),g.exports.useEffect(()=>{const a=o=>{za(o)&&Ba(o.message)&&A.error(s("share-screen.browser-not-permission"))};return e.rtc.shareScreen.events.on("err-enable",a),()=>{e.rtc.shareScreen.events.off("err-enable",a)}},[e.rtc.shareScreen.events,s]);const n=g.exports.useMemo(()=>T("share-screen",{active:e.isRemoteScreenSharing}),[e.isRemoteScreenSharing]);return window.isElectron?b(se,{children:[r("div",{ref:t,className:n}),e.isScreenSharing&&r(Va,{classroomStore:e})]}):r("div",{ref:t,className:n})});function za(i){return"code"in i&&"message"in i&&i.code==="PERMISSION_DENIED"}function Ba(i){return i.indexOf("by system")!==-1}function $a(i){var o;const[e,t]=g.exports.useState(),s=it(),n=Ee(),a=(o=e==null?void 0:e.roomInfo)==null?void 0:o.title;return g.exports.useEffect(()=>{a&&(document.title=a)},[a]),g.exports.useEffect(()=>{let l=!1,c;const h=et.getInstance();return n(Promise.all([h.requestService("videoChat"),h.requestService("textChat"),h.requestService("whiteboard"),h.requestService("recording")])).then(([p,u,d,f])=>{!l&&p&&u&&d&&f&&(c=new Ca({...i,rtc:p,rtm:u,whiteboard:d,recording:f}),t(c),n(c.init()).catch(w=>{ge(w),s(tt.HomePage)}))}),()=>{l=!0,c==null||c.destroy().catch(p=>{}),h.shutdownService("videoChat"),h.shutdownService("textChat"),h.shutdownService("whiteboard"),h.shutdownService("recording")}},[]),e}const Mr=i=>N(function(t){const s=ii(),n=$a(s);return n&&n.whiteboardStore.room&&n.whiteboardStore.phase!==ke.Connecting&&n.whiteboardStore.phase!==ke.Disconnecting?r(i,{classroomStore:n,...t}):r(ni,{onTimeout:"full-reload"})});const ja=i=>URL.createObjectURL(new Blob([i.buffer],{type:"image/png"})),Ga=N(function({screenInfo:e,classroomStore:t}){const[s,n]=g.exports.useState(""),a=W();g.exports.useEffect(()=>{e.length===0&&A.error(a("share-screen.desktop-not-permission"))},[e,a]);const o=g.exports.useCallback((c,h)=>{n(h),t.selectShareScreenInfo(c)},[t]),l=g.exports.useCallback(()=>{n(""),t.selectShareScreenInfo(null)},[t]);return r("div",{className:"screen-list",children:e.map(c=>{const h=typeof c.screenId=="number"?c.screenId:c.screenId.id,p=`${c.type}-${h}`,u=s===p;return r(Ya,{active:u,activeKey:p,handleClick:u?l:o,info:c},p)})})}),Ya=N(function({info:e,handleClick:t,active:s,activeKey:n}){return r(se,{children:b("div",{className:"screen-item",children:[r("div",{className:T("screen-image-box",{active:s}),onClick:()=>t(e,n),children:r("img",{alt:"screenshots",src:ja(e.image)})}),r("span",{children:e.name})]})})}),qa=N(function({classroomStore:e,handleOk:t}){const s=W();g.exports.useLayoutEffect(()=>{e.refreshShareScreenInfo()},[e]);const n=g.exports.useCallback(()=>{e.toggleShareScreenPicker(!1)},[e]),a=e.selectedScreenInfo!==null;return r("div",{children:r(Q,{centered:!0,open:!0,bodyStyle:{padding:"16px 0 0 16px"},className:"share-screen-picker-model",footer:[r(te,{className:"footer-button",onClick:n,children:s("cancel")},"cancel"),r(Ja,{handleOk:t,isSelected:a},"confirm")],title:s("share-screen.choose-share-content"),width:"784px",onCancel:n,children:r("div",{className:T("share-screen-picker",{loading:e.shareScreenInfo.length===0}),children:e.shareScreenInfo.length>0?r(Ga,{classroomStore:e,screenInfo:e.shareScreenInfo}):r(zt,{size:"large"})})})})}),Er=N(function({classroomStore:e,handleOk:t}){return e.shareScreenPickerVisible?r(qa,{classroomStore:e,handleOk:t}):null}),Ja=N(function({isSelected:e,handleOk:t}){const[s,n]=g.exports.useState(!1),a=W();return r(te,{className:"footer-button",disabled:!e,loading:s,type:"primary",onClick:()=>{n(!0),t()},children:a("confirm")},"submit")});const Rr=Se.memo(function(){const e=g.exports.useContext(ai);return e!=null&&e.isMac?r("div",{className:"extra-padding"}):null});const Tr=N(function({classroom:e}){const t=W(),s=ri(()=>{const{offlineJoiners:o}=e,{speakingJoiners:l,handRaisingJoiners:c,otherJoiners:h}=e.users;return[...l,...c,...o,...h].sort((p,u)=>p.name.localeCompare(u.name))}).get(),n=g.exports.useCallback(o=>{var l,c;return(c=(l=e.deviceStateStorage)==null?void 0:l.state[o])!=null?c:{camera:!1,mic:!1}},[e.deviceStateStorage]),a=g.exports.useCallback(o=>{var c;const l=(c=e.users.cachedUsers.get(o))==null?void 0:c.rtcUID;return e.rtc.getVolumeLevel(l)},[e.rtc,e.users.cachedUsers]);return g.exports.useEffect(()=>{if(e.isRequestingCamera){const o=Q.confirm({content:t("teacher-request-camera"),onOk(){const{mic:l}=n(e.userUUID);e.updateDeviceState(e.userUUID,!0,l),e.toggleRequestingDevice(!1,void 0),e.replyRequestingDevice("camera",!0)},onCancel(){e.toggleRequestingDevice(!1,void 0),e.replyRequestingDevice("camera",!1)}});return()=>o.destroy()}},[t,e.isRequestingCamera,n]),g.exports.useEffect(()=>{if(e.isRequestingMic){const o=Q.confirm({content:t("teacher-request-mic"),onOk(){const{camera:l}=n(e.userUUID);e.updateDeviceState(e.userUUID,l,!0),e.toggleRequestingDevice(void 0,!1),e.replyRequestingDevice("mic",!0)},onCancel(){e.toggleRequestingDevice(void 0,!1),e.replyRequestingDevice("mic",!1)}});return()=>o.destroy()}},[t,e.isRequestingMic,n]),b(se,{children:[r(We,{icon:r(oi,{}),title:t("users"),onClick:()=>e.toggleUsersPanel(!e.isUsersPanelVisible)}),r(Q,{centered:!0,destroyOnClose:!0,className:"users-button-modal",footer:[],open:e.isUsersPanelVisible,title:t("users"),onCancel:()=>e.toggleUsersPanel(!1),children:r(Rn,{getDeviceState:n,getVolumeLevel:a,ownerUUID:e.ownerUUID,roomInfo:e.roomInfo,userUUID:e.userUUID,users:s,onDeviceState:e.updateDeviceState,onMuteAll:e.muteAll,onOffStageAll:e.offStageAll,onStaging:e.onStaging,onWhiteboard:e.authorizeWhiteboard})})]})});export{wr as C,xr as E,yr as I,gr as N,br as R,Nr as S,vr as T,Tr as U,Ir as W,Er as a,Rr as b,pr as c,We as d,mr as e,Ur as f,hr as g,Da as h,fr as i,ur as j,Dr as k,Sr as l,kr as m,De as n,Cr as u,Mr as w};
//# sourceMappingURL=UsersButton.3be34569.js.map
