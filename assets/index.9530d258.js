var De=Object.defineProperty;var Oe=(e,t,s)=>t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var w=(e,t,s)=>(Oe(e,typeof t!="symbol"?t+"":t,s),s);import{S as j,R as Fe,aU as T,a as x,aV as Be,V as z,aW as He,aX as Ye,F as ae}from"./index.43c4ffc0.js";import{q as je}from"./courseware-converting.d7d525a3.js";const qe=`.netless-app-docs-viewer-footer{box-sizing:border-box;height:26px;display:flex;align-items:center;padding:0 16px;border-top:1px solid #eeeef7;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif}.netless-app-docs-viewer-footer-btn{box-sizing:border-box;width:26px;height:26px;font-size:0;margin:0;padding:3px;border:none;border-radius:1px;outline:none;color:currentColor;background:transparent;transition:background .4s;cursor:pointer;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-footer-btn:hover{background:rgba(237,237,240,.9)}@media (hover: none){.netless-app-docs-viewer-footer-btn:hover{background:transparent!important}}.netless-app-docs-viewer-footer-btn>svg{width:100%;height:100%}.netless-app-docs-viewer-footer-btn>svg:nth-of-type(2){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(1){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(2){display:initial}.netless-app-docs-viewer-footer-btn~.netless-app-docs-viewer-footer-btn{margin-left:15px}.netless-app-docs-viewer-page-jumps{flex:1;display:flex;justify-content:center;align-items:center}.netless-app-docs-viewer-page-number{display:flex;align-items:center;height:26px;margin-left:auto;font-size:13px;white-space:nowrap;word-break:keep-all;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-page-number-input{border:none;outline:none;width:3em;margin:0;padding:0 .5em 0 2px;text-align:right;font-size:13px;line-height:1;font-weight:400;font-family:inherit;border-radius:2px;color:currentColor;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;background:transparent;transition:background .4s;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-page-number-input:active{user-select:text;background:#fff;box-shadow:#63636333 0 2px 8px}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn:hover{background:transparent}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:active{background:transparent;box-shadow:none}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:disabled{color:inherit}.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:active,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:focus,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:hover{color:currentColor;background:#25282e}.telebox-color-scheme-dark .netless-app-docs-viewer-footer{border-top:none}.telebox-color-scheme-dark .netless-app-docs-viewer-footer-btn:hover{background:#212126}.netless-app-docs-viewer-preview-mask{position:absolute;z-index:10200;top:0;left:0;width:100%;height:100%}.netless-app-docs-viewer-preview{box-sizing:border-box;display:flex;flex-direction:column;align-items:center;position:absolute;z-index:10300;top:0;left:0;width:33%;max-width:200px;height:100%;padding-top:10px;transform:translate(-100%);background:rgba(237,237,240,.9);box-shadow:inset -1px 0 #0000001c;transition:transform .4s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview.netless-app-docs-viewer-preview-active{transform:translate(0)}.netless-app-docs-viewer-preview-page{position:relative;display:block;width:55%;margin-bottom:10px;font-size:0;color:transparent;outline:none;border:7px solid transparent;border-radius:4px;transition:border-color .3s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview-page:hover,.netless-app-docs-viewer-preview-page.netless-app-docs-viewer-preview-page-active{border-color:#444e601a}.netless-app-docs-viewer-preview-page>img{width:100%;height:auto;box-sizing:border-box;border:1px solid rgba(0,0,0,.5);border-radius:1px;background-color:#fff;box-shadow:0 2px 8px #0000004d}.netless-app-docs-viewer-preview-page-name{position:absolute;top:1px;left:-10px;transform:translate(-100%);text-align:right;font-size:12px;color:#5f5f5f;user-select:none}.telebox-color-scheme-dark .netless-app-docs-viewer-preview{background:rgba(50,50,50,.9)}.netless-app-docs-viewer-content{position:relative;height:100%;overflow:hidden}.netless-app-docs-viewer-static-scrollbar{box-sizing:border-box;position:absolute;top:0;right:0;z-index:2147483647;width:16px;min-height:30px;margin:0;padding:0 0 0 8px;border:none;outline:none;opacity:0;background:transparent;transition:opacity .4s 3s,transform .1s;user-select:none;touch-action:none}.netless-app-docs-viewer-static-scrollbar:after{content:"";display:block;width:8px;height:100%;border-radius:4px;background:rgba(68,78,96,.4);box-shadow:1px 1px 8px #ffffffb3;transition:background .4s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrolling{opacity:1;transition:opacity .4s,transform .1s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging{opacity:1;transition:opacity .4s 3s!important}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging:after{background:rgba(68,78,96,.6)}.netless-app-docs-viewer-static-scrollbar:hover:after,.netless-app-docs-viewer-static-scrollbar:focus:after{background:rgba(68,78,96,.5)}.netless-app-docs-viewer-static-scrollbar:active:after{background:rgba(68,78,96,.6)}.telebox-body-wrap:hover .netless-app-docs-viewer-static-scrollbar{opacity:1;transition:opacity .4s,transform .1s}.telebox-readonly .netless-app-docs-viewer-static-scrollbar{display:none}.page-renderer-pages-container{position:relative;width:100%;height:100%}.page-renderer-page{position:absolute;top:0;left:0;background-position:center;background-size:cover;background-repeat:no-repeat}.page-renderer-pages-container.is-hwa .page-renderer-page{will-change:transform}.page-renderer-page-img{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-static-pages{overflow:hidden;position:relative;height:100%;user-select:none}.netless-app-docs-viewer-static-page{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-dynamic-wb-view{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100;overflow:hidden}.netless-app-docs-viewer-dynamic-wb-view .cursor-clicker .ppt-event-source{cursor:pointer}.file-preview-netless-container{width:100%;height:100%;display:flex;flex-direction:column;overflow:hidden}.file-preview-netless-body{position:relative;flex:1;overflow:hidden}.file-preview-netless-operate{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100}.file-preview-netless-footer{height:26px;overflow:hidden}
`,S=typeof window<"u",de=S&&!("onscroll"in window)||typeof navigator<"u"&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),pe=S&&"IntersectionObserver"in window,he=S&&"classList"in document.createElement("p"),ue=S&&window.devicePixelRatio>1,We={elements_selector:".lazy",container:de||S?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},ge=e=>Object.assign({},We,e),ie=function(e,t){let s;const r="LazyLoad::Initialized",a=new e(t);try{s=new CustomEvent(r,{detail:{instance:a}})}catch{s=document.createEvent("CustomEvent"),s.initCustomEvent(r,!1,!1,{instance:a})}window.dispatchEvent(s)},Ue=(e,t)=>{if(!!t)if(!t.length)ie(e,t);else for(let s=0,r;r=t[s];s+=1)ie(e,r)},y="src",q="srcset",W="sizes",fe="poster",V="llOriginalAttrs",ve="data",U="loading",we="loaded",be="applied",Ge="entered",G="error",me="native",ye="data-",Ee="ll-status",v=(e,t)=>e.getAttribute(ye+t),Je=(e,t,s)=>{var r=ye+t;if(s===null){e.removeAttribute(r);return}e.setAttribute(r,s)},R=e=>v(e,Ee),k=(e,t)=>Je(e,Ee,t),O=e=>k(e,null),J=e=>R(e)===null,Ke=e=>R(e)===U,Qe=e=>R(e)===G,K=e=>R(e)===me,Xe=[U,we,be,G],Ze=e=>Xe.indexOf(R(e))>=0,C=(e,t,s,r)=>{if(!!e){if(r!==void 0){e(t,s,r);return}if(s!==void 0){e(t,s);return}e(t)}},A=(e,t)=>{if(he){e.classList.add(t);return}e.className+=(e.className?" ":"")+t},m=(e,t)=>{if(he){e.classList.remove(t);return}e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},et=e=>{e.llTempImage=document.createElement("IMG")},tt=e=>{delete e.llTempImage},xe=e=>e.llTempImage,F=(e,t)=>{if(!t)return;const s=t._observer;!s||s.unobserve(e)},st=e=>{e.disconnect()},rt=(e,t,s)=>{t.unobserve_entered&&F(e,s)},Q=(e,t)=>{!e||(e.loadingCount+=t)},at=e=>{!e||(e.toLoadCount-=1)},$e=(e,t)=>{!e||(e.toLoadCount=t)},it=e=>e.loadingCount>0,ot=e=>e.toLoadCount>0,Se=e=>{let t=[];for(let s=0,r;r=e.children[s];s+=1)r.tagName==="SOURCE"&&t.push(r);return t},X=(e,t)=>{const s=e.parentNode;if(!s||s.tagName!=="PICTURE")return;Se(s).forEach(t)},Ce=(e,t)=>{Se(e).forEach(t)},B=[y],_e=[y,fe],M=[y,q,W],ke=[ve],H=e=>!!e[V],Ne=e=>e[V],Ae=e=>delete e[V],N=(e,t)=>{if(H(e))return;const s={};t.forEach(r=>{s[r]=e.getAttribute(r)}),e[V]=s},nt=e=>{H(e)||(e[V]={backgroundImage:e.style.backgroundImage})},ct=(e,t,s)=>{if(!s){e.removeAttribute(t);return}e.setAttribute(t,s)},_=(e,t)=>{if(!H(e))return;const s=Ne(e);t.forEach(r=>{ct(e,r,s[r])})},lt=e=>{if(!H(e))return;const t=Ne(e);e.style.backgroundImage=t.backgroundImage},Le=(e,t,s)=>{A(e,t.class_applied),k(e,be),s&&(t.unobserve_completed&&F(e,t),C(t.callback_applied,e,s))},Ie=(e,t,s)=>{A(e,t.class_loading),k(e,U),s&&(Q(s,1),C(t.callback_loading,e,s))},$=(e,t,s)=>{!s||e.setAttribute(t,s)},oe=(e,t)=>{$(e,W,v(e,t.data_sizes)),$(e,q,v(e,t.data_srcset)),$(e,y,v(e,t.data_src))},dt=(e,t)=>{X(e,s=>{N(s,M),oe(s,t)}),N(e,M),oe(e,t)},pt=(e,t)=>{N(e,B),$(e,y,v(e,t.data_src))},ht=(e,t)=>{Ce(e,s=>{N(s,B),$(s,y,v(s,t.data_src))}),N(e,_e),$(e,fe,v(e,t.data_poster)),$(e,y,v(e,t.data_src)),e.load()},ut=(e,t)=>{N(e,ke),$(e,ve,v(e,t.data_src))},gt=(e,t,s)=>{const r=v(e,t.data_bg),a=v(e,t.data_bg_hidpi),o=ue&&a?a:r;!o||(e.style.backgroundImage=`url("${o}")`,xe(e).setAttribute(y,o),Ie(e,t,s))},ft=(e,t,s)=>{const r=v(e,t.data_bg_multi),a=v(e,t.data_bg_multi_hidpi),o=ue&&a?a:r;!o||(e.style.backgroundImage=o,Le(e,t,s))},vt=(e,t,s)=>{const r=v(e,t.data_bg_set);if(!r)return;const a=r.split("|");let o=a.map(l=>`image-set(${l})`);e.style.backgroundImage=o.join(),e.style.backgroundImage===""&&(o=a.map(l=>`-webkit-image-set(${l})`),e.style.backgroundImage=o.join()),Le(e,t,s)},Te={IMG:dt,IFRAME:pt,VIDEO:ht,OBJECT:ut},wt=(e,t)=>{const s=Te[e.tagName];!s||s(e,t)},bt=(e,t,s)=>{const r=Te[e.tagName];!r||(r(e,t),Ie(e,t,s))},mt=["IMG","IFRAME","VIDEO","OBJECT"],yt=e=>mt.indexOf(e.tagName)>-1,ze=(e,t)=>{t&&!it(t)&&!ot(t)&&C(e.callback_finish,t)},ne=(e,t,s)=>{e.addEventListener(t,s),e.llEvLisnrs[t]=s},Et=(e,t,s)=>{e.removeEventListener(t,s)},Z=e=>!!e.llEvLisnrs,xt=(e,t,s)=>{Z(e)||(e.llEvLisnrs={});const r=e.tagName==="VIDEO"?"loadeddata":"load";ne(e,r,t),ne(e,"error",s)},Y=e=>{if(!Z(e))return;const t=e.llEvLisnrs;for(let s in t){const r=t[s];Et(e,s,r)}delete e.llEvLisnrs},Me=(e,t,s)=>{tt(e),Q(s,-1),at(s),m(e,t.class_loading),t.unobserve_completed&&F(e,s)},$t=(e,t,s,r)=>{const a=K(t);Me(t,s,r),A(t,s.class_loaded),k(t,we),C(s.callback_loaded,t,r),a||ze(s,r)},St=(e,t,s,r)=>{const a=K(t);Me(t,s,r),A(t,s.class_error),k(t,G),C(s.callback_error,t,r),s.restore_on_error&&_(t,M),a||ze(s,r)},ee=(e,t,s)=>{const r=xe(e)||e;if(Z(r))return;xt(r,l=>{$t(l,e,t,s),Y(r)},l=>{St(l,e,t,s),Y(r)})},Ct=(e,t,s)=>{et(e),ee(e,t,s),nt(e),gt(e,t,s),ft(e,t,s),vt(e,t,s)},_t=(e,t,s)=>{ee(e,t,s),bt(e,t,s)},te=(e,t,s)=>{yt(e)?_t(e,t,s):Ct(e,t,s)},kt=(e,t,s)=>{e.setAttribute("loading","lazy"),ee(e,t,s),wt(e,t),k(e,me)},ce=e=>{e.removeAttribute(y),e.removeAttribute(q),e.removeAttribute(W)},Nt=e=>{X(e,t=>{ce(t)}),ce(e)},Ve=e=>{X(e,t=>{_(t,M)}),_(e,M)},At=e=>{Ce(e,t=>{_(t,B)}),_(e,_e),e.load()},Lt=e=>{_(e,B)},It=e=>{_(e,ke)},Tt={IMG:Ve,IFRAME:Lt,VIDEO:At,OBJECT:It},zt=e=>{const t=Tt[e.tagName];if(!t){lt(e);return}t(e)},Mt=(e,t)=>{J(e)||K(e)||(m(e,t.class_entered),m(e,t.class_exited),m(e,t.class_applied),m(e,t.class_loading),m(e,t.class_loaded),m(e,t.class_error))},Vt=(e,t)=>{zt(e),Mt(e,t),O(e),Ae(e)},Rt=(e,t,s,r)=>{!s.cancel_on_exit||!Ke(e)||e.tagName==="IMG"&&(Y(e),Nt(e),Ve(e),m(e,s.class_loading),Q(r,-1),O(e),C(s.callback_cancel,e,t,r))},Pt=(e,t,s,r)=>{const a=Ze(e);k(e,Ge),A(e,s.class_entered),m(e,s.class_exited),rt(e,s,r),C(s.callback_enter,e,t,r),!a&&te(e,s,r)},Dt=(e,t,s,r)=>{J(e)||(A(e,s.class_exited),Rt(e,t,s,r),C(s.callback_exit,e,t,r))},Ot=["IMG","IFRAME","VIDEO"],Re=e=>e.use_native&&"loading"in HTMLImageElement.prototype,Ft=(e,t,s)=>{e.forEach(r=>{Ot.indexOf(r.tagName)!==-1&&kt(r,t,s)}),$e(s,0)},Bt=e=>e.isIntersecting||e.intersectionRatio>0,Ht=e=>({root:e.container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),Yt=(e,t,s)=>{e.forEach(r=>Bt(r)?Pt(r.target,r,t,s):Dt(r.target,r,t,s))},jt=(e,t)=>{t.forEach(s=>{e.observe(s)})},qt=(e,t)=>{st(e),jt(e,t)},Wt=(e,t)=>{!pe||Re(e)||(t._observer=new IntersectionObserver(s=>{Yt(s,e,t)},Ht(e)))},Pe=e=>Array.prototype.slice.call(e),D=e=>e.container.querySelectorAll(e.elements_selector),Ut=e=>Pe(e).filter(J),Gt=e=>Qe(e),Jt=e=>Pe(e).filter(Gt),le=(e,t)=>Ut(e||D(t)),Kt=(e,t)=>{Jt(D(e)).forEach(r=>{m(r,e.class_error),O(r)}),t.update()},Qt=(e,t)=>{!S||(t._onlineHandler=()=>{Kt(e,t)},window.addEventListener("online",t._onlineHandler))},Xt=e=>{!S||window.removeEventListener("online",e._onlineHandler)},P=function(e,t){const s=ge(e);this._settings=s,this.loadingCount=0,Wt(s,this),Qt(s,this),this.update(t)};P.prototype={update:function(e){const t=this._settings,s=le(e,t);if($e(this,s.length),de||!pe){this.loadAll(s);return}if(Re(t)){Ft(s,t,this);return}qt(this._observer,s)},destroy:function(){this._observer&&this._observer.disconnect(),Xt(this),D(this._settings).forEach(e=>{Ae(e)}),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){const t=this._settings;le(e,t).forEach(r=>{F(r,this),te(r,t,this)})},restoreAll:function(){const e=this._settings;D(e).forEach(t=>{Vt(t,e)})}};P.load=(e,t)=>{const s=ge(t);te(e,s)};P.resetStatus=e=>{O(e)};S&&Ue(P,window.lazyLoadOptions);class Zt{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:a,events:o,wrapClassName:l,root:d,pagesIndex$:u}){this.showPreview$=new z(!1),this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=a,this.events=o,this.wrapClassName=l,this.sideEffect.addDisposer(this.events.on("togglePreview",()=>{this.showPreview$.setValue(!this.showPreview$.value)})),this.sideEffect.addDisposer(this.showPreview$.subscribe(g=>{this.sideEffect.add(()=>{const i=this.renderPreview(),h=this.renderPreviewMask();if(g){d.appendChild(i),d.appendChild(h),i.scrollTop;const n=i.querySelector("."+this.wrapClassName(`preview-page-${u.value}`));return n&&i.scrollTo({top:n.offsetTop-16}),i.classList.toggle(this.wrapClassName("preview-active"),!0),this.previewLazyLoad=new P({container:this.$preview,elements_selector:"."+this.wrapClassName("preview-page>img")}),()=>{var c;return(c=this.previewLazyLoad)==null?void 0:c.destroy()}}else return i.classList.toggle(this.wrapClassName("preview-active"),!1),this.sideEffect.setTimeout(()=>{i.remove(),h.remove()},500,"preview-remove"),null},"preview-lazyload")}))}destroy(){var t,s;(t=this.$preview)==null||t.remove(),(s=this.$previewMask)==null||s.remove()}renderPreview(){if(this.$preview)return this.$preview;const t=document.createElement("div");return t.className=this.wrapClassName("preview")+" tele-fancy-scrollbar",this.$preview=t,this.sideEffect.addEventListener(t,"wheel",s=>s.stopPropagation(),{passive:!1}),this.sideEffect.addDisposer(this.pages$.subscribe(s=>{var r;this.sideEffect.add(()=>{const a=s.map((o,l)=>{var n;const d=(n=o.thumbnail)!=null?n:o.src.startsWith("ppt")?void 0:o.src;if(!d)return;const u=String(l),g=document.createElement("a");g.className=this.wrapClassName("preview-page")+" "+this.wrapClassName(`preview-page-${l}`),g.setAttribute("href","#"),g.dataset.pageIndex=u;const i=document.createElement("span");i.className=this.wrapClassName("preview-page-name"),i.textContent=String(l+1),i.dataset.pageIndex=u;const h=document.createElement("img");return h.width=o.width,h.height=o.height,h.dataset.src=d,h.dataset.pageIndex=u,g.appendChild(h),g.appendChild(i),t.appendChild(g),g});return()=>a.forEach(o=>o==null?void 0:o.remove())},"render-preview-pages"),(r=this.previewLazyLoad)==null||r.update()})),this.sideEffect.addEventListener(t,"click",s=>{var r;if(this.readonly$.value)return;const a=(r=s.target.dataset)==null?void 0:r.pageIndex;a&&(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),this.events.emit("jumpPage",Number(a)),this.showPreview$.setValue(!1))}),t}renderPreviewMask(){if(this.$previewMask)return this.$previewMask;const t=document.createElement("div");return t.className=this.wrapClassName("preview-mask"),this.$previewMask=t,this.sideEffect.addEventListener(t,"click",s=>{this.readonly$.value||s.target===t&&this.showPreview$.setValue(!1)}),t}}function es(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-sidebar`),s.setAttribute("viewBox","0 0 64 64");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M50 8H14c-3.309 0-6 2.691-6 6v36c0 3.309 2.691 6 6 6h36c3.309 0 6-2.691 6-6V14c0-3.309-2.691-6-6-6zM12 50V14c0-1.103.897-2 2-2h8v40h-8c-1.103 0-2-.897-2-2zm40 0c0 1.103-.897 2-2 2H26V12h24c1.103 0 2 .897 2 2z"),s.appendChild(r),s}function ts(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-left`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M177.81 249.959L337.473 90.295c2.722-2.865 2.651-7.378-.143-10.1-2.793-2.65-7.163-2.65-9.956 0l-164.75 164.75c-2.793 2.793-2.793 7.306 0 10.1l164.75 164.75c2.865 2.722 7.378 2.65 10.099-.143 2.651-2.794 2.651-7.163 0-9.957L177.809 249.959z"),s.appendChild(r),s}function ss(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-right`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M322.19 250.041L162.527 409.705c-2.722 2.865-2.651 7.378.143 10.1 2.793 2.65 7.163 2.65 9.956 0l164.75-164.75c2.793-2.793 2.793-7.306 0-10.1l-164.75-164.75c-2.865-2.722-7.378-2.65-10.099.143-2.651 2.794-2.651 7.163 0 9.957l159.664 159.736z"),s.appendChild(r),s}function rs(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-play`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M418.158 257.419L174.663 413.33c-6.017 3.919-15.708 3.772-21.291-.29-2.791-2.018-4.295-4.483-4.295-7.084V94.109c0-5.65 6.883-10.289 15.271-10.289 4.298 0 8.391 1.307 11.181 3.332l242.629 155.484c6.016 3.917 6.451 10.292.649 14.491-.216.154-.432.154-.649.292zM170.621 391.288l223.116-141.301L170.71 107.753l-.089 283.535z"),s.appendChild(r),s}function as(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-pause`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M312.491 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261zM165.257 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261z"),s.appendChild(r),s}function is(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-save`),s.setAttribute("viewBox","0 0 448 512");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M224 256c-35.2 0-64 28.8-64 64c0 35.2 28.8 64 64 64c35.2 0 64-28.8 64-64C288 284.8 259.2 256 224 256zM433.1 129.1l-83.9-83.9C341.1 37.06 328.8 32 316.1 32H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h320c35.35 0 64-28.65 64-64V163.9C448 151.2 442.9 138.9 433.1 129.1zM128 80h144V160H128V80zM400 416c0 8.836-7.164 16-16 16H64c-8.836 0-16-7.164-16-16V96c0-8.838 7.164-16 16-16h16v104c0 13.25 10.75 24 24 24h192C309.3 208 320 197.3 320 184V83.88l78.25 78.25C399.4 163.2 400 164.8 400 166.3V416z"),s.appendChild(r),s}function os(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-spinner`),s.setAttribute("viewBox","0 0 512 512");const r=document.createElementNS(t,"path");r.setAttribute("fill","currentColor"),r.setAttribute("d","M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z");const a=document.createElementNS(t,"animateTransform");a.setAttribute("attributeName","transform"),a.setAttribute("attributeType","xml"),a.setAttribute("type","rotate"),a.setAttribute("from","0 256 256"),a.setAttribute("to","360 256 256"),a.setAttribute("begin","0s"),a.setAttribute("dur","2s"),a.setAttribute("fill","freeze"),a.setAttribute("repeatCount","indefinite"),r.appendChild(a);const o=document.createElementNS(t,"text");return o.setAttribute("x","125"),o.setAttribute("y","345"),o.setAttribute("data-id","progress"),o.style.fontSize="246px",o.textContent="20",s.appendChild(o),s.appendChild(r),s}class ns{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:a,events:o,playable:l,wrapClassName:d,pagesIndex$:u,root:g}){this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=a,this.events=o,this.wrapClassName=d,this.pagesIndex$=u,this.playable=l,this.$footer=this.render(),g.appendChild(this.$footer)}destroy(){this.$footer.remove()}render(){const t=document.createElement("div");t.className=this.wrapClassName("footer"),this.sideEffect.addDisposer(this.readonly$.subscribe(n=>t.classList.toggle(this.wrapClassName("readonly"),n)));const s=this.renderFooterBtn("btn-sidebar",es(this.namespace));this.sideEffect.addEventListener(s,"click",()=>{this.readonly$.value||this.events.emit("togglePreview")}),t.appendChild(s),this.sideEffect.addDisposer(this.pages$.subscribe(n=>{const c=n.some(p=>p.thumbnail||!p.src.startsWith("ppt"));s.style.display=c?"":"none"}));const r=document.createElement("div");r.className=this.wrapClassName("page-jumps");const a=this.renderFooterBtn("btn-page-back",ts(this.namespace));if(this.sideEffect.addEventListener(a,"click",()=>{this.readonly$.value||this.events.emit("back")}),r.appendChild(a),this.playable){const n=this.renderFooterBtn("btn-page-play",rs(this.namespace),as(this.namespace));this.sideEffect.addEventListener(n,"click",()=>{this.readonly$.value||(n.classList.toggle(this.wrapClassName("footer-btn-playing"),!0),this.events.emit("play"),this.sideEffect.setTimeout(()=>n.classList.toggle(this.wrapClassName("footer-btn-playing"),!1),500,"returnPlay"))}),r.appendChild(n)}const o=this.renderFooterBtn("btn-page-next",ss(this.namespace));this.sideEffect.addEventListener(o,"click",()=>{this.readonly$.value||this.events.emit("next")}),r.appendChild(o);const l=document.createElement("div");l.className=this.wrapClassName("page-number");const d=document.createElement("input");d.className=this.wrapClassName("page-number-input"),this.sideEffect.addDisposer(this.readonly$.subscribe(n=>d.disabled=n)),this.sideEffect.addDisposer(this.pagesIndex$.subscribe(n=>d.value=String(n+1))),this.sideEffect.addEventListener(d,"blur",()=>{d.value=String(this.pagesIndex$.value+1)}),this.sideEffect.addEventListener(d,"change",()=>{if(this.readonly$.value)return;const n=d.value?Number(d.value)-1:NaN;n>=0?this.events.emit("jumpPage",n):d.value=String(this.pagesIndex$.value+1)});const u=document.createElement("span");this.sideEffect.addDisposer(this.pages$.subscribe(n=>{u.textContent=" / "+n.length})),l.appendChild(d),l.appendChild(u),t.appendChild(r),t.appendChild(l);const g=is(this.namespace),i=os(this.namespace);i.style.display="none";const h=document.createElement("button");return h.className=this.wrapClassName("footer-btn"),h.appendChild(g),h.appendChild(i),this.sideEffect.addEventListener(h,"click",()=>{this.events.emit("save")}),this.events.on("saveProgress",n=>{if(n<99){i.style.display="block",g.style.display="none";const c=i.querySelector("[data-id]");c&&(c.textContent=n.toString().padStart(2,"0"))}else i.style.display="none",g.style.display="block"}),t}renderFooterBtn(t,s,r){const a=document.createElement("button");return a.className=this.wrapClassName("footer-btn")+" "+this.wrapClassName(t),a.appendChild(s),r&&a.appendChild(r),a}}class cs{constructor({readonly$:t,pagesIndex$:s,previewRoot:r,footerRoot:a,pages$:o,playable:l}){this.wrapClassName=d=>`${this.namespace}-${d}`,this.namespace="netless-app-docs-viewer",this.sideEffect=new j,this.events=new Fe,this.preview=new Zt({pages$:o,readonly$:t,pagesIndex$:s,root:r,sideEffect:this.sideEffect,events:this.events,namespace:this.namespace,wrapClassName:this.wrapClassName}),this.footer=new ns({pages$:o,readonly$:t,playable:l,pagesIndex$:s,root:a,namespace:this.namespace,sideEffect:this.sideEffect,events:this.events,wrapClassName:this.wrapClassName})}destroy(){this.preview.destroy(),this.footer.destroy(),this.sideEffect.flushAll(),this.events.destroy()}}function ls(e,t,s){return Math.min(Math.max(e,t),s)}class ds{constructor(t){var s,r,a;this.velocity=0,this._paused=!0,this._animationFrameID=null,this._loopTimestamp=0,this.looper=o=>{var l;if(this._paused)return;let d=Math.floor((o-this._loopTimestamp)/1e3*60)+1;for(this._loopTimestamp=o;d-- >0;)this.stepper();(l=this.onStep)==null||l.call(this,this.current),this._paused?this._animationFrameID=null:this._animationFrameID=window.requestAnimationFrame(this.looper)},this.current=(s=t.start)!=null?s:0,this.target=this.current,this.stiffness=(r=t.stiffness)!=null?r:170,this.damping=(a=t.damping)!=null?a:26,this.onStep=t.onStep}get paused(){return this._paused}stepTo(t,s){var r;this._paused&&s!=null&&(this.current=s),this._paused=!1,this.target=t,(r=this.onStep)==null||r.call(this,this.current),this._loopTimestamp=Date.now(),this._animationFrameID=window.requestAnimationFrame(this.looper)}pause(){this._paused=!0,this._animationFrameID!=null&&window.cancelAnimationFrame(this._animationFrameID)}destroy(){this.pause(),this.onStep=void 0}stepper(){const t=-this.stiffness*(this.current-this.target),s=-this.damping*this.velocity,r=this.velocity+(t+s)/60,a=this.current+r/60;Math.abs(r-0)<.01&&Math.abs(a-this.target)<.01?(this.current=this.target,this.velocity=0,this._paused=!0):(this.current=a,this.velocity=r)}}class ps{constructor(t,s,r,a,o,l){this.index=t,this.lastVisit=Date.now(),this.sideEffect=new j;const d=T(s,n=>n[t]||{width:0,height:0}),u=x([d,r],([n,c])=>(c.width-n.width)/2),g=x([o,l],([n,c])=>(n[t]||0)-c),i=document.createElement("div");i.className="page-renderer-page",i.dataset.index=`${t}`;const h=document.createElement("img");h.className="page-renderer-page-img",i.appendChild(h),this.sideEffect.addDisposer([x([d,a]).subscribe(([n,c])=>{i.style.width=`${n.width*c}px`,i.style.height=`${n.height*c}px`}),d.subscribe(n=>{n.thumbnail&&(i.style.backgroundImage=`url("${n.thumbnail}")`),h.width=n.width,h.height=n.height,h.src=n.src}),x([u,g,a]).subscribe(([n,c,p])=>{i.style.transform=`translate(${n*p}px, ${c*p}px)`})]),this.$page=i}destroy(){this.sideEffect.flushAll(),this.$page.remove()}}class hs{constructor(t,s,r,a,o){this.pages$=t,this.pagesSize$=s,this.scale$=r,this.pagesYs$=a,this.pagesScrollTop$=o,this.els=new Map,this.maxElCount=200,this.gcTimer=null,this.gc=()=>{var l;if(this.gcTimer=null,this.els.size>this.maxElCount){const d=[...this.els.values()].sort((u,g)=>g.lastVisit-u.lastVisit);for(let u=Math.floor(this.maxElCount/4);u<d.length;u++)(l=this.els.get(d[u].index))==null||l.destroy(),this.els.delete(d[u].index)}},this.schedule=window.requestIdleCallback||(l=>window.setTimeout(l,5e3)),this.cancelSchedule=window.cancelIdleCallback||window.clearTimeout}getEl(t){let s=this.els.get(t);return s||(s=new ps(t,this.pages$,this.pagesSize$,this.scale$,this.pagesYs$,this.pagesScrollTop$),this.els.set(t,s)),s.lastVisit=Date.now(),this.els.size>this.maxElCount&&this.gcTimer===null&&(this.gcTimer=this.schedule(this.gc)),s}destroy(){this.els.forEach(t=>t.destroy()),this.els.clear(),this.gcTimer!==null&&(this.cancelSchedule(this.gcTimer),this.gcTimer=null)}}class us{constructor({pagesScrollTop$:t,containerRect$:s,pages$:r,pagesSize$:a}){this.sideEffect=new j,r=T(r,c=>c.map(p=>{if(p.thumbnail)return p;try{const f=new URL(p.src);return f.searchParams.set("x-oss-process","image/resize,l_50"),{...p,thumbnail:f.toString()}}catch(f){return console.error(f),p}}));const o=T(r,c=>{const p=Array(c.length);for(let f=0;f<c.length;f++)p[f]=f>0?p[f-1]+c[f-1].height:0;return p}),l=T(r,c=>{let p=1/0;for(let f=c.length-1;f>=0;f--)c[f].height<=p&&(p=c[f].height);return p}),d=x([t,o,r],([c,p,f])=>{if(p.length!==f.length)return d.value;for(let b=0;b<p.length;b++)if(p[b]+f[b].height-c>=.001)return b;return p.length-1}),u=x([s,a],([c,p])=>c.width/p.width||1),g=x([r,s,l,u],([c,p,f,b])=>ls(Math.ceil(p.height/b/f/2),1,c.length));Be(this,{pagesScrollTop:t,containerRect:s,pages:r,pagesSize:a,pagesIndex:d,pagesYs:o,pagesMinHeight:l,scale:u}),this.pageElManager=new hs(r,a,u,o,t),this.$pages=this.renderPages();const i=new z(!1);this.sideEffect.addDisposer(i.subscribe(c=>this.$pages.classList.toggle("is-hwa",c)));const h=()=>i.setValue(!1),n=()=>{this.sideEffect.setTimeout(h,1e3,"turn-off-hwa"),i.setValue(!0)};this.sideEffect.addDisposer(x([d,g,r]).subscribe(([c,p,f])=>{n();const b=Math.max(c-p,0),se=Math.min(c+p,f.length-1);for(let E=0;E<this.$pages.children.length;E++){const L=this.$pages.children[E],re=Number(L.dataset.index);re>=b&&re<=se||(L.remove(),E--)}for(let E=b;E<=se;E++){const L=this.pageElManager.getEl(E);L.$page.parentElement!==this.$pages&&this.$pages.appendChild(L.$page)}}))}renderPages(){const t=document.createElement("div");return t.className="page-renderer-pages-container",this.sideEffect.addDisposer(this._containerRect$.subscribe(s=>{t.style.width=`${s.width}px`,t.style.height=`${s.height}px`}),"render-pages-size"),t}destroy(){this.sideEffect.flushAll(),this.$pages.remove(),this.pageElManager.destroy()}}function gs(e,t){return e.width===t.width&&e.height===t.height}function fs(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function I(e,t,s){return Math.min(Math.max(e,t),s)}class vs{constructor(){w(this,"disposable",new He);w(this,"pagesScrollTop$");w(this,"pages$");w(this,"pagesSize$");w(this,"readonly$");w(this,"pageRenderer");w(this,"viewer");w(this,"stepper");w(this,"$docsViewer");this.readonly$=new z(!1),this.pages$=new z([]),this.pagesScrollTop$=new z(0),this.pagesSize$=T(this.pages$,i=>{let h=0,n=0;for(let c=i.length-1;c>=0;c--){const p=i[c];p.width>h&&(h=p.width),n+=p.height}return{width:Math.max(1,h),height:Math.max(1,n)}},{compare:gs});const t=document.createElement("div");this.$docsViewer=t,t.tabIndex=0,t.className="file-preview-netless-container";const s=document.createElement("style");s.textContent=qe,t.appendChild(s);const r=document.createElement("div");r.className="file-preview-netless-body",t.appendChild(r);const a=document.createElement("div");a.className="file-preview-netless-operate",r.appendChild(a);const o=document.createElement("div");o.className="file-preview-netless-footer",t.appendChild(o);const l=()=>{const i=r.getBoundingClientRect();return{x:i.x,y:i.y,width:i.width,height:i.height}},d=new Ye(l(),{beforeSubscribe:i=>{let h=0;function n(){h=requestAnimationFrame(n),i(l())}return n(),()=>cancelAnimationFrame(h)},compare:fs});this.pageRenderer=new us({pagesScrollTop$:this.pagesScrollTop$,containerRect$:d,pages$:this.pages$,pagesSize$:this.pagesSize$}),r.appendChild(this.pageRenderer.$pages),this.viewer=new cs({readonly$:this.readonly$,pagesIndex$:this.pageRenderer._pagesIndex$,previewRoot:r,footerRoot:o,pages$:this.pages$,playable:!1}),this.stepper=new ds({start:this.pagesScrollTop$.value,onStep:i=>{this.pagesScrollTop$.setValue(i)}}),this.disposable.push([this.viewer.events.on("jumpPage",i=>this.userScrollToPageIndex(i)),this.viewer.events.on("next",()=>{this.userScrollByPercent(.8)}),this.viewer.events.on("back",()=>{this.userScrollByPercent(-.8)})]),this.disposable.addEventListener(a,"wheel",i=>{!this.readonly$.value&&this.stepper.paused&&(i.stopPropagation(),i.preventDefault(),this.pagesScrollTop$.setValue(I(this.pagesScrollTop$.value+i.deltaY,0,this.pagesSize$.value.height-d.value.height/this.pageRenderer._scale$.value)))},{passive:!1});let u=NaN;this.disposable.addEventListener(a,"touchstart",i=>{i.stopPropagation(),i.preventDefault(),!this.readonly$.value&&i.touches.length>0&&this.stepper.paused&&(u=i.touches[0].pageY)},{passive:!1,capture:!0}),this.disposable.addEventListener(a,"touchmove",i=>{if(i.stopPropagation(),i.preventDefault(),!this.readonly$.value&&i.touches.length>0&&this.stepper.paused&&!Number.isNaN(u)){const h=u-i.touches[0].pageY;u=i.touches[0].pageY,this.pagesScrollTop$.setValue(I(this.pagesScrollTop$.value+h*3,0,this.pagesSize$.value.height-d.value.height/this.pageRenderer._scale$.value))}},{passive:!1,capture:!0});const g=i=>{i.stopPropagation(),i.preventDefault(),u=NaN};this.disposable.addEventListener(a,"touchend",g,{passive:!1,capture:!0}),this.disposable.addEventListener(a,"touchcancel",g,{passive:!1,capture:!0}),this.disposable.addEventListener(window,"keyup",i=>{if(!this.readonly$.value)switch(i.key){case"PageDown":{this.userScrollByPercent(.8);break}case"PageUp":{this.userScrollByPercent(-.8);break}case"ArrowLeft":{this.userScrollByPercent(-.25);break}case"ArrowRight":{this.userScrollByPercent(.25);break}case"ArrowDown":{this.userScrollByPercent(.5);break}case"ArrowUp":{this.userScrollByPercent(-.5);break}}})}userScrollToPageIndex(t){if(t=I(t,0,this.pages$.value.length-1),!this.readonly$.value&&!Number.isNaN(t)){const s=this.pageRenderer.pagesYs[t];s>=0&&this.stepper.stepTo(s+5/this.pageRenderer.scale)}}userScrollByPercent(t){this.readonly$.value||this.stepper.stepTo(I(this.pageRenderer.pagesScrollTop+this.pageRenderer.containerRect.height/this.pageRenderer.scale*I(t,-1,1),0,this.pageRenderer.pagesSize.height-this.pageRenderer.containerRect.height/this.pageRenderer.scale))}async preview(t,s){var r;if(t.resourceType===ae.WhiteboardConvert||t.resourceType===ae.WhiteboardProjector){const a=await je({dynamic:!1,resourceType:t.resourceType,meta:t.meta});(r=a.progress)!=null&&r.convertedFileList&&(this.pagesScrollTop$.setValue(0),this.pages$.setValue(a.progress.convertedFileList.map(o=>({width:o.width,height:o.height,src:o.conversionFileUrl,thumbnail:o.preview||o.conversionFileUrl})))),s.appendChild(this.$docsViewer)}}async destroy(){this.disposable.flushAll(),this.$docsViewer.remove(),this.pagesScrollTop$.destroy(),this.pages$.destroy(),this.pagesSize$.destroy(),this.pageRenderer.destroy(),this.viewer.destroy()}}class ys{constructor(){w(this,"staticDocsViewer")}async preview(t,s){await(this.staticDocsViewer||(this.staticDocsViewer=new vs)).preview(t,s)}async destroy(){var t;(t=this.staticDocsViewer)==null||t.destroy()}}export{ys as FilePreviewNetless};
//# sourceMappingURL=index.9530d258.js.map
