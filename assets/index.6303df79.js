import{q as e,m as i,aZ as Z,k as h,b3 as j,A as x,aw as K,aB as ae,aE as se,bm as oe,az as f,b2 as u,x as le,dm as ce,cP as ie,n as ne,bv as $,b8 as re}from"./index.43c4ffc0.js";import{U as ue}from"./UserSettingLayoutContainer.e2f93cae.js";import{u as he}from"./hooks.a08a5162.js";import{b as z,d as de,S as E,D as _,c as pe,s as me,f as ge,g as M,e as ve,h as we,u as Ne}from"./SVGDelete.23bfc507.js";import{S as fe}from"./SVGMore.b630e8ac.js";import{u as O}from"./lifecycle.32153b61.js";import{W}from"./index.10dbff5d.js";import{e as Q}from"./routes.73fc4946.js";import{T as J}from"./Table.77c4b21e.js";import"./SVGCircleInfoOutlined.7081c7f0.js";import"./use-login-check.e01c4832.js";const X=({active:s,className:t="",...o})=>e("svg",{className:`${t} flat-icon ${s?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...o,children:e("path",{className:"flat-icon-fill-color",clipRule:"evenodd",d:"M12 3.375a8.625 8.625 0 1 0 0 17.25 8.625 8.625 0 0 0 0-17.25Zm.625 8H16v1.25h-3.375V16h-1.25v-3.375H8v-1.25h3.375V8h1.25v3.375Z",fill:"#5D6066",fillRule:"evenodd"})}),be=({active:s,className:t="",...o})=>i("svg",{className:`${t} flat-icon ${s?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...o,children:[e("path",{className:"flat-icon-fill-color",d:"m9 20-.442.442a.625.625 0 0 0 .442.183V20Zm-4-4h-.625c0 .166.066.325.183.442L5 16ZM17 6h.625A.625.625 0 0 0 17 5.375V6Zm-2 13.375H9v1.25h6v-1.25Zm-5.558.183-4-4-.884.884 4 4 .884-.884ZM5.625 16V8h-1.25v8h1.25ZM7 6.625h10v-1.25H7v1.25ZM16.375 6v12h1.25V6h-1.25ZM5.625 8c0-.76.616-1.375 1.375-1.375v-1.25A2.625 2.625 0 0 0 4.375 8h1.25ZM15 20.625A2.625 2.625 0 0 0 17.625 18h-1.25c0 .76-.616 1.375-1.375 1.375v1.25Z",fill:"#5D6066"}),e("path",{className:"flat-icon-stroke-color",d:"M5 16h4v4",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),e("path",{className:"flat-icon-fill-color",d:"M19.625 18V6h-1.25v12h1.25ZM17 3.375H7v1.25h10v-1.25ZM19.625 6A2.625 2.625 0 0 0 17 3.375v1.25c.76 0 1.375.616 1.375 1.375h1.25Z",fill:"#5D6066"})]}),Ce=({active:s,className:t="",...o})=>i("svg",{className:`${t} flat-icon ${s?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...o,children:[e("path",{className:"flat-icon-fill-color",d:"M18.375 12v5h1.25v-5h-1.25ZM17 18.375H7v1.25h10v-1.25ZM5.625 17V7h-1.25v10h1.25ZM7 5.625h5v-1.25H7v1.25ZM5.625 7c0-.76.616-1.375 1.375-1.375v-1.25A2.625 2.625 0 0 0 4.375 7h1.25ZM7 18.375c-.76 0-1.375-.616-1.375-1.375h-1.25A2.625 2.625 0 0 0 7 19.625v-1.25ZM18.375 17c0 .76-.616 1.375-1.375 1.375v1.25A2.625 2.625 0 0 0 19.625 17h-1.25Z",fill:"#5D6066"}),e("path",{className:"flat-icon-stroke-color",d:"m19 5-7 7",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]});const ke=({navigate:s})=>{const t=Z(),o=O(),[n,l]=h.exports.useState(null);h.exports.useEffect(()=>{o(z(1,50)).then(l)},[o]);const m=h.exports.useCallback(async(d,g)=>{d==="revoke"&&j.confirm({content:t("delete-oauth-tips",{appName:g.appName}),onOk:async()=>{await o(de(g.oauthUUID)),await o(z(1,50)).then(l)}})},[o,t]);return i("section",{className:"oauth-list",children:[i("h3",{className:"oauth-list-header",children:[e("span",{className:"oauth-list-title",children:t("oauth-app-name")}),e(x,{onClick:()=>s("new"),children:t("create-oauth-app")})]}),n===null?e("div",{className:"oauth-list-loading",children:e(W,{indicator:e(K,{spin:!0})})}):n.length===0?e("div",{className:"oauth-list-empty",children:t("no-data")}):e("ul",{className:"oauth-list-table",children:n.map(d=>i("li",{className:"oauth-list-item",children:[e("img",{alt:"logo",className:"oauth-list-item-logo",src:d.logoURL}),e("a",{className:"oauth-list-item-name",onClick:()=>s("edit",d.oauthUUID),children:d.appName}),e(ae,{overlay:e(se,{items:[{key:"revoke",label:t("delete-app"),className:"oauth-list-item-revoke"}],onClick:g=>m(g.key,d)}),placement:"bottomRight",trigger:["click"],children:e("button",{className:"oauth-list-item-more",children:e(fe,{})})})]},d.oauthUUID))})]})};function S(s){if(!s.startsWith("https://"))return!1;try{return new URL(s),!0}catch{return!1}}function Y(){const s=Z(),t=h.exports.useMemo(()=>[{dataIndex:"scope",title:s("oauth-app-scope")},{dataIndex:"desc",title:s("oauth-app-desc")}],[s]),o=h.exports.useMemo(()=>[{scope:_.UserAvatarRead,desc:s("oauth-scope-user-avatar-read")},{scope:_.UserNameRead,desc:s("oauth-scope-user-name-read")},{scope:_.UserUUIDRead,desc:s("oauth-scope-user-uuid-read")}],[s]);return{scopesColumns:t,scopesDataSource:o}}const ye=({navigate:s})=>{const t=Z(),o=O(),n=oe(),[l,m]=h.exports.useState(""),[d,g]=h.exports.useState(""),[b,r]=h.exports.useState(""),[p,R]=h.exports.useState(""),[N,y]=h.exports.useState([]),[L,I]=h.exports.useState([]),[T,D]=h.exports.useState(!1),{scopesColumns:H,scopesDataSource:V}=Y(),q=c=>{const w=N.slice();w.splice(c,1),y(w)},F=()=>{if(!p){u.error(t("oauth-missing-callback-url"));return}if(!S(p)){u.error(t("oauth-invalid-callback-url"));return}y([...N,p]),R("")},U=(c,w)=>{const k=N.slice();k[c]=w,y(k)},B=async()=>{if(!l){u.error(t("oauth-missing-app-name"));return}if(!d){u.error(t("oauth-missing-app-desc"));return}if(!b){u.error(t("oauth-missing-homepage-url"));return}if(!S(b)){u.error(t("oauth-invalid-homepage-url"));return}if(N.length===0){u.error(t("oauth-missing-callbacks-url"));return}if(N.some(c=>!S(c))){u.error(t("oauth-invalid-callback-url"));return}if(L.length===0){u.error(t("oauth-missing-scopes"));return}D(!0);try{const w=await o(pe({appName:l,appDesc:d,homepageURL:b,callbacksURL:N,scopes:L}));s("edit",w.oauthUUID)}catch(c){D(!1),Q(c)}};return i("section",{className:"new-oauth",children:[e("h1",{className:"new-oauth-title",children:t("create-oauth-app")}),e("label",{className:"new-oauth-subtitle is-required",htmlFor:"new-oauth-app-name",children:t("oauth-app-name")}),e(f,{autoComplete:"off",className:"new-oauth-input",id:"new-oauth-app-name",maxLength:20,placeholder:t("oauth-text-placeholder"),value:l,onChange:c=>m(c.target.value)}),e("label",{className:"new-oauth-subtitle is-required",htmlFor:"new-oauth-homepage-url",children:t("oauth-homepage-url")}),e(f,{autoComplete:"off",className:"new-oauth-input",id:"new-oauth-homepage-url",maxLength:100,placeholder:t("oauth-homepage-url-desc"),value:b,onChange:c=>r(c.target.value)}),e("label",{className:"new-oauth-subtitle is-required",htmlFor:"new-oauth-app-desc",children:t("oauth-app-description")}),e(f.TextArea,{className:"new-oauth-input new-oauth-textarea",id:"new-oauth-app-desc",maxLength:300,placeholder:t("oauth-text-placeholder"),rows:4,value:d,onChange:c=>g(c.target.value)}),e("h2",{className:"new-oauth-subtitle is-required",children:t("oauth-callback-url")}),N.map((c,w)=>i("div",{className:"new-oauth-input-wrapper",children:[e(f,{autoComplete:"off",className:"new-oauth-input",value:c,onChange:k=>U(w,k.target.value)}),e("button",{className:"new-oauth-input-btn new-oauth-input-delete",title:t("delete"),onClick:()=>q(w),children:e(E,{})})]},w)),N.length<5&&i("div",{className:"new-oauth-input-wrapper",children:[e(f,{autoComplete:"off",className:"new-oauth-input",value:p,onChange:c=>R(c.target.value)}),e("button",{className:"new-oauth-input-btn new-oauth-input-add",title:t("add"),onClick:F,children:e(X,{})})]}),e("h2",{className:"new-oauth-subtitle is-required",children:t("oauth-scopes")}),e(J,{className:"new-oauth-table",columns:H,dataSource:V,locale:{emptyText:t("no-data")},pagination:!1,rowKey:"scope",rowSelection:{type:"checkbox",selectedRowKeys:L,onChange:I}}),i("div",{className:"new-oauth-action",children:[e(x,{onClick:()=>n.goBack(),children:t("cancel")}),e(x,{loading:T,type:"primary",onClick:B,children:t("oauth-register-app")})]})]})},P="data:image/svg+xml;charset=utf8,%3csvg width='48' height='48' viewBox='0 0 48 48' fill='none' xmlns='http://www.w3.org/2000/svg'%3e %3cpath fill-rule='evenodd' clip-rule='evenodd' d='M36.5401 12.4227C32.9766 8.85912 27.1989 8.85912 23.6354 12.4227C20.9903 15.0677 20.3073 18.9342 21.5916 22.2107C21.7185 22.5345 21.6416 22.9028 21.3956 23.1487L9.75 34.7944V39.2138H14.1694L15.8471 37.5361L16.5023 34.2603C16.5715 33.914 16.8423 33.6432 17.1887 33.5739L20.4644 32.9188L22.3984 30.9848L25.8155 27.5677C26.0614 27.3218 26.4296 27.2449 26.7534 27.3717C30.0296 28.6552 33.8954 27.9721 36.5401 25.3273C40.1036 21.7638 40.1036 15.9862 36.5401 12.4227ZM22.398 11.1852C26.6449 6.93826 33.5306 6.93826 37.7775 11.1852C42.0245 15.4322 42.0245 22.3178 37.7775 26.5648C34.7692 29.5731 30.4383 30.4493 26.6601 29.198L23.6359 32.2222L21.5145 34.3436C21.3924 34.4657 21.2368 34.549 21.0674 34.5828L18.1039 35.1755L17.5112 38.1391C17.4773 38.3085 17.394 38.464 17.2719 38.5862L15.1506 40.7075C14.9865 40.8716 14.7639 40.9638 14.5319 40.9638H8.875C8.39175 40.9638 8 40.572 8 40.0888V34.4319C8 34.1999 8.09219 33.9773 8.25628 33.8132L19.7653 22.3042C18.5132 18.5257 19.3893 14.1939 22.398 11.1852ZM30.8832 18.0802C30.4439 17.6409 29.7316 17.6409 29.2923 18.0802C28.8529 18.5196 28.8529 19.2319 29.2923 19.6712C29.7316 20.1106 30.4439 20.1106 30.8832 19.6712C31.3226 19.2319 31.3226 18.5196 30.8832 18.0802ZM28.0548 16.8428C29.1776 15.7201 30.9979 15.7201 32.1207 16.8428C33.2434 17.9656 33.2434 19.7859 32.1207 20.9087C30.9979 22.0314 29.1776 22.0314 28.0548 20.9087C26.9321 19.7859 26.9321 17.9656 28.0548 16.8428ZM23.8128 23.913L16.7417 30.984L17.9791 32.2215L25.0502 25.1504L23.8128 23.913Z' fill='%235D6066'/%3e %3c/svg%3e",Le=({logoURL:s,onUpload:t})=>{const o=O(),[n,l]=h.exports.useState(!1),m=async d=>{const g=(d.target.files||[])[0];g&&t&&(l(!0),await o(t(g).catch(console.error)),l(!1))};return i("div",{className:le("edit-oauth-logo",{"is-loading":n}),children:[e("input",{accept:".png,.jpg,.jpeg",className:"edit-oauth-logo-input",type:"file",onChange:m}),e("img",{alt:"logo",className:"edit-oauth-logo-img",src:s}),e("div",{className:"edit-oauth-logo-btn",children:e(Ce,{})})]})},Ue=5242880;async function Se(s,t,o){if(t.size>=Ue)throw u.info(o("upload-logo-size-limit")),new Error("upload logo size limit");const n=await me({fileName:t.name,fileSize:t.size,oauthUUID:s}),l=new FormData,m=encodeURIComponent(t.name);l.append("key",n.ossFilePath),l.append("name",t.name),l.append("policy",n.policy),l.append("OSSAccessKeyId",ce.accessKey),l.append("success_action_status","200"),l.append("callback",""),l.append("signature",n.signature),l.append("Content-Disposition",`attachment; filename="${m}"; filename*=UTF-8''${m}`),l.append("file",t),await ie.post(n.ossDomain,l,{headers:{"Content-Type":"multipart/form-data"}}),await ge({oauthUUID:s,fileUUID:n.fileUUID})}const xe=({oauthUUID:s})=>{const t=Z(),o=O(),[n,l]=h.exports.useState(""),[m,d]=h.exports.useState(""),[g,b]=h.exports.useState(""),[r,p]=h.exports.useState(null),[R,N]=h.exports.useState(!1),{scopesColumns:y,scopesDataSource:L}=Y();h.exports.useEffect(()=>{o(M(s)).then(p)},[s,o]);const I=async()=>{const{secretUUID:a,clientSecret:v}=await o(ve(s));l(a),d(v),await o(M(s)).then(p)},T=async()=>{m&&(await navigator.clipboard.writeText(m),u.success(t("copy-success")))},D=async a=>{j.confirm({content:t("oauth-delete-secret-confirm"),onOk:async()=>{await o(we(a)),await o(M(s)).then(p)}})};if(r===null)return e("section",{className:"edit-oauth",children:e(W,{indicator:e(K,{spin:!0})})});const H=async a=>{try{await Se(s,a,t),await o(M(s)).then(p)}catch(v){throw u.info(t("upload-logo-failed")),v}},V=a=>{p({...r,appName:a})},q=a=>{p({...r,homepageURL:a})},F=a=>{p({...r,appDesc:a})},U=r.scopes,B=a=>{p({...r,scopes:a})},c=r.callbacksURL,w=()=>{g&&(p({...r,callbacksURL:[...c,g]}),b(""))},k=a=>{p({...r,callbacksURL:c.filter((v,C)=>C!==a)})},ee=(a,v)=>{c[a]=v,p({...r,callbacksURL:c})},te=async()=>{const{appName:a,appDesc:v,homepageURL:C,callbacksURL:G}=r;if(!a){u.error(t("oauth-missing-app-name"));return}if(!v){u.error(t("oauth-missing-app-desc"));return}if(!C){u.error(t("oauth-missing-homepage-url"));return}if(!S(C)){u.error(t("oauth-invalid-homepage-url"));return}if(G.length===0){u.error(t("oauth-missing-callbacks-url"));return}if(G.some(A=>!S(A))){u.error(t("oauth-invalid-callback-url"));return}if(U.length===0){u.error(t("oauth-missing-scopes"));return}N(!0);try{await o(Ne(s,{appName:a,appDesc:v,homepageURL:C,callbacksURL:G,scopes:U})),u.success(t("oauth-update-success"))}catch(A){Q(A)}finally{N(!1)}};return i("section",{className:"edit-oauth",children:[e("h1",{className:"edit-oauth-title",children:r.appName}),e("h2",{className:"edit-oauth-subtitle",children:t("client-id")}),e("p",{className:"edit-oauth-content",style:{userSelect:"text"},children:r.clientID}),e("h2",{className:"edit-oauth-subtitle",children:t("client-secrets")}),e("p",{className:"edit-oauth-content",children:t("client-secret-desc")}),e("div",{className:"edit-oauth-new-secret-wrapper",children:e(x,{className:"edit-oauth-new-secret",size:"small",type:"primary",onClick:I,children:t("create-client-secret")})}),n&&i(ne,{children:[e("p",{className:"edit-oauth-copy-secret-tip",children:t("oauth-copy-secret-tip")}),i("div",{className:"edit-oauth-secret-wrapper is-new","data-secret-uuid":n,children:[e("div",{className:"edit-oauth-secret-icon",children:e("img",{alt:"key",src:P})}),i("div",{className:"edit-oauth-secret",children:[i("div",{className:"edit-oauth-secret-row",children:[e("span",{className:"edit-oauth-secret-content",style:{userSelect:"text"},children:m}),e("button",{className:"edit-oauth-secret-btn",onClick:T,children:e(be,{})})]}),e("div",{className:"edit-oauth-secret-row",children:i("span",{children:[t("created-at"),": ",$(new Date,"yyyy-MM-dd HH:mm")]})})]})]})]}),r.secrets.filter(a=>a.secretUUID!==n).map(a=>i("div",{className:"edit-oauth-secret-wrapper","data-secret-uuid":a.secretUUID,children:[e("div",{className:"edit-oauth-secret-icon",children:e("img",{alt:"key",src:P})}),i("div",{className:"edit-oauth-secret",children:[e("div",{className:"edit-oauth-secret-row",children:e("span",{className:"edit-oauth-secret-content",children:a.clientSecret})}),e("div",{className:"edit-oauth-secret-row",children:i("span",{children:[t("created-at"),": ",$(a.createdAt,"yyyy-MM-dd HH:mm")]})})]}),e("div",{className:"edit-oauth-secret-action",children:e("button",{className:"edit-oauth-delete-btn",onClick:()=>D(a.secretUUID),children:e(E,{})})})]},a.secretUUID)),e("hr",{className:"edit-oauth-splitter"}),e("h2",{className:"edit-oauth-subtitle",children:t("oauth-app-logo")}),e(Le,{logoURL:r.logoURL,onUpload:H}),e("hr",{className:"edit-oauth-splitter"}),e("label",{className:"edit-oauth-subtitle is-required",htmlFor:"edit-oauth-app-name",children:t("oauth-app-name")}),e(f,{className:"edit-oauth-input",id:"edit-oauth-app-name",value:r.appName,onChange:a=>V(a.target.value)}),e("label",{className:"edit-oauth-subtitle is-required",htmlFor:"edit-oauth-homepage-url",children:t("oauth-homepage-url")}),e(f,{className:"edit-oauth-input",id:"edit-oauth-homepage-url",value:r.homepageURL,onChange:a=>q(a.target.value)}),e("label",{className:"edit-oauth-subtitle is-required",htmlFor:"edit-oauth-app-desc",children:t("oauth-app-description")}),e(f.TextArea,{className:"edit-oauth-input edit-oauth-textarea",id:"edit-oauth-app-desc",rows:4,value:r.appDesc,onChange:a=>F(a.target.value)}),e("h2",{className:"edit-oauth-subtitle is-required",children:t("oauth-scopes")}),e(J,{className:"edit-oauth-table",columns:y,dataSource:L,locale:{emptyText:t("no-data")},pagination:!1,rowKey:"scope",rowSelection:{type:"checkbox",selectedRowKeys:U,onChange:B}}),e("h2",{className:"edit-oauth-subtitle is-required",children:t("oauth-callback-url")}),c.map((a,v)=>i("div",{className:"edit-oauth-input-wrapper",children:[e(f,{className:"edit-oauth-input",value:a,onChange:C=>ee(v,C.target.value)}),e("button",{className:"edit-oauth-input-btn edit-oauth-input-delete",title:t("delete"),onClick:()=>k(v),children:e(E,{})})]},v)),i("div",{className:"edit-oauth-input-wrapper",children:[e(f,{className:"edit-oauth-input",value:g,onChange:a=>b(a.target.value)}),e("button",{className:"edit-oauth-input-btn edit-oauth-input-add",title:t("add"),onClick:w,children:e(X,{})})]}),e("div",{className:"edit-oauth-action",children:e(x,{loading:R,type:"primary",onClick:te,children:t("oauth-update-settings")})})]})},Fe=re(function(){const[t,o]=he(),n=h.exports.useCallback((d,g)=>{o({p:d==="index"?void 0:d,q:g})},[o]),l=t.get("p"),m=t.get("q");return e(ue,{children:e("div",{className:"oauth-page",children:l==="new"?e(ye,{navigate:n}):l==="edit"&&m?e(xe,{oauthUUID:m}):e(ke,{navigate:n})})})});export{Fe as OAuthPage,Fe as default};
//# sourceMappingURL=index.6303df79.js.map
