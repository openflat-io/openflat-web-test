import{cV as O,bH as W,cW as H,bN as M,bJ as _,cX as F,q as e,m,b8 as x,aZ as T,b9 as L,k as U,cY as w,bK as Y,c2 as q,c0 as k,A as R,b2 as Z,cZ as J,cA as K,bm as X,ba as Q,bC as ee,bG as oe,cB as te,bE as ae,bF as ie,bc as S}from"./index.43c4ffc0.js";import{u as ne,e as P}from"./routes.73fc4946.js";import{S as re}from"./SVGCircleInfoOutlined.7081c7f0.js";import{c as se,S as le}from"./SVGUserGroup.adcc3976.js";import{R as ce}from"./index.3e1ebacc.js";import{I as de}from"./index.891e0e8b.js";import{R as me}from"./index.065cff0d.js";import{S as ue}from"./SVGRight.196c9da2.js";import{j as he}from"./join-room-handler.9b9ed9e0.js";import{u as ve}from"./use-login-check.e01c4832.js";function fe(u){return O({},u)}var E=1e3*60,I=60*24,V=I*30,j=I*365;function pe(u,t,a){var i,r,c;W(2,arguments);var g=F(),n=(i=(r=a==null?void 0:a.locale)!==null&&r!==void 0?r:g.locale)!==null&&i!==void 0?i:H;if(!n.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var f=se(u,t);if(isNaN(f))throw new RangeError("Invalid time value");var o=O(fe(a),{addSuffix:Boolean(a==null?void 0:a.addSuffix),comparison:f}),s,h;f>0?(s=M(t),h=M(u)):(s=M(u),h=M(t));var v=String((c=a==null?void 0:a.roundingMethod)!==null&&c!==void 0?c:"round"),p;if(v==="floor")p=Math.floor;else if(v==="ceil")p=Math.ceil;else if(v==="round")p=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var y=h.getTime()-s.getTime(),N=y/E,D=_(h)-_(s),l=(y-D)/E,b=a==null?void 0:a.unit,d;if(b?d=String(b):N<1?d="second":N<60?d="minute":N<I?d="hour":l<V?d="day":l<j?d="month":d="year",d==="second"){var C=p(y/1e3);return n.formatDistance("xSeconds",C,o)}else if(d==="minute"){var $=p(N);return n.formatDistance("xMinutes",$,o)}else if(d==="hour"){var B=p(N/60);return n.formatDistance("xHours",B,o)}else if(d==="day"){var G=p(l/I);return n.formatDistance("xDays",G,o)}else if(d==="month"){var A=p(l/V);return A===12&&b!=="month"?n.formatDistance("xYears",1,o):n.formatDistance("xMonths",A,o)}else if(d==="year"){var z=p(l/j);return n.formatDistance("xYears",z,o)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}const ge=({active:u,className:t="",...a})=>e("svg",{className:`${t} flat-icon ${u?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...a,children:e("path",{className:"flat-icon-fill-color",d:"M4 6v-.625A.625.625 0 0 0 3.375 6H4Zm16 0h.625A.625.625 0 0 0 20 5.375V6Zm-8.625 8a.625.625 0 1 0 1.25 0h-1.25ZM9 5.375H4v1.25h5v-1.25ZM3.375 6v10h1.25V6h-1.25ZM5 17.625h5v-1.25H5v1.25Zm6 1h2v-1.25h-2v1.25Zm3-1h5v-1.25h-5v1.25ZM20.625 16V6h-1.25v10h1.25ZM20 5.375h-5v1.25h5v-1.25ZM11.375 9v5h1.25V9h-1.25Zm1.25 5V9h-1.25v5h1.25ZM15 5.375A3.625 3.625 0 0 0 11.375 9h1.25A2.375 2.375 0 0 1 15 6.625v-1.25ZM9.375 17c0 .898.727 1.625 1.625 1.625v-1.25a.375.375 0 0 1-.375-.375h-1.25Zm9.625.625c.898 0 1.625-.727 1.625-1.625h-1.25a.375.375 0 0 1-.375.375v1.25ZM3.375 16c0 .898.728 1.625 1.625 1.625v-1.25A.375.375 0 0 1 4.625 16h-1.25ZM13 18.625c.898 0 1.625-.727 1.625-1.625h-1.25a.375.375 0 0 1-.375.375v1.25Zm-4-12A2.375 2.375 0 0 1 11.375 9h1.25A3.625 3.625 0 0 0 9 5.375v1.25Z",fill:"#5D6066"})}),be=({active:u,className:t="",...a})=>m("svg",{className:`${t} flat-icon ${u?"is-active":""}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...a,children:[e("circle",{className:"flat-icon-stroke-color",cx:"12",cy:"12",r:"8",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"}),e("path",{className:"flat-icon-stroke-color",d:"M12 6v6l4 4",stroke:"#5D6066",strokeLinejoin:"round",strokeWidth:"1.25"})]}),Ue=x(function({roomInfo:t}){const a=T(),i=L(),{beginTime:r,endTime:c,inviteCode:g,periodicUUID:n,roomUUID:f}=t,o=n||f,s=U.exports.useMemo(()=>r?w(r,i):null,[r,i]),h=U.exports.useMemo(()=>c?w(c,i):null,[c,i]);return e("div",{className:"room-detail-body",children:e("div",{className:"room-detail-body-content",children:e("table",{children:m("tbody",{children:[m("tr",{children:[m("td",{className:"room-detail-body-content-left",children:[e(re,{}),e("span",{children:a("status")})]}),e("td",{className:"room-detail-body-content-right",children:e(ce,{room:t})})]}),m("tr",{children:[m("td",{className:"room-detail-body-content-left",children:[e(be,{}),e("span",{children:a("time")})]}),e("td",{className:"room-detail-body-content-right",children:m("span",{children:[s==null?void 0:s.date," ",s==null?void 0:s.time," ~ ","",h==null?void 0:h.date," ",h==null?void 0:h.time]})})]}),m("tr",{children:[m("td",{className:"room-detail-body-content-left",children:[e(ge,{}),e("span",{children:a("room-uuid")})]}),e("td",{className:"room-detail-body-content-right room-detail-body-selectable",children:Y(o,g)})]}),m("tr",{children:[m("td",{className:"room-detail-body-content-left",children:[e(le,{}),e("span",{children:a("room-type")})]}),e("td",{className:"room-detail-body-content-right",children:a(`class-room-type.${t.roomType||q.BigClass}`)})]})]})})})})}),Ne=x(function({room:t,userName:a,inviteBaseUrl:i,isCreator:r,isPeriodicDetailsPage:c,periodicWeeks:g,onJoinRoom:n,onReplayRoom:f,onModifyRoom:o,onCancelRoom:s,onCopyInvitation:h}){const v=T(),[p,y]=U.exports.useState(!1),[N,D]=U.exports.useState(!1),l=()=>D(!1);if(t.roomStatus===k.Stopped)return e("div",{className:"room-detail-footer-btn-container",children:e(R,{className:"room-detail-footer-btn",disabled:!t.hasRecord,onClick:f,children:v("view-replay")})});const b=!r||t.roomStatus===k.Idle,d=v(r?"cancel-room":"remove-room");return m("div",{className:"room-detail-footer-btn-container",children:[e(R,{danger:!0,className:"room-detail-footer-btn",disabled:!b,onClick:()=>y(!0),children:d}),r&&e(R,{className:"room-detail-footer-btn",disabled:!b,onClick:o,children:v("modify-room")}),e(R,{className:"room-detail-footer-btn",onClick:()=>D(!0),children:v("invitation")}),e(R,{className:"room-detail-footer-btn",type:"primary",onClick:n,children:r&&t.roomStatus===k.Idle?v("begin"):v("join-room")}),e(de,{baseUrl:i,periodicWeeks:g,room:t,userName:a,visible:N,onCancel:l,onCopy:C=>{h(C),Z.success(v("copy-success")),l()}}),e(me,{cancelModalVisible:p,isCreator:r,isPeriodicDetailsPage:c,periodicUUID:t==null?void 0:t.periodicUUID,roomUUID:t==null?void 0:t.roomUUID,onCancel:()=>y(!1),onCancelRoom:s})]})}),ye=x(function({roomInfo:t,showRoomCountVisible:a,jumpToPeriodicRoomDetailPage:i}){const r=T(),c=L(),{beginTime:g,endTime:n}=t,f=c,o=U.exports.useMemo(()=>g?w(g,c):null,[g,c]),s=U.exports.useMemo(()=>n?w(n,c):null,[n,c]);return m("div",{className:"room-detail-header-body",children:[m("div",{className:"room-detail-header-container",children:[m("div",{className:"room-detail-header-content-left",children:[e("div",{className:"room-detail-header-content-title",children:e("span",{children:t.title})}),e("div",{className:"room-detail-header-content-title-cut-line"}),m("span",{className:"room-detail-header-content-time",children:[" ",o==null?void 0:o.time," - ","",s==null?void 0:s.time]}),t.endTime&&t.beginTime&&e("span",{className:"room-detail-header-content-time-during",children:"("+pe(t.endTime,t.beginTime,{locale:f!=null&&f.startsWith("zh")?J:H})+")"})]}),e("div",{className:"room-detail-header-content-right",children:a&&m("span",{className:"room-detail-header-content-room-count",onClick:i,children:[r("view-all-rooms-in-periodic-rooms",{count:t.count}),e(ue,{})]})})]}),e("div",{className:"room-detail-header-content-bottom-cut-line"})]})}),De=({roomInfo:u,showRoomCountVisible:t,jumpToPeriodicRoomDetailPage:a,...i})=>m("div",{className:"room-detail-panel-container",children:[e("div",{className:"room-detail-panel-header-container",children:e(ye,{jumpToPeriodicRoomDetailPage:a,roomInfo:u,showRoomCountVisible:t})}),e("div",{className:"room-detail-panel-body",children:e(Ue,{roomInfo:u})}),e("div",{className:"room-detail-panel-footer",children:e(Ne,{...i})})]});const Ze=x(function(){ve();const t=T(),{roomUUID:a,periodicUUID:i}=K(),r=ne(),c=X(),g=U.exports.useContext(Q),n=U.exports.useContext(ee),f=U.exports.useContext(oe),o=n.rooms.get(a),s=i?n.periodicRooms.get(i):void 0;if(U.exports.useEffect(()=>{i?n.syncPeriodicSubRoomInfo({roomUUID:a,periodicUUID:i}).catch(P):n.syncOrdinaryRoomInfo(a).catch(P)},[n,a,i]),U.exports.useEffect(()=>{o&&f.configure({title:e("h1",{className:"room-detail-page-header-title",children:o.title}),onBackPreviousPage:()=>c.goBack()})},[o==null?void 0:o.title]),!o)return e(te,{timeMS:3*1e3});const h=o.ownerUUID===g.userUUID;async function v(){if(o){const l=o.roomUUID;g.isTurnOffDeviceTest||window.isElectron?await he(l,r):r(S.DevicesTestPage,{roomUUID:l})}}async function p(l){try{!h&&i?await n.cancelRoom({all:!0,periodicUUID:i}):await n.cancelRoom({all:l,roomUUID:a,periodicUUID:i})}catch(b){console.log(b),P(b)}Z.success(t("the-room-has-been-cancelled")),c.goBack()}function y(){o!=null&&o.periodicUUID&&r(S.PeriodicRoomDetailPage,{periodicUUID:o.periodicUUID})}function N(){if(o){const{roomType:l,roomUUID:b,ownerUUID:d}=o;if(!l)return void Z.error("Unknown roomType");window.isElectron?r(S.ReplayPage,{roomType:l,roomUUID:b,ownerUUID:d}):window.open(`/replay/${l}/${b}/${d}/`,"_blank")}}function D(){o&&r(S.ModifyOrdinaryRoomPage,{roomUUID:o.roomUUID,periodicUUID:o.periodicUUID})}return e("div",{className:"room-detail-page-container",children:e("div",{className:"room-detail-page-panel-container",children:e(De,{inviteBaseUrl:ae,isCreator:h,isPeriodicDetailsPage:!1,jumpToPeriodicRoomDetailPage:y,periodicWeeks:s==null?void 0:s.periodic.weeks,room:o,roomInfo:o,showRoomCountVisible:i?o.roomStatus!==ie.Stopped:!1,userName:o.ownerName||"",onCancelRoom:p,onCopyInvitation:l=>navigator.clipboard.writeText(l),onJoinRoom:v,onModifyRoom:D,onReplayRoom:N})})})});export{Ze as RoomDetailPage,Ze as default};
//# sourceMappingURL=index.8c2ce459.js.map
