{"version":3,"file":"index.4f58e172.js","sources":["../../../../packages/flat-pages/src/ModifyOrdinaryRoomPage/OrdinaryRoomForm.tsx","../../../../packages/flat-pages/src/ModifyOrdinaryRoomPage/PeriodicSubRoomForm.tsx","../../../../packages/flat-pages/src/ModifyOrdinaryRoomPage/index.tsx"],"sourcesContent":["import { message } from \"antd\";\nimport React, { useEffect, useState } from \"react\";\nimport { observer } from \"mobx-react-lite\";\nimport { useHistory } from \"react-router-dom\";\nimport {\n    EditRoomFormInitialValues,\n    EditRoomFormValues,\n    LoadingPage,\n    errorTips,\n} from \"flat-components\";\nimport { ordinaryRoomInfo, updateOrdinaryRoom } from \"@netless/flat-server-api\";\nimport EditRoomPage from \"../components/EditRoomPage\";\nimport { useSafePromise } from \"../utils/hooks/lifecycle\";\nexport interface OrdinaryRoomFormProps {\n    roomUUID: string;\n}\n\nexport const OrdinaryRoomForm = observer<OrdinaryRoomFormProps>(function RoomForm({ roomUUID }) {\n    const [isLoading, setLoading] = useState(false);\n\n    const history = useHistory();\n    const sp = useSafePromise();\n\n    const [initialValues, setInitialValues] = useState<EditRoomFormInitialValues>();\n\n    useEffect(() => {\n        sp(ordinaryRoomInfo(roomUUID))\n            .then(({ roomInfo }) => {\n                setInitialValues({\n                    title: roomInfo.title,\n                    type: roomInfo.roomType,\n                    beginTime: new Date(roomInfo.beginTime),\n                    endTime: new Date(roomInfo.endTime),\n                    isPeriodic: false,\n                    region: roomInfo.region,\n                });\n            })\n            .catch(e => {\n                console.error(e);\n                errorTips(e);\n                history.goBack();\n            });\n        // Only listen to roomUUID\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [roomUUID]);\n\n    if (!initialValues) {\n        return <LoadingPage />;\n    }\n\n    return (\n        <EditRoomPage\n            initialValues={initialValues}\n            loading={isLoading}\n            type=\"ordinary\"\n            onSubmit={editOrdinaryRoom}\n        />\n    );\n\n    async function editOrdinaryRoom(values: EditRoomFormValues): Promise<void> {\n        setLoading(true);\n\n        try {\n            await sp(\n                updateOrdinaryRoom({\n                    roomUUID: roomUUID,\n                    beginTime: values.beginTime.valueOf(),\n                    endTime: values.endTime.valueOf(),\n                    title: values.title,\n                    type: values.type,\n                }),\n            );\n            void message.success(\"修改成功\");\n            history.goBack();\n        } catch (e) {\n            console.error(e);\n            errorTips(e);\n            setLoading(false);\n        }\n    }\n});\n","import { message } from \"antd\";\nimport React, { useEffect, useState } from \"react\";\nimport { observer } from \"mobx-react-lite\";\nimport { useHistory } from \"react-router-dom\";\nimport {\n    EditRoomFormInitialValues,\n    EditRoomFormValues,\n    LoadingPage,\n    errorTips,\n} from \"flat-components\";\nimport { periodicSubRoomInfo, updatePeriodicSubRoom } from \"@netless/flat-server-api\";\nimport EditRoomPage from \"../components/EditRoomPage\";\nimport { useSafePromise } from \"../utils/hooks/lifecycle\";\n\n/**\n * TODO: we forget set i18n in current file!!!\n */\n\nexport interface PeriodicSubRoomFormProps {\n    roomUUID: string;\n    periodicUUID: string;\n}\n\nexport const PeriodicSubRoomForm = observer<PeriodicSubRoomFormProps>(function RoomForm({\n    roomUUID,\n    periodicUUID,\n}) {\n    const [isLoading, setLoading] = useState(false);\n\n    const history = useHistory();\n    const sp = useSafePromise();\n\n    const [initialValues, setInitialValues] = useState<EditRoomFormInitialValues>();\n    const [previousPeriodicRoomBeginTime, setPreviousPeriodicRoomBeginTime] = useState<\n        number | null\n    >(0);\n    const [nextPeriodicRoomEndTime, setNextPeriodicRoomEndTime] = useState<number | null>(0);\n    useEffect(() => {\n        sp(\n            periodicSubRoomInfo({\n                roomUUID,\n                periodicUUID,\n                needOtherRoomTimeInfo: true,\n            }),\n        )\n            .then(({ roomInfo, previousPeriodicRoomBeginTime, nextPeriodicRoomEndTime }) => {\n                setInitialValues({\n                    title: roomInfo.title,\n                    type: roomInfo.roomType,\n                    beginTime: new Date(roomInfo.beginTime),\n                    endTime: new Date(roomInfo.endTime),\n                    isPeriodic: false,\n                    region: roomInfo.region,\n                });\n                setPreviousPeriodicRoomBeginTime(previousPeriodicRoomBeginTime);\n                setNextPeriodicRoomEndTime(nextPeriodicRoomEndTime);\n            })\n            .catch(e => {\n                console.error(e);\n                errorTips(e);\n                history.goBack();\n            });\n        // Only listen to roomUUID\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [roomUUID, periodicUUID]);\n\n    if (!initialValues) {\n        return <LoadingPage />;\n    }\n\n    return (\n        <EditRoomPage\n            initialValues={initialValues}\n            loading={isLoading}\n            nextPeriodicRoomEndTime={nextPeriodicRoomEndTime}\n            previousPeriodicRoomBeginTime={previousPeriodicRoomBeginTime}\n            type=\"periodicSub\"\n            onSubmit={editPeriodicSubRoom}\n        />\n    );\n\n    async function editPeriodicSubRoom(values: EditRoomFormValues): Promise<void> {\n        setLoading(true);\n\n        try {\n            await sp(\n                updatePeriodicSubRoom({\n                    roomUUID: roomUUID,\n                    periodicUUID: periodicUUID,\n                    beginTime: values.beginTime.valueOf(),\n                    endTime: values.endTime.valueOf(),\n                }),\n            );\n            void message.success(\"修改成功\");\n            history.goBack();\n        } catch (e) {\n            console.error(e);\n            errorTips(e);\n            setLoading(false);\n        }\n    }\n});\n","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { RouteNameType, RouteParams } from \"../utils/routes\";\nimport { useLoginCheck } from \"../utils/use-login-check\";\nimport { OrdinaryRoomForm } from \"./OrdinaryRoomForm\";\nimport { PeriodicSubRoomForm } from \"./PeriodicSubRoomForm\";\n\ntype ModifyOrdinaryRoomPageProps = {\n    roomUUID: string;\n    periodicUUID?: string;\n};\n\nexport const ModifyOrdinaryRoomPage = observer<ModifyOrdinaryRoomPageProps>(\n    function ModifyOrdinaryRoomPage() {\n        useLoginCheck();\n\n        const { roomUUID, periodicUUID } = useParams<RouteParams<RouteNameType.RoomDetailPage>>();\n        if (periodicUUID) {\n            return <PeriodicSubRoomForm periodicUUID={periodicUUID} roomUUID={roomUUID} />;\n        } else {\n            return <OrdinaryRoomForm roomUUID={roomUUID} />;\n        }\n    },\n);\n\nexport default ModifyOrdinaryRoomPage;\n"],"names":["OrdinaryRoomForm","observer","roomUUID","isLoading","setLoading","useState","history","useHistory","sp","useSafePromise","initialValues","setInitialValues","useEffect","ordinaryRoomInfo","then","roomInfo","title","type","roomType","beginTime","Date","endTime","isPeriodic","region","catch","console","error","e","errorTips","goBack","_jsx","LoadingPage","EditRoomPage","editOrdinaryRoom","values","updateOrdinaryRoom","valueOf","message","success","PeriodicSubRoomForm","periodicUUID","previousPeriodicRoomBeginTime","setPreviousPeriodicRoomBeginTime","nextPeriodicRoomEndTime","setNextPeriodicRoomEndTime","periodicSubRoomInfo","needOtherRoomTimeInfo","editPeriodicSubRoom","updatePeriodicSubRoom","ModifyOrdinaryRoomPage","useLoginCheck","useParams"],"mappings":"sSAiBaA,MAAAA,EAAmBC,EAAgC,SAAkB,CAAEC,SAAAA,CAAF,EAAc,CAC5F,KAAM,CAACC,EAAWC,CAAZ,EAA0BC,mBAAS,EAAD,EAElCC,EAAUC,IACVC,EAAKC,IAEL,CAACC,EAAeC,CAAhB,EAAoCN,EAA1C,QAAA,SAAA,EAuBA,GArBAO,EAAAA,QAAAA,UAAU,IAAM,CACZJ,EAAGK,EAAiBX,CAAD,CAAjB,EACGY,KAAK,CAAC,CAAEC,SAAAA,CAAAA,IAAe,CACHJ,EAAA,CACbK,MAAOD,EAASC,MAChBC,KAAMF,EAASG,SACfC,UAAW,IAAIC,KAAKL,EAASI,SAAlB,EACXE,QAAS,IAAID,KAAKL,EAASM,OAAlB,EACTC,WAAY,GACZC,OAAQR,EAASQ,MAAAA,CANL,CAAA,CAFxB,EAWKC,MAAW,GAAA,CACRC,QAAQC,MAAMC,CAAd,EACAC,EAAUD,CAAD,EACTrB,EAAQuB,OAAR,CAAA,CAdR,CAAA,EAkBD,CAAC3B,CAAD,CAnBM,EAqBL,CAACQ,EACM,OAAAoB,EAACC,EAAR,CAAA,CAAA,EAGJ,SACKC,EAAD,CACI,cAAAtB,EACA,QAASP,EACT,KAAK,WACL,SAAU8B,CAAAA,CALlB,EASA,eAAeA,EAAiBC,EAA2C,CACvE9B,EAAW,EAAD,EAEN,GAAA,CACA,MAAMI,EACF2B,EAAmB,CACfjC,SAAAA,EACAiB,UAAWe,EAAOf,UAAUiB,QAFb,EAGff,QAASa,EAAOb,QAAQe,QAHT,EAIfpB,MAAOkB,EAAOlB,MACdC,KAAMiB,EAAOjB,IALC,CAAA,CADd,EASHoB,EAAQC,QAAQ,0BAAhB,EACLhC,EAAQuB,OAAR,QACKF,GACLF,QAAQC,MAAMC,CAAd,EACAC,EAAUD,CAAD,EACTvB,EAAW,EAAD,CACb,CACJ,CACJ,CA/DuC,ECM3BmC,EAAsBtC,EAAmC,SAAkB,CACpFC,SAAAA,EACAsC,aAAAA,CAFoF,EAGrF,CACC,KAAM,CAACrC,EAAWC,CAAZ,EAA0BC,mBAAS,EAAD,EAElCC,EAAUC,IACVC,EAAKC,IAEL,CAACC,EAAeC,CAAhB,EAAoCN,EAA1C,QAAA,SAAA,EACM,CAACoC,EAA+BC,CAAhC,EAAoErC,mBAExE,CAFgF,EAG5E,CAACsC,EAAyBC,CAA1B,EAAwDvC,mBAAwB,CAAhB,EA8BtE,GA7BAO,EAAAA,QAAAA,UAAU,IAAM,CACZJ,EACIqC,EAAoB,CAChB3C,SAAAA,EACAsC,aAAAA,EACAM,sBAAuB,EAAA,CAHR,CADrB,EAOGhC,KAAK,CAAC,CAAEC,SAAAA,EAAU0B,8BAAAA,EAA+BE,wBAAAA,CAAAA,IAA8B,CAC3DhC,EAAA,CACbK,MAAOD,EAASC,MAChBC,KAAMF,EAASG,SACfC,UAAW,IAAIC,KAAKL,EAASI,SAAlB,EACXE,QAAS,IAAID,KAAKL,EAASM,OAAlB,EACTC,WAAY,GACZC,OAAQR,EAASQ,MAAAA,CANL,EAQhBmB,EAAiCD,CAAD,EAChCG,EAA2BD,CAAD,CAAA,CAjBlC,EAmBKnB,MAAWG,GAAA,CACRF,QAAQC,MAAMC,CAAd,EACAC,EAAUD,CAAD,EACTrB,EAAQuB,OAAR,CAAA,CAtBR,CAAA,EA0BD,CAAC3B,EAAUsC,CAAX,CA3BM,EA6BL,CAAC9B,EACM,OAAAoB,EAACC,EAAR,CAAA,CAAA,EAGJ,SACKC,EAAD,CACI,cAAAtB,EACA,QAASP,EACT,wBAAAwC,EACA,8BAAAF,EACA,KAAK,cACL,SAAUM,CAAAA,CAPlB,EAWA,eAAeA,EAAoBb,EAA2C,CAC1E9B,EAAW,EAAD,EAEN,GAAA,CACA,MAAMI,EACFwC,EAAsB,CAClB9C,SAAAA,EACAsC,aAAAA,EACArB,UAAWe,EAAOf,UAAUiB,QAHV,EAIlBf,QAASa,EAAOb,QAAQe,QAAf,CAJQ,CAAA,CADjB,EAQHC,EAAQC,QAAQ,0BAAhB,EACLhC,EAAQuB,OAAR,QACKF,GACLF,QAAQC,MAAMC,CAAd,EACAC,EAAUD,CAAD,EACTvB,EAAW,EAAD,CACb,CACJ,CACJ,CA9E0C,ECV9B6C,EAAyBhD,EAClC,UAAkC,CACjBiD,IAEP,KAAA,CAAEhD,SAAAA,EAAUsC,aAAAA,GAAiBW,EAAnC,EACA,OAAIX,IACQD,EAAD,CAAqB,aAAAC,EAA4B,SAAAtC,CAAA,CAAxD,IAEQF,EAAD,CAAkB,SAAAE,CAAA,CAAzB,CAEP,CAVyC"}