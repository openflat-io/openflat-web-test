{"version":3,"file":"index.3685ff34.js","sources":["../../../../service-providers/file-preview-netless-slide/src/index.ts"],"sourcesContent":["import { previewSlide, SlideViewer } from \"@netless/app-slide\";\nimport { queryConvertingTaskStatus } from \"@netless/flat-service-provider-file-convert-netless\";\nimport { CloudFile, IServiceFilePreview, FileResourceType } from \"@netless/flat-services\";\n\nexport class FilePreviewNetlessSlide implements IServiceFilePreview {\n    public slideViewer?: SlideViewer;\n\n    public async preview(file: CloudFile, container: HTMLElement): Promise<any> {\n        if (this.slideViewer) {\n            this.slideViewer.destroy();\n        }\n\n        if (\n            file.resourceType === FileResourceType.WhiteboardConvert ||\n            file.resourceType === FileResourceType.WhiteboardProjector\n        ) {\n            const result = await queryConvertingTaskStatus({\n                dynamic: true,\n                resourceType: file.resourceType,\n                meta: file.meta,\n            });\n\n            this.slideViewer = previewSlide({\n                container: container,\n                taskId: result.uuid,\n                url:\n                    result.prefix ||\n                    extractLegacySlideUrlPrefix(\n                        result.progress?.convertedFileList[0].conversionFileUrl,\n                    ),\n            });\n        }\n    }\n\n    public async destroy(): Promise<void> {\n        this.slideViewer?.destroy();\n    }\n}\n\nfunction extractLegacySlideUrlPrefix(fullUrl?: string): string | undefined {\n    if (!fullUrl || !fullUrl.startsWith(\"ppt\")) {\n        return undefined;\n    }\n\n    // e.g. \"ppt(x)://cdn/prefix/dynamicConvert/{taskId}/1.slide\"\n    const pptSrcRE = /^pptx?(:\\/\\/\\S+?dynamicConvert)\\/(\\w+)\\//;\n\n    const match = pptSrcRE.exec(fullUrl);\n    if (!match) {\n        return undefined;\n    }\n\n    return \"https\" + match[1];\n}\n"],"names":["FilePreviewNetlessSlide","__publicField","file","container","FileResourceType","result","queryConvertingTaskStatus","previewSlide","extractLegacySlideUrlPrefix","_a","fullUrl","match"],"mappings":"gRAIO,MAAMA,CAAuD,CAA7D,cACIC,EAAA,oBAEP,MAAa,QAAQC,EAAiBC,EAAsC,OAKxE,GAJI,KAAK,aACL,KAAK,YAAY,UAIjBD,EAAK,eAAiBE,EAAiB,mBACvCF,EAAK,eAAiBE,EAAiB,oBACzC,CACQ,MAAAC,EAAS,MAAMC,EAA0B,CAC3C,QAAS,GACT,aAAcJ,EAAK,aACnB,KAAMA,EAAK,IAAA,CACd,EAED,KAAK,YAAcK,EAAa,CAC5B,UAAAJ,EACA,OAAQE,EAAO,KACf,IACIA,EAAO,QACPG,GACIC,EAAAJ,EAAO,WAAP,YAAAI,EAAiB,kBAAkB,GAAG,iBAC1C,CAAA,CACP,CACL,CACJ,CAEA,MAAa,SAAyB,QAClCA,EAAA,KAAK,cAAL,MAAAA,EAAkB,SACtB,CACJ,CAEA,SAASD,EAA4BE,EAAsC,CACvE,GAAI,CAACA,GAAW,CAACA,EAAQ,WAAW,KAAK,EAC9B,OAML,MAAAC,EAFW,2CAEM,KAAKD,CAAO,EACnC,GAAI,EAACC,EAIL,MAAO,QAAUA,EAAM,EAC3B"}