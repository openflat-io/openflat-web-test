import{aZ as E,q as e,ad as B,A as Z,m,x as _,k as a,aD as j,b8 as $,ba as J,dB as K,bx as Q,cA as X}from"./index.43c4ffc0.js";import{u as Y}from"./routes.73fc4946.js";import{j as ee}from"./join-room-handler.9b9ed9e0.js";import{u as se}from"./lifecycle.32153b61.js";import{u as te}from"./use-login-check.e01c4832.js";import{n as F}from"./noop.c988f9cd.js";const ce="data:image/svg+xml;charset=utf8,%3csvg width='120' height='120' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M86.562 93.048a2.5 2.5 0 1 1-3.124 3.904c-13.703-10.962-33.173-10.962-46.876 0a2.5 2.5 0 1 1-3.124-3.904c15.53-12.423 37.595-12.423 53.124 0Zm5.206-64.816a2.5 2.5 0 0 1 .289 3.19l-.29.346-6.765 6.764-3.83 3.832-.001-.001-8.717 8.719-11.371 11.372-.002-.001-8.717 8.718h.001l-3.832 3.832-.001-.001-16.764 16.766a2.5 2.5 0 0 1-3.825-3.19l.29-.346 60-60a2.5 2.5 0 0 1 3.535 0ZM86.8 43.807c.458 1.99.7 4.063.7 6.193 0 15.188-12.312 27.5-27.5 27.5-2.13 0-4.202-.242-6.193-.7l4.373-4.373c.6.048 1.207.073 1.82.073 12.426 0 22.5-10.074 22.5-22.5 0-.613-.025-1.22-.073-1.82l4.373-4.373ZM60 22.5a27.41 27.41 0 0 1 19.14 7.753l-3.536 3.537A22.425 22.425 0 0 0 60 27.5c-12.426 0-22.5 10.074-22.5 22.5 0 6.06 2.395 11.559 6.29 15.604l-3.537 3.536A27.41 27.41 0 0 1 32.5 50c0-15.188 12.312-27.5 27.5-27.5Zm0 15c3.298 0 6.297 1.277 8.53 3.363l-3.539 3.539a7.5 7.5 0 0 0-10.59 10.59l-3.538 3.539A12.456 12.456 0 0 1 47.5 50c0-6.904 5.596-12.5 12.5-12.5Z' fill='%237A7B7C'/%3e%3c/svg%3e",ae="data:image/svg+xml;charset=utf8,%3csvg width='12' height='12' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' fill-rule='evenodd'%3e%3ccircle fill='%23FFCD00' cx='6' cy='6' r='6'/%3e%3cpath d='M6.75 5v5h-1.5V5h1.5ZM6 2a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z' fill='%231A1E21' fill-rule='nonzero'/%3e%3c/g%3e%3c/svg%3e",G=({devices:i,isDeviceAccessible:o,currentDeviceID:n,onChange:s})=>{const t=E(),r=i!=null&&i.some(l=>l.deviceId===n)?n:void 0;return e("div",{className:"device-test-select-container",children:o?e("div",{className:"device-test-select-box",children:e(B,{value:r,onChange:s,children:i==null?void 0:i.map(({deviceId:l,label:d})=>e(B.Option,{value:l,children:d},l))})}):e("div",{className:"device-test-select-disabled-btn",children:e(Z,{icon:e("img",{src:ae}),children:t("no-device-permission")})})})},ie=({cameraDevices:i,isCameraAccessible:o,currentCameraDeviceID:n,cameraVideoStreamRef:s,setCameraDevice:t})=>{const r=E();return m("div",{className:"camera-test-container",children:[e("div",{className:"camera-test-text",children:r("camera")}),e("div",{className:"camera-test-select-box",children:e(G,{currentDeviceID:n,devices:i,isDeviceAccessible:o,onChange:t})}),m("div",{className:"camera-test-wrapper",children:[e("div",{ref:s,className:"camera-box"}),m("div",{className:_("camera-no-accredit-box",{visible:!o}),children:[e("img",{src:ce}),e("span",{children:r("enable-camera-permission-tip")})]})]})]})},re=({microphoneDevices:i,microphoneVolume:o,isMicrophoneAccessible:n,currentMicrophoneDeviceID:s,setMicrophoneDevice:t})=>{const r=E();return m("div",{className:"microphone-test-container",children:[e("div",{className:"microphone-test-text",children:r("microphone")}),e("div",{className:"microphone-text-select-box",children:e(G,{currentDeviceID:s,devices:i,isDeviceAccessible:n,onChange:t})}),m("div",{className:"microphone-test-wrapper",children:[e("div",{className:"microphone-test-volume",style:{width:`${o*100}%`}}),e("div",{className:"microphone-test-mask"})]})]})},ne="data:image/svg+xml;charset=utf8,%3csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M6.5 5v14l11-7z' fill='%235D5D5D' fill-rule='evenodd'/%3e%3c/svg%3e",oe="data:image/svg+xml;charset=utf8,%3csvg width='22' height='22' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M7 5h2v12H7zm6 0h2v12h-2z' fill='%23444E60' fill-rule='evenodd'/%3e%3c/svg%3e",le="/assets/Goldberg Variations_ BWV 988 - 05 - Variatio 4 a 1 Clav.e8025df4.mp3",de=({speakerDevices:i,speakerTestFileName:o,currentSpeakerDeviceID:n,isSpeakerAccessible:s,audioResourceSrc:t,setSpeakerDevice:r,startSpeakerTest:l,stopSpeakerTest:d})=>{const h=E(),[x,p]=a.exports.useState(!1),k=()=>{p(!x)};return a.exports.useEffect(()=>(x?l(t||le):d(),()=>{d()}),[t,x,l,d]),m("div",{className:"speaker-test-container",children:[e("div",{className:"speaker-test-text",children:h("speaker")}),e("div",{className:"speaker-text-select-box",children:e(G,{currentDeviceID:n,devices:i,isDeviceAccessible:s,onChange:r})}),e("div",{className:"speaker-test-output-box",children:e(Z,{icon:e("img",{src:x?oe:ne}),onClick:k,children:o})})]})},me=({cameraDevices:i,speakerDevices:o,microphoneDevices:n,audioResourceSrc:s,speakerTestFileName:t,currentCameraDeviceID:r,currentSpeakerDeviceID:l,currentMicrophoneDeviceID:d,microphoneVolume:h,isCameraAccessible:x,isSpeakerAccessible:p,isMicrophoneAccessible:k,cameraVideoStreamRef:C,isTurnOffDeviceTest:O,setCameraDevice:u,setMicrophoneDevice:S,setSpeakerDevice:f,startSpeakerTest:N,stopSpeakerTest:D,toggleDeviceTest:M,joinRoom:y,autoMicOn:w,autoCameraOn:V,toggleAutoMicOn:b,toggleAutoCameraOn:P})=>{const g=E();return m("div",{className:"device-test-panel-container",children:[e("div",{className:"device-test-panel-title-box",children:g("device-test")}),m("div",{className:"device-test-panel-inner-box",children:[e("div",{className:"device-test-panel-inner-left",children:e(ie,{cameraDevices:i,cameraVideoStreamRef:C,currentCameraDeviceID:r,isCameraAccessible:x,setCameraDevice:u})}),m("div",{className:"device-test-panel-inner-right",children:[e(de,{audioResourceSrc:s,currentSpeakerDeviceID:l,isSpeakerAccessible:p,setSpeakerDevice:f,speakerDevices:o,speakerTestFileName:t,startSpeakerTest:N,stopSpeakerTest:D}),e(re,{currentMicrophoneDeviceID:d,isMicrophoneAccessible:k,microphoneDevices:n,microphoneVolume:h,setMicrophoneDevice:S}),m("div",{className:"device-test-panel-join-options",children:[e("div",{className:"device-test-panel-join-options-text",children:g("join-options")}),e(j,{checked:w,onClick:b,children:g("turn-on-the-microphone")}),e(j,{checked:V,onClick:P,children:g("turn-on-the-camera")})]})]})]}),m("div",{className:"device-test-panel-tips-box",children:[e("div",{className:"device-test-panel-tips-radio",children:e(j,{checked:O,onClick:M,children:g("close-tip")})}),e("div",{className:"device-test-panel-join-btn",children:e(Z,{type:"primary",onClick:y,children:g("join-room")})})]})]})};const xe=$(function(){const o=Y(),n=a.exports.useContext(J),s=K("videoChat"),t=a.exports.useContext(Q),r=se();te();const{roomUUID:l}=X(),d=a.exports.useRef(null),[h,x]=a.exports.useState([]),[p,k]=a.exports.useState([]),[C,O]=a.exports.useState([]),[u,S]=a.exports.useState(""),[f,N]=a.exports.useState(""),[D,M]=a.exports.useState(""),[y,w]=a.exports.useState(!0),[V,b]=a.exports.useState(!0),[P,g]=a.exports.useState(!0),[H,R]=a.exports.useState(0);a.exports.useEffect(()=>{if(!s)return;const c=s.getTestAvatar();if(c){c.enableCamera(!0),c.enableMic(!0),c.setElement(d.current);const v=window.setInterval(()=>{R(Math.min(c.getVolumeLevel()+Math.random()*.05,1))},50);return()=>{window.clearInterval(v),c.enableCamera(!1),c.enableMic(!1),c.setElement(null)}}},[s,d]),a.exports.useEffect(()=>{if(!s)return;const c=()=>{r(s.getCameraDevices()).then(A=>{const I=A.filter(T=>T.deviceId);x(I),w(I.length>0)}).catch(()=>{w(!1)})},v=()=>{r(s.getMicDevices()).then(A=>{const I=A.filter(T=>T.deviceId);k(I),b(I.length>0)}).catch(()=>{b(!1)})},z=()=>{r(s.getSpeakerDevices()).then(A=>{const I=A.filter(T=>T.deviceId);O(I),b(I.length>0)}).catch(()=>{g(!1)})},U=s.events.on("camera-changed",c),q=s.events.on("mic-changed",v),W=s.events.on("speaker-changed",z);return c(),v(),z(),()=>{U(),q(),W()}},[s,r]),a.exports.useEffect(()=>{s&&u&&s.setCameraID(u).catch(()=>{w(!1)})},[s,u]),a.exports.useEffect(()=>{s&&f&&s.setMicID(f).catch(()=>{b(!1)})},[s,f]),a.exports.useEffect(()=>{s&&D&&s.setSpeakerID(D).catch(()=>{g(!1)})},[s,D]),a.exports.useEffect(()=>{if(h.length>0&&!u){const c=t.cameraId;c&&h.find(v=>v.deviceId===c)?S(c):S(h[0].deviceId)}},[t,u,h]),a.exports.useEffect(()=>{if(p.length>0&&!f){const c=t.microphoneId;c&&p.some(v=>v.deviceId===c)?N(c):N(p[0].deviceId)}},[t,f,p]),a.exports.useEffect(()=>{if(C.length>0&&!D){const c=t.speakerId;c&&C.some(v=>v.deviceId===c)?M(c):M(C[0].deviceId)}},[t,D,C]);const L=async()=>{t.updateCameraId(u),t.updateMicrophoneId(f),await ee(l,o)};return e("div",{className:"device-test-page-container",children:e("div",{className:"device-test-panel-box",children:e(me,{autoCameraOn:t.autoCameraOn,autoMicOn:t.autoMicOn,cameraDevices:h,cameraVideoStreamRef:d,currentCameraDeviceID:u,currentMicrophoneDeviceID:f,currentSpeakerDeviceID:D,isCameraAccessible:y,isMicrophoneAccessible:V,isSpeakerAccessible:P,isTurnOffDeviceTest:n.isTurnOffDeviceTest,joinRoom:L,microphoneDevices:p,microphoneVolume:H,setCameraDevice:S,setMicrophoneDevice:N,setSpeakerDevice:M,speakerDevices:C,speakerTestFileName:"Music",startSpeakerTest:s?s.startSpeakerTest:F,stopSpeakerTest:s?s.stopSpeakerTest:F,toggleAutoCameraOn:()=>t.updateAutoCameraOn(!t.autoCameraOn),toggleAutoMicOn:()=>t.updateAutoMicOn(!t.autoMicOn),toggleDeviceTest:n.toggleDeviceTest})})})});export{xe as DevicesTestPage,xe as default};
//# sourceMappingURL=index.73b77355.js.map
