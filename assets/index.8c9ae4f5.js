import{k as r,q as e,aa as D,a4 as U,aZ as C,m as o,aH as b,A,n as T,b8 as R,ba as E,x as F,b2 as k,dk as j,bs as L,dl as $,dm as q,cP as K,dn as Q,b3 as S,v as G,dp as B,bx as J,b9 as X,az as Y,aD as y,dq as ee,bl as ae,bc as te}from"./index.43c4ffc0.js";import{i as H,j as M,r as V,L as O,e as I,k as ne,u as ie,g as se,m as ce,n as re}from"./routes.73fc4946.js";import{U as le}from"./UserSettingLayoutContainer.e2f93cae.js";import{u as N}from"./lifecycle.32153b61.js";import{a as oe,b as de}from"./WeChatLogin.40ae371f.js";import"./SVGCircleInfoOutlined.7081c7f0.js";import"./use-login-check.e01c4832.js";var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"}}]},name:"github",theme:"filled"};const ue=he;var _=function(n,a){return e(D,{...U(U({},n),{},{ref:a,icon:ue})})};_.displayName="GithubFilled";const ge=r.exports.forwardRef(_);var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M690.1 377.4c5.9 0 11.8.2 17.6.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6a21.5 21.5 0 019.1 17.6c0 2.4-.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-.1 17.8-.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8zm-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1zm-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1zm586.8 415.6c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7a9 9 0 006.4-2.6 9 9 0 002.6-6.4c0-2.2-.9-4.4-1.4-6.6-.3-1.2-7.6-28.3-12.2-45.3-.5-1.9-.9-3.8-.9-5.7.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9zm179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9a36.08 36.08 0 01-36 35.9z"}}]},name:"wechat",theme:"filled"};const me=pe;var z=function(n,a){return e(D,{...U(U({},n),{},{ref:a,icon:me})})};z.displayName="WechatFilled";const fe=r.exports.forwardRef(z),ve="data:image/svg+xml;charset=utf8,%3csvg width='120' height='80' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='120' height='80' rx='4' fill='%23ECF0F7'/%3e%3cpath d='M1 4a3 3 0 0 1 3-3h12v78H4a3 3 0 0 1-3-3V4Z' fill='%230A1933'/%3e%3crect x='24' y='24' width='88' height='48' rx='2' fill='white'/%3e%3crect x='24' y='8' width='24' height='12' rx='2' fill='white'/%3e%3crect x='52' y='8' width='24' height='12' rx='2' fill='white'/%3e%3crect x='80' y='8' width='24' height='12' rx='2' fill='white'/%3e%3cpath d='M119.5 76a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 76V4A3.5 3.5 0 0 1 4 .5h112a3.5 3.5 0 0 1 3.5 3.5v72Z' stroke='%235D6066'/%3e%3c/svg%3e",we="data:image/svg+xml;charset=utf8,%3csvg width='120' height='80' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='120' height='80' rx='4' fill='%2303060D'/%3e%3cpath d='M1 4a3 3 0 0 1 3-3h12v78H4a3 3 0 0 1-3-3V4Z' fill='%2314181E'/%3e%3crect x='24' y='24' width='88' height='48' rx='2' fill='%23272A30'/%3e%3crect x='24' y='8' width='24' height='12' rx='2' fill='%23272A30'/%3e%3crect x='52' y='8' width='24' height='12' rx='2' fill='%23272A30'/%3e%3crect x='80' y='8' width='24' height='12' rx='2' fill='%23272A30'/%3e%3cpath d='M119.5 76a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 76V4A3.5 3.5 0 0 1 4 .5h112a3.5 3.5 0 0 1 3.5 3.5v72Z' stroke='%235D6066'/%3e%3c/svg%3e",xe="data:image/svg+xml;charset=utf8,%3csvg width='120' height='80' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cmask id='a' style='mask-type:alpha' maskUnits='userSpaceOnUse' x='0' y='0' width='60' height='80'%3e%3cpath d='M0 4a4 4 0 0 1 4-4h56v80H4a4 4 0 0 1-4-4V4Z' fill='%23ECF0F7'/%3e%3c/mask%3e%3cg mask='url(%23a)'%3e%3cpath d='M0 4a4 4 0 0 1 4-4h56v80H4a4 4 0 0 1-4-4V4Z' fill='%23ECF0F7'/%3e%3crect x='10.5' y='10.5' width='119' height='79' rx='3.5' fill='%23ECF0F7' stroke='%23D5D9E0'/%3e%3cpath d='M11 14a3 3 0 0 1 3-3h12v78H14a3 3 0 0 1-3-3V14Z' fill='%230A1933'/%3e%3crect x='34' y='34' width='88' height='48' rx='2' fill='white'/%3e%3crect x='34' y='18' width='24' height='12' rx='2' fill='white'/%3e%3c/g%3e%3cmask id='b' style='mask-type:alpha' maskUnits='userSpaceOnUse' x='60' y='0' width='60' height='80'%3e%3cpath d='M120 4a4 4 0 0 0-4-4H60v80h56a4 4 0 0 0 4-4V4Z' fill='%23ECF0F7'/%3e%3c/mask%3e%3cg mask='url(%23b)'%3e%3cpath d='M120 76a4 4 0 0 1-4 4H60V0h56a4 4 0 0 1 4 4v72Z' fill='%2314181E'/%3e%3crect x='70.5' y='10.5' width='119' height='79' rx='3.5' fill='%2303060D' stroke='%23383B42'/%3e%3cpath d='M71 14a3 3 0 0 1 3-3h12v78H74a3 3 0 0 1-3-3V14Z' fill='%2314181E'/%3e%3crect x='94' y='34' width='88' height='48' rx='2' fill='%23272A30'/%3e%3crect x='94' y='18' width='24' height='12' rx='2' fill='%23272A30'/%3e%3c/g%3e%3cpath d='M119.5 76a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 76V4A3.5 3.5 0 0 1 4 .5h112a3.5 3.5 0 0 1 3.5 3.5v72Z' stroke='%235D6066'/%3e%3c/svg%3e",be=({defaultValue:s,changeAppearance:n})=>{const a=C();return e("div",{className:"appearance-picker-container",children:o(b.Group,{defaultValue:s,onChange:n,children:[e(b,{value:"light",children:o("div",{className:"appearance-picker-option",children:[e("img",{src:ve}),e("span",{children:a("app-appearance-light")})]})}),e(b,{value:"dark",children:o("div",{className:"appearance-picker-option",children:[e("img",{src:we}),e("span",{children:a("app-appearance-dark")})]})}),e(b,{value:"auto",children:o("div",{className:"appearance-picker-option",children:[e("img",{src:xe}),e("span",{children:a("app-appearance-auto")})]})})]})})};const ke=({onConfirm:s})=>{const n=N(),a=C(),[t,c]=r.exports.useState(!1),[i,h]=r.exports.useState("idle"),u=r.exports.useCallback(async()=>{c(!0),await n(s().catch(console.error)),c(!1),h("idle")},[s,n]);return i==="idle"?e(A,{type:"link",onClick:()=>h("confirm"),children:a("modify")}):o(T,{children:[e(A,{disabled:t,loading:t,type:"primary",onClick:u,children:a("confirm")}),e(A,{onClick:()=>h("idle"),children:a("cancel")})]})},Ce=R(function({onUpload:n}){var d,m;const a=r.exports.useContext(E),t=N(),c=C(),[i,h]=r.exports.useState(!1),[u,p]=r.exports.useState(((d=a.userInfo)==null?void 0:d.avatar)||"");r.exports.useEffect(()=>{var l;(l=a.userInfo)!=null&&l.avatar&&p(a.userInfo.avatar)},[(m=a.userInfo)==null?void 0:m.avatar]);const f=async l=>{var w;const v=(l.target.files||[])[0];v?(h(!0),t(Ne(v)).then(p),n&&await t(n(v).catch(console.error)),h(!1)):p(((w=a.userInfo)==null?void 0:w.avatar)||"")};return o("div",{className:F("general-setting-user-avatar",{"is-loading":i}),children:[e("input",{accept:".png,.jpg,.jpeg",className:"user-avatar-input",type:"file",onChange:f}),u?e("img",{alt:"avatar",className:"user-avatar-image",src:u}):e("span",{className:"user-avatar-text",children:c("upload-avatar")})]})});function Ne(s){return new Promise((n,a)=>{const t=new FileReader;t.onload=()=>n(t.result),t.onerror=a,t.readAsDataURL(s)})}const ye=5242880;async function Ae(s,n){var h;if(s.size>=ye)throw k.info(n("upload-avatar-size-limit")),new Error("upload avatar size limit");const a=await j(s.name,s.size,(h=L.region)!=null?h:$.CN_HZ),t=new FormData,c=encodeURIComponent(s.name);t.append("key",a.filePath),t.append("name",s.name),t.append("policy",a.policy),t.append("OSSAccessKeyId",q.accessKey),t.append("success_action_status","200"),t.append("callback",""),t.append("signature",a.signature),t.append("Content-Disposition",`attachment; filename="${c}"; filename*=UTF-8''${c}`),t.append("file",s),await K.post(a.policyURL,t,{headers:{"Content-Type":"multipart/form-data"}});const{avatarURL:i}=await Q(a.fileUUID);L.updateUserAvatar(i)}const Ue=({isBind:s,onRefresh:n,globalStore:a})=>{const t=N(),c=C(),[i,h]=r.exports.useState(""),[u,p]=r.exports.useState(""),f=r.exports.useCallback(()=>{h(""),p(""),n()},[n]);r.exports.useEffect(()=>{let l=NaN;async function v(){const w=await t(H(i));w.processing?l=window.setTimeout(v,2e3):(w.status||k.info(c("bind-wechat-failed")),f())}if(u&&i)return v(),()=>{Number.isNaN(l)||window.clearTimeout(l)}},[i,f,n,u,t,c]);const d=async()=>{const l=G();h(l),await t(M(l)),p(oe(l,B.WECHAT_CALLBACK))},m=()=>{S.confirm({content:c("unbind-confirm"),onOk:async()=>{try{const{token:l}=await t(V(O.WeChat));a.updateUserToken(l),n(),k.info(c("unbind-success"))}catch(l){I(l)}}})};return o(T,{children:[e("span",{className:F("binding-wechat",{"is-bind":s}),title:c(s?"is-bind":"not-bind"),onClick:s?m:d,children:e(fe,{style:{color:"#fff"}})}),e(S,{centered:!0,destroyOnClose:!0,className:"binding-wechat-modal",footer:null,open:!!u,title:c("bind-wechat"),onCancel:f,children:e("iframe",{className:"binding-wechat-iframe",frameBorder:"0",scrolling:"no",src:u,title:"wechat"})})]})},Se={wechat:!1,phone:!1,agora:!1,apple:!1,github:!1,google:!1};function Fe(){const s=N(),[n,a]=r.exports.useState(Se),t=r.exports.useCallback(()=>{s(ne()).then(a)},[s]);return r.exports.useEffect(t,[t]),{bindings:n,refresh:t}}const Ie=({isBind:s,onRefresh:n,globalStore:a})=>{const t=N(),c=C(),[i,h]=r.exports.useState(""),u=r.exports.useCallback(()=>{h(""),n()},[n]);r.exports.useEffect(()=>{let d=NaN;async function m(){const l=await t(H(i));l.processing?d=window.setTimeout(m,2e3):(l.status||k.info(c("bind-wechat-failed")),u())}if(i)return m(),()=>{Number.isNaN(d)||window.clearTimeout(d)}},[i,u,n,t,c]);const p=async()=>{const d=G();h(d),await t(M(d)),window.open(de(d,B.GITHUB_CALLBACK))},f=()=>{S.confirm({content:c("unbind-confirm"),onOk:async()=>{try{const{token:d}=await t(V(O.Github));a.updateUserToken(d),n(),k.info(c("unbind-success"))}catch(d){I(d)}}})};return e("span",{className:F("binding-github",{"is-bind":s}),title:c(s?"is-bind":"not-bind"),onClick:s?f:p,children:e(ge,{style:{color:"#fff"}})})},He=R(function(){const n=r.exports.useContext(E),a=r.exports.useContext(J),t=N(),c=ie(),i=C(),h=X(),[u,p]=r.exports.useState(n.userName||""),[f,d]=r.exports.useState(!1),{bindings:m,refresh:l}=Fe();async function v(){if(u!==n.userName){d(!0),await t(ee(u)),d(!1);const g=await t(se());n.updateUserInfo(g),n.updateLastLoginCheck(Date.now())}}async function w(g){try{await Ae(g,i)}catch(x){throw k.info(i("upload-avatar-failed")),x}}function P(g){const x=g.target.value;ae.changeLanguage(x===0?"zh-CN":"en")}const Z=g=>{const x=g.target.value;a.updatePrefersColorScheme(x)};async function W(){const{alreadyJoinedRoomCount:g}=await t(ce());if(g>0){k.error(i("quit-all-rooms-before-delete-account"));return}S.confirm({content:i("confirm-delete-account"),onOk:async()=>{try{await t(re()),n.updateUserInfo(null),c(te.LoginPage)}catch(x){I(x)}}})}return e(le,{children:o("div",{className:"general-setting-container",children:[o("div",{className:"general-setting-user-profile",children:[e("span",{className:"general-setting-title",children:i("user-profile")}),o("div",{className:"general-setting-user-avatar-wrapper",children:[e("span",{className:"general-setting-subtitle",children:i("avatar")}),e(Ce,{onUpload:w})]}),o("div",{children:[e("span",{className:"general-setting-subtitle",children:i("username")}),e(Y,{disabled:f,id:"username",spellCheck:!1,value:u,onChange:g=>p(g.currentTarget.value)}),e(ke,{onConfirm:v})]}),o("div",{className:"general-setting-binding-methods",children:[e(Ue,{globalStore:n,isBind:m.wechat,onRefresh:l}),e(Ie,{globalStore:n,isBind:m.github,onRefresh:l})]})]}),o("div",{className:"general-setting-select-language",children:[e("span",{children:i("language-settings")}),o(b.Group,{defaultValue:h==="zh-CN"?0:1,onChange:P,children:[e(b,{value:0,children:e("span",{className:"radio-item-inner",children:i("chinese")})}),e(b,{value:1,children:e("span",{className:"radio-item-inner",children:"English"})})]})]}),o("div",{className:"general-setting-appearance-picker-container",children:[e("span",{children:i("app-appearance-setting")}),e(be,{changeAppearance:Z,defaultValue:a.prefersColorScheme})]}),o("div",{className:"general-setting-join-options-box",children:[e("div",{className:"general-setting-join-options",children:i("join-options")}),e(y,{checked:a.autoMicOn,onClick:()=>a.updateAutoMicOn(!a.autoMicOn),children:i("turn-on-the-microphone")}),e(y,{checked:a.autoCameraOn,onClick:()=>a.updateAutoCameraOn(!a.autoCameraOn),children:i("turn-on-the-camera")})]}),o("div",{className:"general-setting-device-test-box",children:[e("div",{className:"general-setting-checkbox-title",children:i("device-test-option")}),e(y,{checked:!n.isTurnOffDeviceTest,onClick:n.toggleDeviceTest,children:e("span",{className:"checkbox-item-inner",children:i("turn-on-device-test")})})]}),o("div",{className:"general-setting-recording-box",children:[e("div",{className:"general-setting-checkbox-title",children:i("recording-settings.title")}),e(y,{checked:a.autoRecording,onClick:a.toggleAutoRecording,children:e("span",{className:"checkbox-item-inner",children:i("recording-settings.auto-recording")})})]}),o("div",{className:"general-setting-recording-box",children:[e("div",{className:"general-setting-checkbox-title",children:i("whiteboard-settings.title")}),e(y,{checked:a.strokeTail,onClick:a.toggleStrokeTail,children:e("span",{className:"checkbox-item-inner",children:i("whiteboard-settings.pencil-tail")})})]}),o("div",{className:"general-setting-user-account",children:[e("span",{className:"general-setting-title",children:i("delete-account")}),e("div",{children:e(A,{danger:!0,onClick:W,children:i("delete-account")})})]})]})})});export{He as GeneralSettingPage,He as default};
//# sourceMappingURL=index.8c9ae4f5.js.map
